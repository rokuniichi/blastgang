window.__require=function e(t,o,n){function i(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var u="function"==typeof __require&&__require;if(!a&&u)return u(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({AltitudeMap:[function(e,t,o){"use strict";cc._RF.push(t,"988ee61LrlLxI8UCWKJq6dH","AltitudeMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.AltitudeMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e,t){this._map.set(e,t)},e.prototype.remove=function(e){this._map.set(e,null)},e.prototype.get=function(e){var t;return null!==(t=this._map.get(e))&&void 0!==t?t:null},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.AltitudeMap=n,cc._RF.pop()},{}],ApplicationGraph:[function(e,t,o){"use strict";cc._RF.push(t,"aec39C+01JLG6VYFxXRr/DH","ApplicationGraph"),Object.defineProperty(o,"__esModule",{value:!0}),o.ApplicationGraph=void 0;var n=e("./board/controllers/BoardLogicController"),i=e("./board/controllers/BoardRuntimeController"),r=e("./board/models/BoardRuntimeModel"),s=e("./state/controllers/GameStateController"),a=function(){return function(e,t){this.runtimeModel=new r.BoardRuntimeModel,this.runtimeController=new i.BoardRuntimeController(e,t,this.runtimeModel),this.logicController=new n.BoardLogicController(e,t,this.runtimeModel),this.stateController=new s.GameStateController(e,t)}}();o.ApplicationGraph=a,cc._RF.pop()},{"./board/controllers/BoardLogicController":"BoardLogicController","./board/controllers/BoardRuntimeController":"BoardRuntimeController","./board/models/BoardRuntimeModel":"BoardRuntimeModel","./state/controllers/GameStateController":"GameStateController"}],BaseConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"ea6f1JcQhJESrskp1XVPg26","BaseConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigLoader=void 0;var i=e("../../core/config/ConfigLoader"),r=e("../../core/config/providers/JsonConfigProvider"),s=e("./ConfigMode"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.createProvider=function(e,t){switch(e){case s.ConfigMode.JSON:return new r.JsonConfigProvider(this.getJsonPath(),t);default:return this.getDefaultProvider()}},t}(i.ConfigLoader);o.BaseConfigLoader=a,cc._RF.pop()},{"../../core/config/ConfigLoader":"ConfigLoader","../../core/config/providers/JsonConfigProvider":"JsonConfigProvider","./ConfigMode":"ConfigMode"}],BaseConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"062f5ambD5N9JvTzMqt3cqH","BaseConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigProvider=void 0;var n=e("../../utils/assert"),i=function(){function e(){}return e.prototype.get=function(){return n.assertNotNull(this.config,this,"config"),this.config},e}();o.BaseConfigProvider=i,cc._RF.pop()},{"../../utils/assert":"assert"}],BaseController:[function(e,t,o){"use strict";cc._RF.push(t,"badd4D/MYpB0pfYbiXf2xQf","BaseController"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventController=void 0;var n=e("../../../../core/eventbus/SubscriptionGroup"),i=e("../../../../core/utils/assert"),r=function(){function e(e){this.eventBus=e,this._subscriptions=new n.SubscriptionGroup,this._initialized=!1}return e.prototype.init=function(){this._initialized||(this._initialized=!0,this.preInit(),this.onInit())},e.prototype.preInit=function(){i.assertNotNull(this.eventBus,this,"eventBus")},e.prototype.dispose=function(){this._initialized&&this.onDispose()},e.prototype.onDispose=function(){this._subscriptions.clear()},e.prototype.on=function(e,t){var o=this.eventBus.on(e,t);this._subscriptions.add(o)},e.prototype.emit=function(e){this.eventBus.emit(e)},e}();o.EventController=r,cc._RF.pop()},{"../../../../core/eventbus/SubscriptionGroup":"SubscriptionGroup","../../../../core/utils/assert":"assert"}],BasePool:[function(e,t,o){"use strict";cc._RF.push(t,"55005DLlvNEvbrWa1FtZwbp","BasePool"),Object.defineProperty(o,"__esModule",{value:!0}),o.BasePool=void 0;var n=function(){return function(){this._pool=[]}}();o.BasePool=n,cc._RF.pop()},{}],BaseView:[function(e,t,o){"use strict";cc._RF.push(t,"4e16boehWZGFq/TtEp4k1+v","BaseView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BaseView=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.validate=function(){},t}(cc.Component);o.BaseView=i,cc._RF.pop()},{}],BoardKey:[function(e,t,o){"use strict";cc._RF.push(t,"e7833BfyBNJiZr6GHlnxgBl","BoardKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardKey=void 0;var n=e("../../domain/board/models/TileType"),i=function(){function e(){}return e.position=function(e){return e.x+":"+e.y},e.type=function(e){return""+n.TileType[e]},e}();o.BoardKey=i,cc._RF.pop()},{"../../domain/board/models/TileType":"TileType"}],BoardLogicController:[function(e,t,o){"use strict";cc._RF.push(t,"27f27ZNaFVKF6d9yDnQ1YrV","BoardLogicController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<o;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)n[i]=r[s];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardLogicController=void 0;var r=e("../../../domain/board/events/BoardMutationsBatch"),s=e("../../../domain/board/events/mutations/TileMutationHelper"),a=e("../../../domain/board/events/mutations/TileRejected"),c=e("../../../domain/state/events/GameStateSync"),u=e("../../../domain/state/models/GameStateType"),l=e("../../../presentation/board/events/TileViewClicked"),p=e("../../common/controllers/BaseController"),d=e("../BoardKey"),f=function(e){function t(t,o,n){var i=e.call(this,t)||this;return i.onTileClicked=function(e){if(console.log("[BOARD CONTROL] click allowed: "+i.clickAllowed()+", state: "+u.GameStateType[i._gameStateModel.state]+", board is locked: "+i._boardRuntime.lockedBoard()),i.clickAllowed()){var t=i.build(e.position);i.emit(t)}},i._boardRuntime=n,i._boardInfo=o.boardInfo,i._gameStateModel=o.gameStateModel,i._logicModel=o.logicModel,i._tileRepository=o.tileRepository,i._spawnService=o.spawnService,i._searchService=o.searchService,i._destroyService=o.destroyService,i._moveService=o.moveService,i}return n(t,e),t.prototype.onInit=function(){console.log("[BOARD CONTROL] INIT COMMAND");var e=this._spawnService.spawn(),t=new r.BoardMutationsBatch(i(e));this.blockBoard(e),this.emit(t),console.log("[BOARD CONTROL] initial mutations: "+e.length),this.on(l.TileViewClicked,this.onTileClicked)},t.prototype.clickAllowed=function(){return this._gameStateModel.state===u.GameStateType.PLAYING&&!this._boardRuntime.lockedBoard()},t.prototype.build=function(e){console.log("[BOARD CONTROL] building...");var t=this._logicModel.get(e);if(console.log("[BOARD CONTROL] "+t+" at "+d.BoardKey.position(e)),!t)return this.reject("_",a.TileRejectedReason.NON_EXISTANT);if(!this._boardRuntime.lockedTile(t))return this.reject(t,a.TileRejectedReason.UNSTABLE);console.log("[BOARD CONTROL] accepted...");var o=this.findCluster(e);return console.log("[BOARD CONTROL] cluster of "+o.length),this.validCluster(o)?(console.log("[BOARD CONTROL] MUTATING"),this.mutate(o)):(console.log("[BOARD CONTROL] NOT valid, rejecting"),this._boardRuntime.addUnstable(t),this.reject(t,a.TileRejectedReason.NO_MATCH))},t.prototype.validCluster=function(e){return e.length>=this._boardInfo.clusterSize},t.prototype.findCluster=function(e){var t=this._boardRuntime.allUnstable();return this._searchService.findCluster(e,t)},t.prototype.mutate=function(e){var t=this._destroyService.destroy(e);console.log("[BOARD CONTROL] destroyed: "+t.length);var o=this._searchService.findDrops();console.log("[BOARD CONTROL] dropped: "+o.length),this._moveService.move(o);var n=this._spawnService.spawn();console.log("[BOARD CONTROL] spawned: "+n.length),this.emit(new c.GameStateSync(t.length));var s=i(t,o,n);return this.lockMutations(s),new r.BoardMutationsBatch(s)},t.prototype.lockMutations=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];this._boardRuntime.addUnstable(n.id)}},t.prototype.blockBoard=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];this._boardRuntime.addBlocker(n.id)}},t.prototype.reject=function(e,t){return new r.BoardMutationsBatch([s.TileMutationHelper.rejected(e,t)])},t}(p.EventController);o.BoardLogicController=f,cc._RF.pop()},{"../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../../domain/board/events/mutations/TileMutationHelper":"TileMutationHelper","../../../domain/board/events/mutations/TileRejected":"TileRejected","../../../domain/state/events/GameStateSync":"GameStateSync","../../../domain/state/models/GameStateType":"GameStateType","../../../presentation/board/events/TileViewClicked":"TileViewClicked","../../common/controllers/BaseController":"BaseController","../BoardKey":"BoardKey"}],BoardLogicModel:[function(e,t,o){"use strict";cc._RF.push(t,"41e01dqkI9LIKwApftjX2vt","BoardLogicModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardLogicModel=void 0;var n=e("../../../../core/collections/Matrix"),i=function(){function e(e,t){this.width=e,this.height=t,this._grid=new n.Matrix(this.width,this.height,function(){return null})}return e.prototype.register=function(e,t){this._grid.set(e.x,e.y,t)},e.prototype.move=function(e,t){var o=this._grid.get(e.x,e.y);o&&(this._grid.set(e.x,e.y,null),this._grid.set(t.x,t.y,o))},e.prototype.destroy=function(e){this._grid.get(e.x,e.y)&&this._grid.set(e.x,e.y,null)},e.prototype.get=function(e){return this._grid.get(e.x,e.y)},e.prototype.empty=function(e){return null===this._grid.get(e.x,e.y)},e}();o.BoardLogicModel=i,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix"}],BoardMutationsBatch:[function(e,t,o){"use strict";cc._RF.push(t,"9d99fTbKVFF9pbnBqDTUx0L","BoardMutationsBatch"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardMutationsBatch=void 0;var n=function(){return function(e){this.mutations=e}}();o.BoardMutationsBatch=n,cc._RF.pop()},{}],BoardRuntimeController:[function(e,t,o){"use strict";cc._RF.push(t,"8f35bQcKN5Myo0omYnLk7i5","BoardRuntimeController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRuntimeController=void 0;var i=e("../../../presentation/board/events/TileViewDestroyed"),r=e("../../../presentation/board/events/VisualTileStabilized"),s=function(e){function t(t,o,n){var i=e.call(this,t)||this;return i.onTileStabilized=function(e){i._runtimeModel.removeUnstable(e.id)},i._runtimeModel=n,i}return n(t,e),t.prototype.onInit=function(){var e=this;[r.VisualTileStabilized,i.VisualTileDestroyed].forEach(function(t){e.on(t,e.onTileStabilized)})},t}(e("../../common/controllers/BaseController").EventController);o.BoardRuntimeController=s,cc._RF.pop()},{"../../../presentation/board/events/TileViewDestroyed":"TileViewDestroyed","../../../presentation/board/events/VisualTileStabilized":"VisualTileStabilized","../../common/controllers/BaseController":"BaseController"}],BoardRuntimeModel:[function(e,t,o){"use strict";cc._RF.push(t,"d7305ApDc5MsIieMe5u/p5F","BoardRuntimeModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRuntimeModel=void 0;var n=function(){function e(){this._blockers=new Set,this._unstables=new Set}return e.prototype.lockedBoard=function(){return 0!==this._blockers.size},e.prototype.lockedTile=function(e){return!this._unstables.has(e)},e.prototype.addBlocker=function(e){this._blockers.add(e)},e.prototype.addUnstable=function(e){this._unstables.add(e)},e.prototype.removeUnstable=function(e){this.deleteUnstable(e),this.deleteBlocker(e)},e.prototype.allUnstable=function(){return new Set(this._unstables)},e.prototype.deleteBlocker=function(e){this._blockers.delete(e)},e.prototype.deleteUnstable=function(e){this._unstables.delete(e)},e.prototype.clear=function(){this._blockers.clear(),this._unstables.clear()},e}();o.BoardRuntimeModel=n,cc._RF.pop()},{}],BoardService:[function(e,t,o){"use strict";cc._RF.push(t,"84623Zdp3FDb4pT4zg1jwcO","BoardService"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardService=void 0;var n=function(){return function(e,t){this.logicModel=e,this.tileRepository=t}}();o.BoardService=n,cc._RF.pop()},{}],BoardViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"493d5P3Og5P2pe7KPcaugF9","BoardViewContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BoardViewContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.visualConfig=t.visualConfig,o.tweenSystem=t.tweenSystem,o.boardCols=t.boardCols,o.boardRows=t.boardRows,o}return n(t,e),t}(e("../../common/context/EventViewContext").EventViewContext);o.BoardViewContext=i,cc._RF.pop()},{"../../common/context/EventViewContext":"EventViewContext"}],BoardView:[function(e,t,o){"use strict";cc._RF.push(t,"bb883j+cbZB3Jz/i+gZlUKc","BoardView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardView=void 0;var r=e("../../../domain/board/events/BoardMutationsBatch"),s=e("../../common/assets/ShardAssets"),a=e("../../common/assets/TileAssets"),c=e("../../common/view/EventView"),u=e("../context/BoardViewContext"),l=e("../events/GameLoaded"),p=e("./InitialBatchGate"),d=e("./TileVisualOrchestrator"),f=cc._decorator,h=f.ccclass,_=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.backgroundLayer=null,t.tileLayer=null,t.fxLayer=null,t.tiles=null,t.shards=null,t.flash=null,t.onBoardMutated=function(e){console.log("[BOARD VIEW] DISPATCH RECIEVED"),t._startupGate.started?t._visualOrchestrator.dispatch(e):t._startupGate.register(e)},t.onGameLoaded=function(e){console.log("[BOARD VIEW] LOADED RECIEVED"),t._startupGate.proceed()},t}return n(t,e),t.prototype.contextConstructor=function(){return u.BoardViewContext},t.prototype.onInit=function(){var e=this;this._visualOrchestrator=new d.TileVisualOrchestrator(this.context.eventBus,this.context.visualConfig,this.context.tweenSystem,this.context.boardCols,this.context.boardRows,this.tileLayer,this.fxLayer,this.tiles,this.shards,this.flash),this._startupGate=new p.InitialBatchGate(function(t){return e._visualOrchestrator.init(t)});var t=this.context.boardCols*this.context.visualConfig.tileWidth,o=this.context.boardRows*this.context.visualConfig.tileHeight;console.log("[BOARD VIEW] "+this.context.visualConfig.boardWidthPadding+":"+this.context.visualConfig.boardHeightPadding),this.backgroundLayer.setContentSize(t+2*this.context.visualConfig.boardWidthPadding,o+2*this.context.visualConfig.boardHeightPadding),this.tileLayer.setContentSize(t,o),this.fxLayer.setContentSize(t,o),console.log("[BOARD VIEW] SUBSCRIBED"),this.on(r.BoardMutationsBatch,this.onBoardMutated),this.on(l.GameLoaded,this.onGameLoaded)},t.prototype.onDispose=function(){var e=this;this._visualOrchestrator.dispose(),this.scheduleOnce(function(){console.log("[DISPOSE] TILE LAYER AFTER",e.tileLayer.childrenCount)}),this.scheduleOnce(function(){console.log("[DISPOSE] LAYER AFTER",e.fxLayer.childrenCount)})},i([_(cc.Node)],t.prototype,"backgroundLayer",void 0),i([_(cc.Node)],t.prototype,"tileLayer",void 0),i([_(cc.Node)],t.prototype,"fxLayer",void 0),i([_(a.TileAssets)],t.prototype,"tiles",void 0),i([_(s.ShardAssets)],t.prototype,"shards",void 0),i([_(cc.Prefab)],t.prototype,"flash",void 0),t=i([h],t)}(c.EventView);o.BoardView=y,cc._RF.pop()},{"../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../common/assets/ShardAssets":"ShardAssets","../../common/assets/TileAssets":"TileAssets","../../common/view/EventView":"EventView","../context/BoardViewContext":"BoardViewContext","../events/GameLoaded":"GameLoaded","./InitialBatchGate":"InitialBatchGate","./TileVisualOrchestrator":"TileVisualOrchestrator"}],BoardVisualModel:[function(e,t,o){"use strict";cc._RF.push(t,"3ee0dXcdXhKYpOom0IludlY","BoardVisualModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardVisualModel=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.register=function(e){this._map.set(e.id,e)},e.prototype.get=function(e){return this._map.get(e)},e.prototype.remove=function(e){this._map.delete(e)},e}();o.BoardVisualModel=n,cc._RF.pop()},{}],BoosterTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"ad7953h5MNBzpo7ZXSfKW5B","BoosterTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BoosterTextView:[function(e,t,o){"use strict";cc._RF.push(t,"dcc03bxigNLbbmNh+rXSbxt","BoosterTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterTextView=void 0;var r=e("../../../domain/state/events/BoosterUsed"),s=e("../../common/view/DynamicTextView"),a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.contextConstructor=function(){throw new Error("Method not implemented.")},t.prototype.eventType=function(){return r.BoosterUsed},t.prototype.accept=function(e){return e.type===this.context.boosterType},t.prototype.format=function(e){return e.toString()},t=i([a],t)}(s.DynamicTextView);o.BoosterTextView=c,cc._RF.pop()},{"../../../domain/state/events/BoosterUsed":"BoosterUsed","../../common/view/DynamicTextView":"DynamicTextView"}],BoosterType:[function(e,t,o){"use strict";cc._RF.push(t,"3c793bmMw5KT6mmyB8Wrq1c","BoosterType"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterType=void 0,function(e){e[e.SWAP=0]="SWAP",e[e.BOMB=1]="BOMB"}(o.BoosterType||(o.BoosterType={})),cc._RF.pop()},{}],BoosterUsed:[function(e,t,o){"use strict";cc._RF.push(t,"5f07d/l/dBBr4eJ9+J4+NIN","BoosterUsed");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterUsed=void 0;var i=function(e){function t(t,o){var n=e.call(this,o)||this;return n.type=t,n}return n(t,e),t}(e("../../../../core/eventbus/ValueChangedEvent").ValueChangedEvent);o.BoosterUsed=i,cc._RF.pop()},{"../../../../core/eventbus/ValueChangedEvent":"ValueChangedEvent"}],BurstMotion:[function(e,t,o){"use strict";cc._RF.push(t,"f5f75KYHdhDNaczZhkojcUc","BurstMotion");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BurstMotion=void 0;var r=cc._decorator.ccclass,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._vx=0,t._vy=0,t._gravity=0,t._drag=1,t._av=0,t._duration=.5,t._fadeDelay=.7,t._shrinkScale=.2,t._elapsed=0,t._initialScale=1,t._fadeStartTime=0,t._running=!1,t}return n(t,e),t.prototype.play=function(e,t,o,n,i,r,s,a){this._elapsed=0,this._running=!0,this._initialScale=this.node.scale,this._vx=e,this._vy=t,this._gravity=o,this._drag=n,this._av=i,this._duration=r,this._fadeDelay=s,this._shrinkScale=a,this._fadeStartTime=this._duration*this._fadeDelay,this.node.opacity=255},t.prototype.update=function(e){if(this._running)if(this._elapsed+=e,this._elapsed>=this._duration)this._running=!1;else{this._vy-=this._gravity*e;var t=Math.pow(this._drag,60*e);if(this._vx*=t,this._vy*=t,this.node.x+=this._vx*e,this.node.y+=this._vy*e,this.node.angle+=this._av*e,this._elapsed>=this._fadeStartTime){var o=(this._elapsed-this._fadeStartTime)/(this._duration-this._fadeStartTime);this.node.opacity=255*(1-o),this.node.scale=cc.misc.lerp(this._initialScale,this._shrinkScale,o)}}},t=i([r],t)}(cc.Component);o.BurstMotion=s,cc._RF.pop()},{}],BurstSettings:[function(e,t,o){"use strict";cc._RF.push(t,"b50e4KT3o1MnIKRTwzF+X7h","BurstSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BurstTween:[function(e,t,o){"use strict";cc._RF.push(t,"c36e4v40tlLbZuTno/y2TSo","BurstTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.BurstTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.BURST}return e.prototype.build=function(e){return cc.tween(e.node).delay(e.duration)},e}();o.BurstTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],ColorRecord:[function(e,t,o){"use strict";cc._RF.push(t,"921e673GLNLxbPemaL16Gr7","ColorRecord");var n=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ColorRecord=void 0;var i=e("../../../domain/board/models/TileType"),r=cc._decorator,s=r.ccclass,a=r.property,c=function(){function e(){this.type=i.TileType.RED,this.color=cc.Color.WHITE}return n([a({type:cc.Enum(i.TileType)})],e.prototype,"type",void 0),n([a(cc.Color)],e.prototype,"color",void 0),e=n([s("ColorRecord")],e)}();o.ColorRecord=c,cc._RF.pop()},{"../../../domain/board/models/TileType":"TileType"}],ConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"4c42df3M+lCVb4rhi8GvaA4","ConfigLoader");var n=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigLoader=void 0;var r=function(){function e(){}return e.prototype.load=function(e){return n(this,void 0,Promise,function(){var t,o;return i(this,function(n){switch(n.label){case 0:return t=this.createValidator(),[4,(o=this.createProvider(e,t)).load()];case 1:return n.sent(),[2,o.get()]}})})},e}();o.ConfigLoader=r,cc._RF.pop()},{}],ConfigMode:[function(e,t,o){"use strict";cc._RF.push(t,"66980YuZY9M9oIcppGVJado","ConfigMode"),Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigMode=void 0,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.JSON=1]="JSON"}(o.ConfigMode||(o.ConfigMode={})),cc._RF.pop()},{}],ContextView:[function(e,t,o){"use strict";cc._RF.push(t,"9c93bf+0u9PVaZ2BjXiiCzz","ContextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ContextView=void 0;var i=e("../../../../core/utils/assert"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._initialized=!1,t}return n(t,e),t.prototype.init=function(e){this._initialized||(i.assertNotNull(e,this,"context"),this.context=e,this.preInit(),this.onInit(),this.postInit(),this._initialized=!0)},t.prototype.preInit=function(){},t.prototype.onInit=function(){},t.prototype.postInit=function(){},t.prototype.dispose=function(){this._initialized&&(this.onDispose(),this._initialized=!1)},t.prototype.onDestroy=function(){this.dispose()},t.prototype.onDispose=function(){},t}(e("./BaseView").BaseView);o.ContextView=r,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./BaseView":"BaseView"}],DefaultGameConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"0e7f8Ecjk9GCJWqdqp3Vi3B","DefaultGameConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultGameConfigProvider=void 0;var s=e("../../../core/config/providers/BaseConfigProvider"),a=e("../../domain/board/models/TileType"),c=e("../../domain/state/models/BoosterType"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){var e;return r(this,function(t){return e=new Map([[c.BoosterType.SWAP,3],[c.BoosterType.BOMB,3]]),this.config={board:{cols:8,rows:8,allowedTypes:[a.TileType.RED,a.TileType.GREEN,a.TileType.BLUE,a.TileType.PURPLE,a.TileType.YELLOW],clusterSize:3},gameState:{targetScore:500,maxMoves:20,scoreMultiplier:5,boosters:e}},[2]})})},t}(s.BaseConfigProvider);o.DefaultGameConfigProvider=u,cc._RF.pop()},{"../../../core/config/providers/BaseConfigProvider":"BaseConfigProvider","../../domain/board/models/TileType":"TileType","../../domain/state/models/BoosterType":"BoosterType"}],DefaultVisualConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"6146fuI6fNI1brorxqqlqYa","DefaultVisualConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultVisualConfigProvider=void 0;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){var e,t;return r(this,function(o){return e={minCount:6,maxCount:12,minUpVelocity:750,maxUpVelocity:1200,horizontalSpread:350,spawnRadius:120,minScale:.9,maxScale:1.3,minAngular:-900,maxAngular:900,gravity:3e3,dragMin:.94,dragMax:.985,duration:.9,fadeDelay:.7,shrinkScale:.9},t={delay:.1,bounce:10,bounceDuration:.08,settleDuration:.08},this.config={gravity:8,initialSpawnLine:8,normalSpawnLine:7,tileWidth:100,tileHeight:112,boardWidthPadding:42,boardHeightPadding:58,burst:e,drop:t},[2]})})},t}(e("../../../core/config/providers/BaseConfigProvider").BaseConfigProvider);o.DefaultVisualConfigProvider=s,cc._RF.pop()},{"../../../core/config/providers/BaseConfigProvider":"BaseConfigProvider"}],DestroyService:[function(e,t,o){"use strict";cc._RF.push(t,"2017bzN6wxEHaE6OOFvY8CH","DestroyService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyService=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.destroy=function(e){for(var t=[],o=0,n=e;o<n.length;o++){var i=n[o],r=this.logicModel.get(i);if(r){this.logicModel.destroy(i),console.log("[DESTROY SERVICE] destroying: "+r),this.tileRepository.remove(r);var s={kind:"tile.destroy",id:r,at:i,cause:"match"};t.push(s)}}return t},t}(e("./BoardService").BoardService);o.DestroyService=i,cc._RF.pop()},{"./BoardService":"BoardService"}],DestroyTween:[function(e,t,o){"use strict";cc._RF.push(t,"c98f3o5sHxEuoZWEnT0oT+2","DestroyTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.DESTROY}return e.prototype.build=function(e){var t=e.node,o=t.scale,n=t.opacity;return cc.tween(t).to(e.squashDuration,{scale:o*e.squashScale},{easing:"sineOut"}).to(e.popDuration,{scale:o*e.popScale},{easing:"quadOut"}).parallel(cc.tween().to(e.shrinkDuration,{opacity:e.shrinkOpacity}),cc.tween().to(e.shrinkDuration,{scale:o*e.shrinkScale})).call(function(){t.scale=o,t.opacity=n})},e}();o.DestroyTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],DestructionSettings:[function(e,t,o){"use strict";cc._RF.push(t,"1cdf0mn/rJGZrEhGF/HLoC/","DestructionSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DomainGraph:[function(e,t,o){"use strict";cc._RF.push(t,"41165Rc0RxJUIBr1pAhMjhn","DomainGraph"),Object.defineProperty(o,"__esModule",{value:!0}),o.DomainGraph=void 0;var n=e("./board/models/BoardLogicModel"),i=e("./board/models/TileFactory"),r=e("./board/models/TileRepository"),s=e("./board/services/DestroyService"),a=e("./board/services/MoveService"),c=e("./board/services/SearchService"),u=e("./board/services/SpawnService"),l=e("./state/models/GameStateModel"),p=e("./state/services/ScoreService"),d=function(){return function(e){this.boardInfo=e.board,this.stateInfo=e.gameState,this.gameStateModel=new l.GameStateModel(this.stateInfo),this.logicModel=new n.BoardLogicModel(this.boardInfo.cols,this.boardInfo.rows),this.tileRepository=new r.TileRepository,this.tileFactory=new i.TileFactory,this.scoreService=new p.ScoreService(this.stateInfo.scoreMultiplier),this.spawnService=new u.SpawnService(this.logicModel,this.tileRepository,this.tileFactory,this.boardInfo.allowedTypes),this.searchService=new c.SearchService(this.logicModel,this.tileRepository),this.destroyService=new s.DestroyService(this.logicModel,this.tileRepository),this.moveService=new a.MoveService(this.logicModel,this.tileRepository)}}();o.DomainGraph=d,cc._RF.pop()},{"./board/models/BoardLogicModel":"BoardLogicModel","./board/models/TileFactory":"TileFactory","./board/models/TileRepository":"TileRepository","./board/services/DestroyService":"DestroyService","./board/services/MoveService":"MoveService","./board/services/SearchService":"SearchService","./board/services/SpawnService":"SpawnService","./state/models/GameStateModel":"GameStateModel","./state/services/ScoreService":"ScoreService"}],DropMotions:[function(e,t,o){"use strict";cc._RF.push(t,"46fabfysjhOl5jltU0FVmIO","DropMotions");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.DropMotion=void 0;var r,s=cc._decorator.ccclass;(function(e){e[e.Idle=0]="Idle",e[e.Delay=1]="Delay",e[e.Drop=2]="Drop",e[e.BounceUp=3]="BounceUp",e[e.Settle=4]="Settle",e[e.Done=5]="Done"})(r||(r={}));var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._phase=r.Idle,t._fromY=0,t._toY=0,t._delay=0,t._bounce=0,t._bounceDuration=0,t._settleDuration=0,t._gravity=0,t._dropDuration=0,t._elapsed=0,t._running=!1,t._phaseTime=0,t._onDropped=null,t}return n(t,e),t.prototype.quadIn=function(e){return e*e},t.prototype.quadOut=function(e){return e*(2-e)},t.prototype.play=function(e,t,o,n,i,s,a){this._gravity=o,this._fromY=e,this._toY=t;var c=Math.abs(t-e);this._dropDuration=Math.sqrt(2*c/o),this._delay=n,this._bounce=i,this._bounceDuration=s,this._settleDuration=a,this.node.y=e,this._elapsed=0,this._phaseTime=0,this._running=!0,this._phase=n>0?r.Delay:r.Drop},Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!1,configurable:!0}),t.prototype.onDropped=function(e){this._onDropped=e},t.prototype.update=function(e){var t;if(this._running)switch(this._elapsed+=e,this._phaseTime+=e,this._phase){case r.Delay:this._phaseTime>=this._delay&&(this._phase=r.Drop,this._phaseTime=0);break;case r.Drop:var o=Math.min(this._phaseTime/this._dropDuration,1),n=this.quadIn(o);this.node.y=this._fromY+(this._toY-this._fromY)*n,o>=1&&(this._phase=r.BounceUp,this._phaseTime=0);break;case r.BounceUp:o=Math.min(this._phaseTime/this._bounceDuration,1),n=this.quadOut(o);this.node.y=this._toY+this._bounce*n,o>=1&&(this._phase=r.Settle,this._phaseTime=0);break;case r.Settle:o=Math.min(this._phaseTime/this._settleDuration,1),n=this.quadIn(o);this.node.y=this._toY+this._bounce*(1-n),o>=1&&(this.node.y=this._toY,this._phase=r.Done,this._running=!1,null===(t=this._onDropped)||void 0===t||t.call(this),this._onDropped=null)}},t=i([s],t)}(cc.Component);o.DropMotion=a,cc._RF.pop()},{}],DropSettings:[function(e,t,o){"use strict";cc._RF.push(t,"d5b03ewPeJO5b6A2qxGH0/F","DropSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DropTween:[function(e,t,o){"use strict";cc._RF.push(t,"fafc8YvYKlCDpzTXkIP9ROC","DropTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DropTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.DROP}return e.prototype.build=function(e){return console.log("nigga i build"),cc.tween(e.node).delay(e.duration)},e}();o.DropTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],DynamicTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"243ecVuTBJBlo2DFPE2Htsc","DynamicTextViewContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.DynamicTextViewContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.initial=o.initialValue(),o}return n(t,e),t}(e("./EventViewContext").EventViewContext);o.DynamicTextViewContext=i,cc._RF.pop()},{"./EventViewContext":"EventViewContext"}],DynamicTextView:[function(e,t,o){"use strict";cc._RF.push(t,"0f168cD/SdDKqVh9wvhZVsP","DynamicTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.DynamicTextView=void 0;var r=e("../../../../core/utils/assert"),s=e("./EventView"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetLabel=null,t.onValueChanged=function(e){t.accept(e)&&t.render(e.value)},t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),r.assertNotNull(this.targetLabel,this,"targetLabel")},t.prototype.preInit=function(){e.prototype.preInit.call(this),r.assertNumber(this.context.initial,this,"initialValue")},t.prototype.onInit=function(){this.on(this.eventType(),this.onValueChanged)},t.prototype.postInit=function(){this.render(this.context.initial)},t.prototype.accept=function(e){return!0},t.prototype.render=function(e){this.targetLabel.string=this.format(e)},i([u(cc.Label)],t.prototype,"targetLabel",void 0),t=i([c],t)}(s.EventView);o.DynamicTextView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./EventView":"EventView"}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"4dd3bCOr0RC6b0g0I2ZgBu1","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventBus=void 0;var n=function(){function e(){this._listeners=new Map}return e.prototype.on=function(e,t){var o,n=this,i=null!==(o=this._listeners.get(e))&&void 0!==o?o:[];return i.push(t),this._listeners.set(e,i),{unsubscribe:function(){return n.off(e,t)}}},e.prototype.off=function(e,t){var o=this._listeners.get(e);if(o){var n=o.indexOf(t);-1!==n&&o.splice(n,1)}},e.prototype.emit=function(e){var t=this._listeners.get(e.constructor);if(t)for(var o=0,n=t;o<n.length;o++){(0,n[o])(e)}},e.prototype.clear=function(){this._listeners.clear()},e}();o.EventBus=n,cc._RF.pop()},{}],EventViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"c34d1GkKTNIir2ulEw3eXmO","EventViewContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.EventViewContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.eventBus=t.eventBus,o}return n(t,e),t}(e("../view/PresentationViewContext").PresentationViewContext);o.EventViewContext=i,cc._RF.pop()},{"../view/PresentationViewContext":"PresentationViewContext"}],EventView:[function(e,t,o){"use strict";cc._RF.push(t,"9dc55NMdhVDNaqP2Y3DA+nU","EventView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.EventView=void 0;var i=e("../../../../core/eventbus/SubscriptionGroup"),r=e("../../../../core/utils/assert"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subscriptions=new i.SubscriptionGroup,t}return n(t,e),t.prototype.preInit=function(){r.assertNotNull(this.context.eventBus,this,"eventBus")},t.prototype.onDispose=function(){this._subscriptions.clear()},t.prototype.on=function(e,t){var o=this.context.eventBus.on(e,t);this._subscriptions.add(o)},t.prototype.emit=function(e){this.context.eventBus.emit(e)},t}(e("./PresentationView").PresentationView);o.EventView=s,cc._RF.pop()},{"../../../../core/eventbus/SubscriptionGroup":"SubscriptionGroup","../../../../core/utils/assert":"assert","./PresentationView":"PresentationView"}],FadeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"a2c91O6FmtG0rsgupz9InLy","FadeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],FadeTween:[function(e,t,o){"use strict";cc._RF.push(t,"34a2dq1IHlDTZMhESV3iwgA","FadeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.FadeTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.FADE}return e.prototype.build=function(e){return cc.tween(e.node).delay(e.delay).to(e.duration,{opacity:e.opacity},{easing:"quadOut"})},e}();o.FadeTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],FlashSettings:[function(e,t,o){"use strict";cc._RF.push(t,"ce14a7MiV9JjKi/YJUb6NOO","FlashSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],FlashTween:[function(e,t,o){"use strict";cc._RF.push(t,"7a5bdfwNbNNyLEQtCKA8K0x","FlashTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.FlashTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.FLASH}return e.prototype.build=function(e){return cc.tween(e.node).to(e.durationIn,{opacity:e.peakOpacity,scale:e.node.scale*e.scaleIn}).to(e.durationOut,{opacity:0,scale:e.node.scale*e.scaleOut})},e}();o.FlashTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],GameConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"2ed19M0P9lLlIQPuWAJuIRx","GameConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigLoader=void 0;var i=e("../BaseConfigLoader"),r=e("./DefaultGameConfigProvider"),s=e("./GameConfigValidator"),a=e("../../settings/GameSettings"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return a.GameSettings.GAME_CONFIG},t.prototype.createValidator=function(){return new s.GameConfigValidator},t.prototype.getDefaultProvider=function(){return new r.DefaultGameConfigProvider},t}(i.BaseConfigLoader);o.GameConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultGameConfigProvider":"DefaultGameConfigProvider","./GameConfigValidator":"GameConfigValidator"}],GameConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"041e3xL6eVI+o3GAT8qc0ku","GameConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigValidator=void 0;var n=e("../../../core/utils/ensure"),i=e("../../domain/board/models/TileType"),r=e("../../domain/state/models/BoosterType"),s=function(){function e(){}return e.prototype.validate=function(e){var t=this,o=n.ensureObject(e,this,"raw"),s=n.ensureObject(o.board,this,"board"),a={cols:n.ensureNumber(s.cols,this,"board.cols"),rows:n.ensureNumber(s.rows,this,"board.rows"),clusterSize:n.ensureNumber(s.clusterSize,this,"board.cluster"),allowedTypes:n.ensureNonEmptyArray(s.allowedTypes,this,"board.types").map(function(e,o){return n.ensureEnumValue(i.TileType,e,t,"board.allowedTypes"+o)})},c=n.ensureObject(o.gameState,this,"gameState"),u=n.ensureNumber(c.targetScore,this,"gameState.targetScore"),l=n.ensureNumber(c.maxMoves,this,"gameState.maxMoves"),p=n.ensureNumber(c.scoreMultiplier,this,"gameState.scoreMultiplier"),d=n.ensureObject(c.boosters,this,"gameStateData.boosters"),f=new Map;console.log("boostersData",d);for(var h=0,_=Object.entries(d);h<_.length;h++){var y=_[h],v=y[0],m=y[1],b=n.ensureEnumValue(r.BoosterType,v,this,"gameState.boosters."+v),w=n.ensureNumber(m,this,"gameState.boosters."+v);f.set(b,w)}return{board:a,gameState:{targetScore:u,maxMoves:l,scoreMultiplier:p,boosters:f}}},e}();o.GameConfigValidator=s,cc._RF.pop()},{"../../../core/utils/ensure":"ensure","../../domain/board/models/TileType":"TileType","../../domain/state/models/BoosterType":"BoosterType"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"1b26eLVJPZKR4fSnAImer1v","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],GameContext:[function(e,t,o){"use strict";cc._RF.push(t,"64bc0LEG7ZINbxYKyD+r/S/","GameContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameContext=void 0;var n=e("../../core/eventbus/EventBus"),i=e("../application/ApplicationGraph"),r=e("../domain/DomainGraph"),s=e("../presentation/PresentationGraph"),a=function(){return function(e,t){this.eventBus=new n.EventBus,this.domain=new r.DomainGraph(e),this.application=new i.ApplicationGraph(this.eventBus,this.domain),this.presentation=new s.PresentationGraph(this.eventBus,t,e,this.domain)}}();o.GameContext=a,cc._RF.pop()},{"../../core/eventbus/EventBus":"EventBus","../application/ApplicationGraph":"ApplicationGraph","../domain/DomainGraph":"DomainGraph","../presentation/PresentationGraph":"PresentationGraph"}],GameEntry:[function(e,t,o){"use strict";cc._RF.push(t,"b0ca3TD77RJ4Zf8PJxueHcl","GameEntry");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameEntry=void 0;var r=e("../bootstrap/GameSession"),s=e("../presentation/PresentationInstaller"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.presentationInstaller=null,t}return n(t,e),t.prototype.start=function(){this.session=new r.GameSession(this.presentationInstaller),this.session.start()},t.prototype.onDestroy=function(){var e;null===(e=this.session)||void 0===e||e.dispose()},i([u(s.PresentationInstaller)],t.prototype,"presentationInstaller",void 0),t=i([c],t)}(cc.Component);o.GameEntry=l,cc._RF.pop()},{"../bootstrap/GameSession":"GameSession","../presentation/PresentationInstaller":"PresentationInstaller"}],GameLoaded:[function(e,t,o){"use strict";cc._RF.push(t,"4c71fuomwxKX5Y7qzfsikM6","GameLoaded"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoaded=void 0;var n=function(){return function(){}}();o.GameLoaded=n,cc._RF.pop()},{}],GameOverPopupContext:[function(e,t,o){"use strict";cc._RF.push(t,"09452f1NxREfoQiE8oKEnrv","GameOverPopupContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameOverPopupContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.tweenSystem=t.tweenSystem,o}return n(t,e),t}(e("../../common/context/EventViewContext").EventViewContext);o.GameOverPopupContext=i,cc._RF.pop()},{"../../common/context/EventViewContext":"EventViewContext"}],GameOverPopup:[function(e,t,o){"use strict";cc._RF.push(t,"cd3f0SAS6lDlaaeqMPmeS2d","GameOverPopup");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameOverPopup=void 0;var r=e("../../../domain/state/events/StateUpdate"),s=e("../../../domain/state/models/GameStateType"),a=e("../../board/events/GameRestartRequest"),c=e("../../common/animations/TweenSettings"),u=e("../../common/view/EventView"),l=e("../context/GameOverPopupContext"),p=e("./ScreenFade"),d=cc._decorator,f=d.ccclass,h=d.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screenFade=null,t.wonRoot=null,t.lostRoot=null,t._state=s.GameStateType.NONE,t.onStateUpdate=function(e){t._state=e.value,t.show()},t}return n(t,e),t.prototype.contextConstructor=function(){return l.GameOverPopupContext},t.prototype.onInit=function(){this.node.active=!1,this.on(r.StateUpdate,this.onStateUpdate)},t.prototype.request=function(){this.screenFade.fadeOut(),this.emit(new a.GameRestartRequset)},t.prototype.show=function(){this._state!==s.GameStateType.WON&&this._state!==s.GameStateType.LOST||(this.node.active=!0,this.wonRoot.active=this._state===s.GameStateType.WON,this.lostRoot.active=this._state===s.GameStateType.LOST,this.startAnimation())},t.prototype.hide=function(){this.node.active=!1},t.prototype.startAnimation=function(){this.screenFade.fadeIn(),this.context.tweenSystem.build(c.TweenSettings.fade(this.node,0,.25,255)).start()},i([h(p.ScreenFade)],t.prototype,"screenFade",void 0),i([h(cc.Node)],t.prototype,"wonRoot",void 0),i([h(cc.Node)],t.prototype,"lostRoot",void 0),t=i([f],t)}(u.EventView);o.GameOverPopup=_,cc._RF.pop()},{"../../../domain/state/events/StateUpdate":"StateUpdate","../../../domain/state/models/GameStateType":"GameStateType","../../board/events/GameRestartRequest":"GameRestartRequest","../../common/animations/TweenSettings":"TweenSettings","../../common/view/EventView":"EventView","../context/GameOverPopupContext":"GameOverPopupContext","./ScreenFade":"ScreenFade"}],GameRestartRequest:[function(e,t,o){"use strict";cc._RF.push(t,"fe7d9SbtqpINZT0mpkE9ll6","GameRestartRequest"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameRestartRequset=void 0;var n=function(){return function(){}}();o.GameRestartRequset=n,cc._RF.pop()},{}],GameSession:[function(e,t,o){"use strict";cc._RF.push(t,"14553TxHilH26iAYlc6GOpK","GameSession");var n=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameSession=void 0;var r=e("../config/game/GameConfigLoader"),s=e("../config/visual/VisualConfigLoader"),a=e("../presentation/board/events/GameRestartRequest"),c=e("../settings/GameSettings"),u=e("./GameContext"),l=function(){function e(e){var t=this;this._presentationInstaller=e,this._lifecycle=[],this.restart=function(){t.dispose(),t.start()}}return e.prototype.start=function(){return n(this,void 0,Promise,function(){var e,t,o;return i(this,function(n){switch(n.label){case 0:return e=c.GameSettings.CONFIG_MODE,[4,(new r.GameConfigLoader).load(e)];case 1:return t=n.sent(),[4,(new s.VisualConfigLoader).load(e)];case 2:return o=n.sent(),this._gameContext=new u.GameContext(t,o),this._presentationInstaller.prepare(this._gameContext.presentation),this._lifecycle=[this._presentationInstaller,this._gameContext.application.stateController,this._gameContext.application.logicController,this._gameContext.application.runtimeController],this._gameContext.eventBus.on(a.GameRestartRequset,this.restart),this.init(),[2]}})})},e.prototype.init=function(){this._lifecycle.forEach(function(e){return e.init()})},e.prototype.dispose=function(){var e;null===(e=this._gameContext)||void 0===e||e.eventBus.clear(),this._gameContext=null,this._lifecycle.forEach(function(e){return e.dispose()}),this._lifecycle=[]},e}();o.GameSession=l,cc._RF.pop()},{"../config/game/GameConfigLoader":"GameConfigLoader","../config/visual/VisualConfigLoader":"VisualConfigLoader","../presentation/board/events/GameRestartRequest":"GameRestartRequest","../settings/GameSettings":"GameSettings","./GameContext":"GameContext"}],GameSettings:[function(e,t,o){"use strict";cc._RF.push(t,"6d565FyS8BE1bBzNxD+96YT","GameSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameSettings=void 0;var n=e("../config/ConfigMode");o.GameSettings={CONFIG_MODE:n.ConfigMode.JSON,GAME_CONFIG:"configs/game-config",VISUAL_CONFIG:"configs/visual-config"},cc._RF.pop()},{"../config/ConfigMode":"ConfigMode"}],GameStateController:[function(e,t,o){"use strict";cc._RF.push(t,"8abc8oftaBD6qCBxj9JRRs9","GameStateController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateController=void 0;var i=e("../../../domain/state/events/GameStateSync"),r=e("../../../domain/state/events/MovesUpdate"),s=e("../../../domain/state/events/ScoreUpdate"),a=e("../../../domain/state/events/StateUpdate"),c=e("../../../domain/state/models/GameStateType"),u=function(e){function t(t,o){var n=e.call(this,t)||this;return n.onSync=function(e){if(!(e.destroyed<1)){var t=n._gameStateModel.state,o=n._gameStateModel.currentScore,i=n._gameStateModel.movesLeft;console.log("[GAME STATE] BEFORE "+c.GameStateType[t]+", "+o+", "+i),n._gameStateModel.addScore(n._scoreService.calculate(e.destroyed)),n._gameStateModel.currentScore>=n._gameStateModel.targetScore&&n._gameStateModel.setState(c.GameStateType.WON),n._gameStateModel.useMove(),0===n._gameStateModel.movesLeft&&n._gameStateModel.state!==c.GameStateType.WON&&n._gameStateModel.setState(c.GameStateType.LOST),o!==n._gameStateModel.currentScore&&n.emit(new s.ScoreUpdate(n._gameStateModel.currentScore)),i!==n._gameStateModel.movesLeft&&n.emit(new r.MovesUpdate(n._gameStateModel.movesLeft)),t!==n._gameStateModel.state&&n.emit(new a.StateUpdate(n._gameStateModel.state)),console.log("[GAME STATE] AFTER "+c.GameStateType[n._gameStateModel.state]+", "+n._gameStateModel.currentScore+", "+n._gameStateModel.movesLeft)}},n._stateInfo=o.stateInfo,n._gameStateModel=o.gameStateModel,n._scoreService=o.scoreService,n}return n(t,e),t.prototype.onInit=function(){this._gameStateModel.setState(c.GameStateType.PLAYING),this.on(i.GameStateSync,this.onSync)},t}(e("../../common/controllers/BaseController").EventController);o.GameStateController=u,cc._RF.pop()},{"../../../domain/state/events/GameStateSync":"GameStateSync","../../../domain/state/events/MovesUpdate":"MovesUpdate","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../../domain/state/events/StateUpdate":"StateUpdate","../../../domain/state/models/GameStateType":"GameStateType","../../common/controllers/BaseController":"BaseController"}],GameStateModel:[function(e,t,o){"use strict";cc._RF.push(t,"99471UrmwxBoYieGRlv584Z","GameStateModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateModel=void 0;var n=e("./GameStateType"),i=function(){function e(e){this.targetScore=e.targetScore,this.maxMoves=e.maxMoves,this._movesLeft=this.maxMoves,this._currentScore=0,this._stateType=n.GameStateType.NONE,this._boosters=new Map(e.boosters)}return Object.defineProperty(e.prototype,"movesLeft",{get:function(){return this._movesLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentScore",{get:function(){return this._currentScore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._stateType},enumerable:!1,configurable:!0}),e.prototype.addScore=function(e){this._currentScore+=e},e.prototype.useMove=function(){this._movesLeft--},e.prototype.setState=function(e){this._stateType=e},e.prototype.useBooster=function(e){var t=this._boosters.get(e);t&&0!==t&&this._boosters.set(e,t-1)},e}();o.GameStateModel=i,cc._RF.pop()},{"./GameStateType":"GameStateType"}],GameStateSync:[function(e,t,o){"use strict";cc._RF.push(t,"5f8a58DoyJKYaXL8lqaFZu+","GameStateSync"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateSync=void 0;var n=function(){return function(e){this.destroyed=e}}();o.GameStateSync=n,cc._RF.pop()},{}],GameStateType:[function(e,t,o){"use strict";cc._RF.push(t,"1d988esIF9J9rI4hJixXE/p","GameStateType"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateType=void 0,function(e){e[e.NONE=0]="NONE",e[e.PLAYING=1]="PLAYING",e[e.WON=2]="WON",e[e.LOST=3]="LOST"}(o.GameStateType||(o.GameStateType={})),cc._RF.pop()},{}],IConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"58c4c78lEFJBK0t7vKUhhpW","IConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"fd0b3vkXQdNkKrm68/euUS2","IConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfig:[function(e,t,o){"use strict";cc._RF.push(t,"8a20aZkj7NIib5OJO2YOEVQ","IConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IDisposable:[function(e,t,o){"use strict";cc._RF.push(t,"0d1f2BKAyRKradOcgIbpJtI","IDisposable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IEvent:[function(e,t,o){"use strict";cc._RF.push(t,"8fa1c68GtVNRKFHm/nx3oTX","IEvent"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IInitializable:[function(e,t,o){"use strict";cc._RF.push(t,"ee3c8BQs6BEYJwkQjEK6TMK","IInitializable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ILifecycle:[function(e,t,o){"use strict";cc._RF.push(t,"3f690Z62XBB6oxO6CI8lNvX","ILifecycle"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IPopup:[function(e,t,o){"use strict";cc._RF.push(t,"a312cKwmBlPr7RieDvOt0RW","IPopup"),cc._RF.pop()},{}],ITweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"651bbPMAMtJFrMr+hApoZfB","ITweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITween:[function(e,t,o){"use strict";cc._RF.push(t,"220bdQQ2z1EdpCtBl1xwWsI","ITween"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IValidatable:[function(e,t,o){"use strict";cc._RF.push(t,"16605S+cj5B/rtndFr9BxXG","IValidatable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],InitialBatchGate:[function(e,t,o){"use strict";cc._RF.push(t,"3a640fnMUpFI7/j8CU9yM9i","InitialBatchGate"),Object.defineProperty(o,"__esModule",{value:!0}),o.InitialBatchGate=void 0;var n=function(){function e(e){this.start=e,this._started=!1,this._loaded=!1,this._initialBatch=null}return Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!1,configurable:!0}),e.prototype.proceed=function(){this._loaded=!0,this.tryStart()},e.prototype.register=function(e){console.log("REGISTER started: "+this._started+", loaded: "+this._loaded+", "+this._initialBatch),this._started||this._initialBatch||(this._initialBatch=e,console.log("DONE REGISTER started: "+this._started+", loaded: "+this._loaded+", "+this._initialBatch),this.tryStart())},e.prototype.tryStart=function(){console.log("tryStart started: "+this._started+", loaded: "+this._loaded+", "+this._initialBatch),this._started||this._loaded&&this._initialBatch&&(this.start(this._initialBatch),this._started=!0,this._initialBatch=null)},e}();o.InitialBatchGate=n,cc._RF.pop()},{}],JsonConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"f53f10PjOVPJaepW1ma/Plz","JsonConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.JsonConfigProvider=void 0;var s=function(e){function t(t,o){var n=e.call(this)||this;return n._path=t,n._validator=o,n}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,this.loadJsonAsset(this._path)];case 1:return e=t.sent(),this.config=this._validator.validate(e.json),[2]}})})},t.prototype.loadJsonAsset=function(e){return new Promise(function(t,o){cc.resources.load(e,cc.JsonAsset,function(n,i){n||!i?o(new Error("[JsonGameConfigProvider] Failed to load: "+e+"\n"+n)):t(i)})})},t}(e("./BaseConfigProvider").BaseConfigProvider);o.JsonConfigProvider=s,cc._RF.pop()},{"./BaseConfigProvider":"BaseConfigProvider"}],LoadingScreenContext:[function(e,t,o){"use strict";cc._RF.push(t,"1dc16OUG8VPJbUSGv2p7UVO","LoadingScreenContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreenContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.tweenSystem=t.tweenSystem,o}return n(t,e),t}(e("../../common/context/EventViewContext").EventViewContext);o.LoadingScreenContext=i,cc._RF.pop()},{"../../common/context/EventViewContext":"EventViewContext"}],LoadingScreen:[function(e,t,o){"use strict";cc._RF.push(t,"8eae532yq1D6LNGk23cWIws","LoadingScreen");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreen=void 0;var r=e("../../board/events/GameLoaded"),s=e("../../board/events/PresentationReady"),a=e("../../common/animations/TweenSettings"),c=e("../../common/view/EventView"),u=e("../context/LoadingScreenContext"),l=cc._decorator,p=l.ccclass,d=l.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screenDelay=5,t.screenFadeOutDuration=.2,t.dots=[],t.dotsFadeInDuration=.5,t.dotsBetweenDelay=.15,t.dotsFadeOutDuration=.3,t.dotPauseBetweenLoops=.2,t.onPresentationReady=function(){console.log("[LOADING SCREEN] presentation READY"),t.fadeScreen()},t}return n(t,e),t.prototype.contextConstructor=function(){return u.LoadingScreenContext},t.prototype.onInit=function(){this.node.active=!0,this.node.opacity=255,this.resetDots(),this.startAnimation(),this.on(s.PresentationReady,this.onPresentationReady)},t.prototype.resetDots=function(){for(var e=0,t=this.dots;e<t.length;e++){t[e].opacity=0}},t.prototype.startAnimation=function(){var e=this;this._tween=cc.tween();for(var t=function(t){var n=o.dots[t];o._tween.delay(o.dotsBetweenDelay),o._tween.call(function(){return e.fadeDot(n)})},o=this,n=0;n<this.dots.length;n++)t(n);this._tween.delay(this.dotPauseBetweenLoops),this._tween=cc.tween(this.node).repeatForever(this._tween).start(),this.context.tweenSystem.track(this._tween)},t.prototype.fadeDot=function(e){this.context.tweenSystem.track(cc.tween(e).set({opacity:0}).to(this.dotsFadeInDuration,{opacity:255}).to(this.dotsFadeOutDuration,{opacity:0}).start())},t.prototype.fadeScreen=function(){var e=this;this.context.tweenSystem.build(a.TweenSettings.fade(this.node,this.screenDelay,this.screenFadeOutDuration,0)).call(function(){e._tween=null,console.log("[LOADING SCREEN] emit..."),e.emit(new r.GameLoaded)}).start()},i([d],t.prototype,"screenDelay",void 0),i([d],t.prototype,"screenFadeOutDuration",void 0),i([d([cc.Node])],t.prototype,"dots",void 0),i([d],t.prototype,"dotsFadeInDuration",void 0),i([d],t.prototype,"dotsBetweenDelay",void 0),i([d],t.prototype,"dotsFadeOutDuration",void 0),i([d],t.prototype,"dotPauseBetweenLoops",void 0),t=i([p],t)}(c.EventView);o.LoadingScreen=f,cc._RF.pop()},{"../../board/events/GameLoaded":"GameLoaded","../../board/events/PresentationReady":"PresentationReady","../../common/animations/TweenSettings":"TweenSettings","../../common/view/EventView":"EventView","../context/LoadingScreenContext":"LoadingScreenContext"}],Matrix:[function(e,t,o){"use strict";cc._RF.push(t,"320baWGsBZEno88utR9Y4nE","Matrix"),Object.defineProperty(o,"__esModule",{value:!0}),o.Matrix=void 0;var n=function(){function e(e,t,o){this._width=e,this._height=t,this._data=new Array(t);for(var n=0;n<t;n++){for(var i=new Array(e),r=0;r<e;r++)i[r]=o(r,n);this._data[n]=i}}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.get=function(e,t){return this._data[t][e]},e.prototype.set=function(e,t,o){this._data[t][e]=o},e.prototype.swap=function(e,t,o,n){var i=this._data[t][e];this._data[t][e]=this._data[n][o],this._data[n][o]=i},e.prototype.forEach=function(e){for(var t=0;t<this._height;t++)for(var o=0;o<this._width;o++)e(this._data[t][o],o,t)},e}();o.Matrix=n,cc._RF.pop()},{}],MoveService:[function(e,t,o){"use strict";cc._RF.push(t,"180c6G6rN9G/Iwx7rb1B39H","MoveService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MoveService=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.move=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];this.logicModel.get(n.from)&&this.logicModel.move(n.from,n.to)}},t}(e("./BoardService").BoardService);o.MoveService=i,cc._RF.pop()},{"./BoardService":"BoardService"}],MovesTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"edbdcH0xDlCDLhdQ15+puc6","MovesTextViewContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MovesTextViewContext=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.initialValue=function(){return this.presentation.movesLeft},t}(e("../../common/context/DynamicTextViewContext").DynamicTextViewContext);o.MovesTextViewContext=i,cc._RF.pop()},{"../../common/context/DynamicTextViewContext":"DynamicTextViewContext"}],MovesTextView:[function(e,t,o){"use strict";cc._RF.push(t,"d8aafGKJJ1BEZQfGSesrZxi","MovesTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.MovesTextView=void 0;var r=e("../../../domain/state/events/MovesUpdate"),s=e("../../common/view/DynamicTextView"),a=e("../context/MovesTextViewContext"),c=cc._decorator.ccclass,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.contextConstructor=function(){return a.MovesTextViewContext},t.prototype.eventType=function(){return r.MovesUpdate},t.prototype.format=function(e){return e.toString()},t=i([c],t)}(s.DynamicTextView);o.MovesTextView=u,cc._RF.pop()},{"../../../domain/state/events/MovesUpdate":"MovesUpdate","../../common/view/DynamicTextView":"DynamicTextView","../context/MovesTextViewContext":"MovesTextViewContext"}],MovesUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"bb92aCNWRxErro9vapvBuh4","MovesUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MovesUpdate=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/eventbus/ValueChangedEvent").ValueChangedEvent);o.MovesUpdate=i,cc._RF.pop()},{"../../../../core/eventbus/ValueChangedEvent":"ValueChangedEvent"}],NodePool:[function(e,t,o){"use strict";cc._RF.push(t,"79821SOFVZE2KP+FuCglcR7","NodePool");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.NodePool=void 0;var i=function(e){function t(t,o,n){var i=e.call(this)||this;i._prefab=t,i._parent=o;for(var r=0;r<n;r++){var s=i.create();s.active=!1,i._pool[r]=s}return i}return n(t,e),t.prototype.dispose=function(){this._pool.forEach(function(e){return e.destroy()}),this._pool=[]},t.prototype.pull=function(){var e=this._pool.pop();return e&&cc.isValid(e)||(e=this.create()),e.setParent(this._parent),e},t.prototype.release=function(e){e&&(cc.Tween.stopAllByTarget(e),e.active=!1,e.removeFromParent(),this._pool.push(e))},t.prototype.create=function(){var e=cc.instantiate(this._prefab);return e.setPosition(0,0),e.setScale(1,1),e.angle=0,e.opacity=255,e.active=!1,e},t}(e("./BasePool").BasePool);o.NodePool=i,cc._RF.pop()},{"./BasePool":"BasePool"}],PresentationGraph:[function(e,t,o){"use strict";cc._RF.push(t,"b00e7lZWJ1AmJODY9VBFYxz","PresentationGraph"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationGraph=void 0;var n=e("./common/animations/tweens/TweenSystem"),i=function(){return function(e,t,o,i){this.visualConfig=t,this.eventBus=e,this.tweenSystem=new n.TweenSystem,this.movesLeft=i.gameStateModel.movesLeft,this.targetScore=i.gameStateModel.targetScore,this.currentScore=i.gameStateModel.currentScore,this.boardCols=o.board.cols,this.boardRows=o.board.rows}}();o.PresentationGraph=i,cc._RF.pop()},{"./common/animations/tweens/TweenSystem":"TweenSystem"}],PresentationInstaller:[function(e,t,o){"use strict";cc._RF.push(t,"749e11emX9Nl6hA3CVBKdmW","PresentationInstaller");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationInstaller=void 0;var r=e("./board/events/PresentationReady"),s=e("./common/view/BaseView"),a=e("./common/view/PresentationView"),c=cc._decorator.ccclass,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.prepare=function(e){this._presentation=e},t.prototype.init=function(){this._views=this.node.getComponentsInChildren(a.PresentationView);for(var e=0,t=this._views;e<t.length;e++){var o=t[e],n=new(o.contextConstructor())(this._presentation);o.init(n)}this._presentation.eventBus.emit(new r.PresentationReady)},t.prototype.dispose=function(){this._presentation.tweenSystem.dispose(),this._views.forEach(function(e){return e.dispose()}),this._views=[]},t=i([c],t)}(s.BaseView);o.PresentationInstaller=u,cc._RF.pop()},{"./board/events/PresentationReady":"PresentationReady","./common/view/BaseView":"BaseView","./common/view/PresentationView":"PresentationView"}],PresentationReady:[function(e,t,o){"use strict";cc._RF.push(t,"4016b5BZYJKQ4tAffi0vSpn","PresentationReady"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationReady=void 0;var n=function(){return function(){}}();o.PresentationReady=n,cc._RF.pop()},{}],PresentationViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"1bd3aCzf0lCNKJsSMxSjFYb","PresentationViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationViewContext=void 0;var n=function(){return function(e){this.presentation=e}}();o.PresentationViewContext=n,cc._RF.pop()},{}],PresentationView:[function(e,t,o){"use strict";cc._RF.push(t,"73a291rN4xDypg1nxgLXNpC","PresentationView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationView=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("./ContextView").ContextView);o.PresentationView=i,cc._RF.pop()},{"./ContextView":"ContextView"}],SafeDropMap:[function(e,t,o){"use strict";cc._RF.push(t,"c37022szChNwLd+74Hk4RN5","SafeDropMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.SafeDropMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e,t){var o,n=null!==(o=this._map.get(e))&&void 0!==o?o:new Set;n.add(t),this._map.set(e,n),console.log("[DROP MAP] ADD at x:"+e+", now "+n.size)},e.prototype.subtract=function(e,t){var o=this._map.get(e);o&&(o.delete(t),console.log("[DROP MAP] SUBSTRACT at x:"+e+", now "+o.size))},e.prototype.get=function(e){var t=this._map.get(e);return t?t.size:0},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.SafeDropMap=n,cc._RF.pop()},{}],ScoreService:[function(e,t,o){"use strict";cc._RF.push(t,"ed1f8pLuO9IALBgNsqVtvjL","ScoreService"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreService=void 0;var n=function(){function e(e){this._scoreMultiplier=e}return e.prototype.calculate=function(e){return e*e*this._scoreMultiplier},e}();o.ScoreService=n,cc._RF.pop()},{}],ScoreTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"7af9aTEbmRII6sX9caFBjRn","ScoreTextViewContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreTextViewContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.targetScore=t.targetScore,o}return n(t,e),t.prototype.initialValue=function(){return this.presentation.currentScore},t}(e("../../common/context/DynamicTextViewContext").DynamicTextViewContext);o.ScoreTextViewContext=i,cc._RF.pop()},{"../../common/context/DynamicTextViewContext":"DynamicTextViewContext"}],ScoreTextView:[function(e,t,o){"use strict";cc._RF.push(t,"7bd0f5hs8VARYsgFprc1Aea","ScoreTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreTextView=void 0;var r=e("../../../../core/utils/assert"),s=e("../../../domain/state/events/ScoreUpdate"),a=e("../../common/view/DynamicTextView"),c=e("../context/ScoreTextViewContext"),u=cc._decorator.ccclass,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.contextConstructor=function(){return c.ScoreTextViewContext},t.prototype.eventType=function(){return s.ScoreUpdate},t.prototype.preInit=function(){e.prototype.preInit.call(this),r.assertNumber(this.context.targetScore,this,"initialValue")},t.prototype.format=function(e){return e+"/"+this.context.targetScore},t=i([u],t)}(a.DynamicTextView);o.ScoreTextView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../common/view/DynamicTextView":"DynamicTextView","../context/ScoreTextViewContext":"ScoreTextViewContext"}],ScoreUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"751d9buhcZDmq08o3hoKjZ/","ScoreUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreUpdate=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/eventbus/ValueChangedEvent").ValueChangedEvent);o.ScoreUpdate=i,cc._RF.pop()},{"../../../../core/eventbus/ValueChangedEvent":"ValueChangedEvent"}],ScreenFadeContext:[function(e,t,o){"use strict";cc._RF.push(t,"58c2cXsmpBJkYC/qp+muhhw","ScreenFadeContext");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ScreenFadeContext=void 0;var i=function(e){function t(t){var o=e.call(this,t)||this;return o.tweenSystem=t.tweenSystem,o}return n(t,e),t}(e("../../common/view/PresentationViewContext").PresentationViewContext);o.ScreenFadeContext=i,cc._RF.pop()},{"../../common/view/PresentationViewContext":"PresentationViewContext"}],ScreenFade:[function(e,t,o){"use strict";cc._RF.push(t,"4830fiy4tdETKoUvZ0kXBD2","ScreenFade");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ScreenFade=void 0;var r=e("../../common/animations/TweenSettings"),s=e("../../common/view/PresentationView"),a=e("../context/ScreenFadeContext"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetOpacity=140,t}return n(t,e),t.prototype.contextConstructor=function(){return a.ScreenFadeContext},t.prototype.onInit=function(){this.node.active=!1},t.prototype.fadeIn=function(){this.node.opacity=0,this.node.active=!0,this.context.tweenSystem.build(r.TweenSettings.fade(this.node,0,.25,this.targetOpacity)).start()},t.prototype.fadeOut=function(){var e=this;this.context.tweenSystem.build(r.TweenSettings.fade(this.node,0,.1,0)).call(function(){return e.node.active=!1}).start()},i([l],t.prototype,"targetOpacity",void 0),t=i([u],t)}(s.PresentationView);o.ScreenFade=p,cc._RF.pop()},{"../../common/animations/TweenSettings":"TweenSettings","../../common/view/PresentationView":"PresentationView","../context/ScreenFadeContext":"ScreenFadeContext"}],SearchService:[function(e,t,o){"use strict";cc._RF.push(t,"146bchEKatLLLIq9vBSpvaC","SearchService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SearchService=void 0;var i=e("../../../../core/collections/Matrix"),r=e("../models/TileType"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.findCluster=function(e,t){var o=this.logicModel.get(e);if(!o)return[];for(var n=this.tileRepository.get(o),s=[],a=new i.Matrix(this.logicModel.width,this.logicModel.height,function(){return!1}),c=[e];c.length>0&&n!==r.TileType.EMPTY;){var u=c.pop();if(u&&!a.get(u.x,u.y)){a.set(u.x,u.y,!0);var l=this.logicModel.get(u);l&&(t.has(l)||this.tileRepository.get(l)!==n||(s.push(u),c.push.apply(c,this.findNeighbors(u))))}}return s},t.prototype.findNeighbors=function(e){for(var t=[],o=0,n=[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}];o<n.length;o++){var i=n[o];i.x<0||i.y<0||i.x>=this.logicModel.width||i.y>=this.logicModel.height||t.push(i)}return t},t.prototype.findDrops=function(){for(var e=[],t=this.logicModel.width-1;t>=0;t--)for(var o=0,n=this.logicModel.height-1;n>=0;n--){var i={x:t,y:n};if(this.logicModel.empty(i))o++;else if(o>0){var r=this.logicModel.get(i);if(!r)continue;var s={kind:"tile.moved",id:r,from:i,to:{x:t,y:n+o},cause:"drop"};e.push(s)}}return e},t}(e("./BoardService").BoardService);o.SearchService=s,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix","../models/TileType":"TileType","./BoardService":"BoardService"}],ShakeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"e713e/x+YVACa7ott/cyQ50","ShakeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ShakeTween:[function(e,t,o){"use strict";cc._RF.push(t,"82609dFDHRKJZdRjD/ogRNx","ShakeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.ShakeTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.SHAKE}return e.prototype.build=function(e){var t=e.node.angle;return cc.tween(e.node).to(e.duration,{angle:t+e.amplitude}).to(2*e.duration,{angle:t-e.amplitude}).to(2*e.duration,{angle:t+e.amplitude}).to(e.duration,{angle:t})},e}();o.ShakeTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],ShardAssets:[function(e,t,o){"use strict";cc._RF.push(t,"d807c/ZvdlLxIOeuPL7Pjdl","ShardAssets");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ShardAssets=void 0;var r=e("../../../../core/utils/assert"),s=e("../../../../core/utils/random"),a=e("./ColorRecord"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prefab=null,t.sprites=[],t.colorRecords=[],t.colorMap=new Map,t}return n(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.colorRecords;e<t.length;e++){var o=t[e];this.colorMap.set(o.type,o.color)}},t.prototype.getPrefab=function(){return this.prefab},t.prototype.getSprite=function(){return this.sprites[s.Random.intRange(0,this.sprites.length)]},t.prototype.getColor=function(e){var t=this.colorMap.get(e);return r.assertNotNull(t,this,"color"),t},i([l(cc.Prefab)],t.prototype,"prefab",void 0),i([l([cc.SpriteFrame])],t.prototype,"sprites",void 0),i([l([a.ColorRecord])],t.prototype,"colorRecords",void 0),t=i([u],t)}(cc.Component);o.ShardAssets=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../../core/utils/random":"random","./ColorRecord":"ColorRecord"}],SpawnService:[function(e,t,o){"use strict";cc._RF.push(t,"c0001pCwYVP95cvO6tOSR2c","SpawnService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SpawnService=void 0;var i=function(e){function t(t,o,n,i){var r=e.call(this,t,o)||this;return r.factory=n,r.types=i,r}return n(t,e),t.prototype.spawn=function(){for(var e=[],t=0;t<this.logicModel.width;t++)for(var o=0;o<this.logicModel.height;o++){var n={x:t,y:o};if(!this.logicModel.get(n)){var i=this.randomType(),r=this.factory.create(i);this.logicModel.register(n,r.id),this.tileRepository.register(r.id,i);var s={kind:"tile.spawned",id:r.id,at:n,type:i};e.push(s)}}return e},t.prototype.randomType=function(){return this.types[Math.floor(Math.random()*this.types.length)]},t}(e("./BoardService").BoardService);o.SpawnService=i,cc._RF.pop()},{"./BoardService":"BoardService"}],StateUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"82fee7RjSJKA7WiawWb45fq","StateUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.StateUpdate=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/eventbus/ValueChangedEvent").ValueChangedEvent);o.StateUpdate=i,cc._RF.pop()},{"../../../../core/eventbus/ValueChangedEvent":"ValueChangedEvent"}],SubscriptionGroup:[function(e,t,o){"use strict";cc._RF.push(t,"18bfaE9+69Bu4GzKQB8eC60","SubscriptionGroup"),Object.defineProperty(o,"__esModule",{value:!0}),o.SubscriptionGroup=void 0;var n=function(){function e(){this._subscriptions=[]}return e.prototype.add=function(e){this._subscriptions.push(e)},e.prototype.clear=function(){for(var e=0,t=this._subscriptions;e<t.length;e++){t[e].unsubscribe()}this._subscriptions.length=0},e}();o.SubscriptionGroup=n,cc._RF.pop()},{}],Subscription:[function(e,t,o){"use strict";cc._RF.push(t,"e054aPiy9xJ/roTuUKhU0v3","Subscription"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileAssets:[function(e,t,o){"use strict";cc._RF.push(t,"4db3f6Nos5B9K7+VqraVTc/","TileAssets");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileAssets=void 0;var r=e("../../../../core/utils/assert"),s=e("../../../../core/utils/ensure"),a=e("../../../domain/board/models/TileType"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=null,t.empty=null,t.red=null,t.green=null,t.blue=null,t.purple=null,t.yellow=null,t.bomb=null,t}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.validate=function(){this._map=new Map([[a.TileType.EMPTY,s.ensureNotNull(this.empty,this,"EMPTY")],[a.TileType.RED,s.ensureNotNull(this.red,this,"RED")],[a.TileType.GREEN,s.ensureNotNull(this.green,this,"GREEN")],[a.TileType.BLUE,s.ensureNotNull(this.blue,this,"BLUE")],[a.TileType.PURPLE,s.ensureNotNull(this.purple,this,"PURPLE")],[a.TileType.YELLOW,s.ensureNotNull(this.yellow,this,"YELLOW")],[a.TileType.BOMB,s.ensureNotNull(this.bomb,this,"BOMB")]])},t.prototype.getPrefab=function(){return this.tile},t.prototype.getSprite=function(e){var t=this._map.get(e);return r.assertNotNull(t,this,"Sprite for type "+a.TileType[e]),t},i([l(cc.Prefab)],t.prototype,"tile",void 0),i([l(cc.SpriteFrame)],t.prototype,"empty",void 0),i([l(cc.SpriteFrame)],t.prototype,"red",void 0),i([l(cc.SpriteFrame)],t.prototype,"green",void 0),i([l(cc.SpriteFrame)],t.prototype,"blue",void 0),i([l(cc.SpriteFrame)],t.prototype,"purple",void 0),i([l(cc.SpriteFrame)],t.prototype,"yellow",void 0),i([l(cc.SpriteFrame)],t.prototype,"bomb",void 0),t=i([u],t)}(cc.Component);o.TileAssets=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../../core/utils/ensure":"ensure","../../../domain/board/models/TileType":"TileType"}],TileDestroyed:[function(e,t,o){"use strict";cc._RF.push(t,"1a542/xHkpO3K4fTYJWIYxc","TileDestroyed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileDestructionFxHolder:[function(e,t,o){"use strict";cc._RF.push(t,"3fc33hy+cBKaKNntQ5war44","TileDestructionFxHolder"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileDestructionFxHolder=void 0;var n=e("../../../../core/utils/assert"),i=e("../../../../core/utils/random"),r=e("../../common/animations/TweenSettings"),s=e("../../common/view/NodePool"),a=e("../../fx/BurstMotion"),c=function(){function e(e,t,o,n,i){this._burstInfo=e,this._tweenSystem=t,this._shards=o,this._shardPool=new s.NodePool(o.getPrefab(),n,i*e.maxCount)}return e.prototype.dispose=function(){console.log("[DISPOSE] shards pool:"),this._shardPool.dispose()},e.prototype.play=function(e,t){for(var o=this,s=i.Random.intRange(this._burstInfo.minCount,this._burstInfo.maxCount),c=function(s){var c=u._shardPool.pull(),l=u._shards.getSprite(),p=u._shards.getColor(t),d=cc.v3(i.Random.floatRange(-u._burstInfo.spawnRadius,u._burstInfo.spawnRadius),i.Random.floatRange(-u._burstInfo.spawnRadius,u._burstInfo.spawnRadius),0);c.active=!0,c.setPosition(e.clone().add(d));var f=c.getComponent(cc.Sprite);n.assertNotNull(f,u,"shard pool broken"),f.spriteFrame=l,c.color=p,c.scale=i.Random.floatRange(u._burstInfo.minScale,u._burstInfo.maxScale);var h=c.addComponent(a.BurstMotion),_=i.Random.floatRange(-u._burstInfo.horizontalSpread,u._burstInfo.horizontalSpread)*Math.PI/180,y=i.Random.floatRange(u._burstInfo.minUpVelocity,u._burstInfo.maxUpVelocity),v=Math.sin(_)*y,m=Math.cos(_)*y,b=u._burstInfo.gravity,w=i.Random.floatRange(u._burstInfo.dragMin,u._burstInfo.dragMax),g=i.Random.floatRange(u._burstInfo.minAngular,u._burstInfo.maxAngular),T=u._burstInfo.duration,S=u._burstInfo.fadeDelay,R=u._burstInfo.shrinkScale;h.play(v,m,b,w,g,T,S,R),u._tweenSystem.build(r.TweenSettings.burst(c,u._burstInfo.duration)).call(function(){return o._shardPool.release(c)}).start()},u=this,l=0;l<s;l++)c()},e}();o.TileDestructionFxHolder=c,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../../core/utils/random":"random","../../common/animations/TweenSettings":"TweenSettings","../../common/view/NodePool":"NodePool","../../fx/BurstMotion":"BurstMotion"}],TileFactory:[function(e,t,o){"use strict";cc._RF.push(t,"f5173b4yopNF56G2A/Gy+sM","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var n=function(){function e(){this._nextId=0}return e.prototype.create=function(e){return{id:"tile_"+this._nextId++,type:e}},e}();o.TileFactory=n,cc._RF.pop()},{}],TileFlashFxHolder:[function(e,t,o){"use strict";cc._RF.push(t,"cc770Mu7o9INJQ2/pFP0hYM","TileFlashFxHolder"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFlashFxHolder=void 0;var n=e("../../common/animations/TweenSettings"),i=e("../../common/view/NodePool"),r=function(){function e(e,t,o,n){this._tweenSystem=e,this._prefab=t,this._flashPool=new i.NodePool(this._prefab,o,n)}return e.prototype.dispose=function(){console.log("[DISPOSE] flash pool:"),this._flashPool.dispose()},e.prototype.play=function(e){var t=this,o=this._flashPool.pull();o.active=!0,o.setPosition(e),o.scale=1,o.opacity=0,this._tweenSystem.build(n.TweenSettings.flash(o)).call(function(){return t._flashPool.release(o)}).start()},e}();o.TileFlashFxHolder=r,cc._RF.pop()},{"../../common/animations/TweenSettings":"TweenSettings","../../common/view/NodePool":"NodePool"}],TileModel:[function(e,t,o){"use strict";cc._RF.push(t,"917c78DkrFDE6IMAgJyVb7P","TileModel"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMoved:[function(e,t,o){"use strict";cc._RF.push(t,"20fc60xOqNB5qltU9zcKtig","TileMoved"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMutationHelper:[function(e,t,o){"use strict";cc._RF.push(t,"ca548z/0P5D9YGKLCo3XCci","TileMutationHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileMutationHelper=void 0;var n=function(){function e(){}return e.rejected=function(e,t){return{kind:"tile.rejected",id:e,reason:t}},e.destroyed=function(e,t,o){return{kind:"tile.destroy",id:e,at:t,cause:o}},e.moved=function(e,t,o,n){return{kind:"tile.moved",id:e,from:t,to:o,cause:n}},e.spawned=function(e,t,o){return{kind:"tile.spawned",id:e,type:t,at:o}},e.transformed=function(e,t,o){return{kind:"tile.transformed",id:e,before:t,after:o}},e}();o.TileMutationHelper=n,cc._RF.pop()},{}],TileMutation:[function(e,t,o){"use strict";cc._RF.push(t,"4e77f3qoCpKXKR2amsmAHV/","TileMutation"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TilePosition:[function(e,t,o){"use strict";cc._RF.push(t,"e31ab1Szq1KkpQ2i09M9pA2","TilePosition"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileRejected:[function(e,t,o){"use strict";cc._RF.push(t,"4afe1hIvUdP2oIcsQgtGDqE","TileRejected"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRejectedReason=void 0,o.TileRejectedReason={NO_MATCH:"no_match",UNSTABLE:"unstable",NON_EXISTANT:"non_existant"},cc._RF.pop()},{}],TileRepository:[function(e,t,o){"use strict";cc._RF.push(t,"35350obStpNGJZk1bJk7MEK","TileRepository"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRepository=void 0;var n=function(){function e(){this._tiles=new Map}return e.prototype.register=function(e,t){this._tiles.set(e,t)},e.prototype.get=function(e){var t=this._tiles.get(e);return t||null},e.prototype.remove=function(e){this._tiles.delete(e)},e}();o.TileRepository=n,cc._RF.pop()},{}],TileSpawned:[function(e,t,o){"use strict";cc._RF.push(t,"d8b33ZW3klA5YiCWrnTZWSz","TileSpawned"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileTransformed:[function(e,t,o){"use strict";cc._RF.push(t,"745d4yYFSxPpKHxydqVXs3Z","TileTransformed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileType:[function(e,t,o){"use strict";cc._RF.push(t,"ff92aR8Ym9CB7br3M3C8KnH","TileType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e[e.EMPTY=0]="EMPTY",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=3]="BLUE",e[e.PURPLE=4]="PURPLE",e[e.YELLOW=5]="YELLOW",e[e.BOMB=6]="BOMB",e[e.SUPER_BOMB=7]="SUPER_BOMB",e[e.HORIZONTAL_ROCKET=8]="HORIZONTAL_ROCKET",e[e.VERTICAL_ROCKET=9]="VERTICAL_ROCKET"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],TileViewClicked:[function(e,t,o){"use strict";cc._RF.push(t,"a68acF83zxITq3p8hOpX+c1","TileViewClicked"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileViewClicked=void 0;var n=function(){return function(e){this.position=e}}();o.TileViewClicked=n,cc._RF.pop()},{}],TileViewDestroyed:[function(e,t,o){"use strict";cc._RF.push(t,"c7fa4fi2uVKK6vuk1q7QEge","TileViewDestroyed"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileDestroyed=void 0;var n=function(){return function(e){this.id=e}}();o.VisualTileDestroyed=n,cc._RF.pop()},{}],TileViewHolder:[function(e,t,o){"use strict";cc._RF.push(t,"7c652yRrktK96Jo7chUMkGs","TileViewHolder"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileViewHolder=void 0;var n=e("../../../../core/utils/assert"),i=e("../../common/view/NodePool"),r=e("./TileView"),s=function(){function e(e,t,o){this._tiles=e,this._map=new Map,this._pool=new i.NodePool(this._tiles.getPrefab(),t,o)}return e.prototype.dispose=function(){console.log("[DISPOSE] tile views: "+this._map.size),console.log("[DISzPOSE] tiles pool:"),this._pool.dispose()},e.prototype.pull=function(e,t){var o=this._pool.pull().getComponent(r.TileView);return n.assertNotNull(o,this,"pool is broken"),o.set(this._tiles.getSprite(t)),this._map.set(e,o),o},e.prototype.release=function(e){var t=this._map.get(e);t&&(this._pool.release(t.node),t.hide(),this._map.delete(e))},e}();o.TileViewHolder=s,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../common/view/NodePool":"NodePool","./TileView":"TileView"}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"0eda0LA+Q5BwrB21iLZDWRq","TileView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var r=e("../../../../core/utils/assert"),s=e("../../common/view/BaseView"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),r.assertNotNull(this.sprite,this,"Sprite")},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},t.prototype.set=function(e){this.sprite.spriteFrame=e},t.prototype.stabilize=function(){this.node.setScale(1,1),this.node.angle=0,this.node.opacity=255,this.node.active=!0},i([u(cc.Sprite)],t.prototype,"sprite",void 0),t=i([c],t)}(s.BaseView);o.TileView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../common/view/BaseView":"BaseView"}],TileVisualAgentFactory:[function(e,t,o){"use strict";cc._RF.push(t,"e178a4bXWpLJoM3hUJ+TCHM","TileVisualAgentFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgentFactory=void 0;var n=e("./TileVisualAgent"),i=function(){function e(e,t,o,n,i,r,s,a){this._visualConfig=e,this._eventBus=t,this._tweenSystem=o,this._pool=n,this._boardCols=i,this._boardRows=r,this._destructionFx=s,this._flashFx=a}return e.prototype.create=function(e,t){var o=this._pool.pull(e,t);return new n.TileVisualAgent(this._visualConfig,this._eventBus,this._tweenSystem,e,o,t,this._boardCols,this._boardRows,this._destructionFx,this._flashFx)},e}();o.TileVisualAgentFactory=i,cc._RF.pop()},{"./TileVisualAgent":"TileVisualAgent"}],TileVisualAgent:[function(e,t,o){"use strict";cc._RF.push(t,"0d826Kcf5hPF5BGQIQZpQiO","TileVisualAgent"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgent=void 0;var n=e("../../../application/board/BoardKey"),i=e("../../common/animations/TweenSettings"),r=e("../../utils/calc"),s=e("../events/TileViewClicked"),a=e("../events/TileViewDestroyed"),c=e("../events/VisualTileStabilized"),u=e("../../fx/DropMotions"),l=function(){function e(e,t,o,n,i,r,s,a,c,u){this._position=null,this._target=null,this._visualConfig=e,this._eventBus=t,this._tweenSystem=o,this._id=n,this._view=i,this._type=r,this._boardCols=s,this._boardRows=a,this._nodeWidth=i.node.width,this._nodeHeight=i.node.height,this._destructionFx=c,this._flashFx=u}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var e;return null!==(e=this._type)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){var e;return null!==(e=this._position)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var e;return null!==(e=this._target)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return this.view.getComponent(u.DropMotion).running},enumerable:!1,configurable:!0}),e.prototype.spawn=function(e,t,o,i){var r=this;this._position=t,this._target=o,console.log("[SPAWN] "+n.BoardKey.type(e)+" at "+n.BoardKey.position(o)+" with offset "+t);var s=this.local(t),a=this.local(o);this.prepare(s),this.subscribe();var c=this._view.getComponent(u.DropMotion);c.onDropped(function(){return r.landed(o)}),c.play(s.y,a.y,this._visualConfig.gravity,i,this._visualConfig.drop.bounce,this._visualConfig.drop.bounceDuration,this._visualConfig.drop.settleDuration)},e.prototype.drop=function(e,t){var o=this;if(this._position!==e){this._target=e;var n=this._view.getComponent(u.DropMotion),i=n.running?this.view.node.position:this.local(this._position),r=this.local(this._target);n.onDropped(function(){return o.landed(e)}),n.play(i.y,r.y,this._visualConfig.gravity,t,this._visualConfig.drop.bounce,this._visualConfig.drop.bounceDuration,this._visualConfig.drop.settleDuration),console.log("[AGENT] "+this.id+" is startng to move")}},e.prototype.destroy=function(){var e=this._view.node.position;this._destructionFx.play(e,this._type),this._flashFx.play(e),this.hide(),this.unsubscribe(),this._eventBus.emit(new a.VisualTileDestroyed(this._id))},e.prototype.shake=function(){var e=this;this._tweenSystem.build(i.TweenSettings.shake(this._view.node)).call(function(){e._eventBus.emit(new c.VisualTileStabilized(e._id,e._position))}).start()},e.prototype.prepare=function(e){this._view.stabilize(),this._view.node.setPosition(e),this._view.node.setSiblingIndex(this._target.y*this._boardCols+this._target.x),this._view.show()},e.prototype.subscribe=function(){this._view.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.unsubscribe=function(){this._view.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.hide=function(){this.view.hide()},e.prototype.landed=function(e){console.log("[LANDED] from: "+n.BoardKey.position(this._position)+" to: "+n.BoardKey.position(e)),this._position=e,this._eventBus.emit(new c.VisualTileStabilized(this._id,this._position))},e.prototype.onClick=function(){!this.busy&&this._position&&this._eventBus.emit(new s.TileViewClicked(this._position))},e.prototype.local=function(e){return r.getLocal(e,this._boardCols,this._boardRows,this._nodeWidth,this._nodeHeight)},e}();o.TileVisualAgent=l,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../common/animations/TweenSettings":"TweenSettings","../../fx/DropMotions":"DropMotions","../../utils/calc":"calc","../events/TileViewClicked":"TileViewClicked","../events/TileViewDestroyed":"TileViewDestroyed","../events/VisualTileStabilized":"VisualTileStabilized"}],TileVisualOrchestrator:[function(e,t,o){"use strict";cc._RF.push(t,"79985Ho6MlB3pAuxEpEnlOu","TileVisualOrchestrator"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualOrchestrator=void 0;var n=e("../../../application/board/BoardKey"),i=e("../../../domain/board/events/mutations/TileRejected"),r=e("../events/TileViewDestroyed"),s=e("../events/VisualTileStabilized"),a=e("./TileDestructionFxHolder"),c=e("./TileFlashFxHolder"),u=e("./BoardVisualModel"),l=e("./SafeDropMap"),p=e("./TileViewHolder"),d=e("./TileVisualAgentFactory"),f=function(){function e(e,t,o,n,i,f,h,_,y,v){var m=this;this.onTileStabilized=function(e){m._safeDropMap.subtract(e.position.x,e.id)},this.onTileDestroyed=function(e){m._tilePool.release(e.id),m._visualModel.remove(e.id)},this._eventBus=e,this._visualConfig=t,this._tweenSystem=o,this._boardCols=n,this._boardRows=i,this._tileLayer=f,this._fxLayer=h,this._tiles=_,this._shards=y,this._flash=v,this._visualModel=new u.BoardVisualModel,this._safeDropMap=new l.SafeDropMap;var b=this._boardCols*this._boardRows;this._tilePool=new p.TileViewHolder(this._tiles,this._tileLayer,b),this._destructionFx=new a.TileDestructionFxHolder(this._visualConfig.burst,this._tweenSystem,this._shards,this._fxLayer,b),this._flashFx=new c.TileFlashFxHolder(this._tweenSystem,this._flash,this._fxLayer,b),this._visualAgentFactory=new d.TileVisualAgentFactory(this._visualConfig,this._eventBus,this._tweenSystem,this._tilePool,this._boardCols,this._boardRows,this._destructionFx,this._flashFx),this._disposables=[this._tilePool,this._destructionFx,this._flashFx],this._layers=[this._tileLayer,this._fxLayer],this._eventBus.on(s.VisualTileStabilized,this.onTileStabilized),this._eventBus.on(r.VisualTileDestroyed,this.onTileDestroyed)}return e.prototype.dispose=function(){console.log("TILE LAYER BEFORE",this._tileLayer.childrenCount),console.log("FX LAYER BEFORE",this._fxLayer.childrenCount),this._eventBus.off(s.VisualTileStabilized,this.onTileStabilized),this._eventBus.off(r.VisualTileDestroyed,this.onTileDestroyed),this._disposables.forEach(function(e){return e.dispose()}),this._layers.forEach(function(e){return e.destroyAllChildren()})},e.prototype.init=function(e){var t=this;console.log("[DISPATCH] INIT COMMAND: "+e.mutations.length),e.mutations.forEach(function(e){if("tile.spawned"===e.kind){var o=t._visualAgentFactory.create(e.id,e.type);t._visualModel.register(o);var n={x:e.at.x,y:-e.at.y-t._visualConfig.initialSpawnLine};o.spawn(e.type,n,e.at,t.getDropDelay(n))}})},e.prototype.dispatch=function(e){console.log("[DISPATCH] DISPATCH COMMAND: "+e.mutations.length);for(var t=0,o=e.mutations;t<o.length;t++){if("tile.spawned"===(c=o[t]).kind){var r=this._visualAgentFactory.create(c.id,c.type);this._visualModel.register(r),this._safeDropMap.add(c.at.x,r.id)}}this._safeDropMap.forEach(function(e,t){return console.log("[DISPATCH] spawning "+e+" nodes in "+t+" column")}),console.log("[DISPATCH] mutations: "+e.mutations.length);for(var s=0,a=e.mutations;s<a.length;s++){var c;switch((c=a[s]).kind){case"tile.spawned":console.log("[DISPATCH] dispatching spawn at: "+n.BoardKey.position(c.at)+"; id: "+c.id);r=this._visualModel.get(c.id);var u=this._safeDropMap.get(c.at.x);if(console.log("[OFFSET CALCULCATED] "+u+" for "+c.at.x),!r)continue;console.log("[DISPATCH] SPAWN DISPATCHED");var l={x:c.at.x,y:c.at.y-u-this._visualConfig.normalSpawnLine};r.spawn(c.type,l,c.at,this.getDropDelay(l));break;case"tile.moved":if(console.log("[DISPATCH] dispatching move from: "+n.BoardKey.position(c.from)+"; to: "+n.BoardKey.position(c.to)+"; id: "+c.id),!(r=this._visualModel.get(c.id)))continue;console.log("[DISPATCH] MOVE DISPATCHED"),r.drop(c.to,this.getDropDelay(r.position));break;case"tile.destroy":if(console.log("[DISPATCH] dispatching destroy at: "+n.BoardKey.position(c.at)+"; id: "+c.id),!(r=this._visualModel.get(c.id)))continue;console.log("[DISPATCH] DESTROY DISPATCHED"),r.destroy();break;case"tile.transformed":if(!(r=this._visualModel.get(c.id)))continue;break;case"tile.rejected":if(console.log("[DISPATCH] rejected: "+c.reason),!(r=this._visualModel.get(c.id)))continue;c.reason==i.TileRejectedReason.NO_MATCH&&r.shake(),console.log("[DISPATCH] agent: "+r.id+"; position: "+n.BoardKey.position(r.position));break;default:throw new Error("Unsupported mutation kind: "+c.kind)}}},e.prototype.getDropDelay=function(e){return(this._boardRows-e.y)*this._visualConfig.drop.delay},e}();o.TileVisualOrchestrator=f,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../../domain/board/events/mutations/TileRejected":"TileRejected","../events/TileViewDestroyed":"TileViewDestroyed","../events/VisualTileStabilized":"VisualTileStabilized","./BoardVisualModel":"BoardVisualModel","./SafeDropMap":"SafeDropMap","./TileDestructionFxHolder":"TileDestructionFxHolder","./TileFlashFxHolder":"TileFlashFxHolder","./TileViewHolder":"TileViewHolder","./TileVisualAgentFactory":"TileVisualAgentFactory"}],TweenHelper:[function(e,t,o){"use strict";cc._RF.push(t,"2ee8fX9cuhK1rpLwq9wgYPG","TweenHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenHelper=void 0;var n=e("../../../../core/utils/assert"),i=e("./tweens/TweenType"),r=e("./tweens/DestroyTween"),s=e("./tweens/ShakeTween"),a=e("./tweens/DropTween"),c=e("./tweens/FadeTween"),u=e("./tweens/BurstTween"),l=e("./tweens/FlashTween"),p=function(){function e(){this._tweens=new Map,this.register()}return e.prototype.register=function(){this.add(new r.DestroyTween),this.add(new c.FadeTween),this.add(new a.DropTween),this.add(new s.ShakeTween),this.add(new u.BurstTween),this.add(new l.FlashTween)},e.prototype.add=function(e){this._tweens.set(e.type,e)},e.prototype.build=function(e){console.log("[TweenHelper] "+i.TweenType[e.type]);var t=this._tweens.get(e.type);return n.assertNotNull(t,this,"tween"),t.build(e)},e}();o.TweenHelper=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./tweens/BurstTween":"BurstTween","./tweens/DestroyTween":"DestroyTween","./tweens/DropTween":"DropTween","./tweens/FadeTween":"FadeTween","./tweens/FlashTween":"FlashTween","./tweens/ShakeTween":"ShakeTween","./tweens/TweenType":"TweenType"}],TweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"0181cXWOh9Oia7D8sqe+9Xy","TweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenSettings=void 0;var n=e("./tweens/TweenType"),i=function(){function e(){}return e.fade=function(e,t,o,i){return{type:n.TweenType.FADE,node:e,delay:t,duration:o,opacity:i}},e.drop=function(e,t){return{type:n.TweenType.DROP,node:e,duration:t}},e.destroy=function(e){return{type:n.TweenType.DESTROY,node:e,squashDuration:.05,squashScale:.95,popDuration:.03,popScale:1.2,shrinkDuration:.3,shrinkOpacity:0,shrinkScale:.2}},e.shake=function(e){return{type:n.TweenType.SHAKE,node:e,duration:.05,amplitude:8}},e.burst=function(e,t){return{type:n.TweenType.BURST,node:e,duration:t}},e.flash=function(e){return{type:n.TweenType.FLASH,node:e,durationIn:.12,scaleIn:1.1,durationOut:.17,scaleOut:1.6,peakOpacity:125}},e}();o.TweenSettings=i,cc._RF.pop()},{"./tweens/TweenType":"TweenType"}],TweenSystem:[function(e,t,o){"use strict";cc._RF.push(t,"c0517IszVpO7YNyI08eZTCO","TweenSystem"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenSystem=void 0;var n=e("../TweenHelper"),i=function(){function e(){this._active=new Set,this._helper=new n.TweenHelper}return e.prototype.build=function(e){var t=this._helper.build(e);return this.track(t),t},e.prototype.track=function(e){this._active.add(e)},e.prototype.dispose=function(){this.killAll()},e.prototype.killAll=function(){console.log("[DISPOSE] tween system: "+this._active.size),this._active.forEach(function(e){return e.stop()}),this._active.clear()},e}();o.TweenSystem=i,cc._RF.pop()},{"../TweenHelper":"TweenHelper"}],TweenType:[function(e,t,o){"use strict";cc._RF.push(t,"4816dhJDk9IGJvlwlnEfHAF","TweenType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenType=void 0,function(e){e[e.FADE=0]="FADE",e[e.DESTROY=1]="DESTROY",e[e.DROP=2]="DROP",e[e.SPAWN=3]="SPAWN",e[e.SHAKE=4]="SHAKE",e[e.BURST=5]="BURST",e[e.FLASH=6]="FLASH"}(o.TweenType||(o.TweenType={})),cc._RF.pop()},{}],ValueChangedEvent:[function(e,t,o){"use strict";cc._RF.push(t,"323e3lkPd9Nzq1jCSpLjod2","ValueChangedEvent"),Object.defineProperty(o,"__esModule",{value:!0}),o.ValueChangedEvent=void 0;var n=function(){return function(e){this.value=e}}();o.ValueChangedEvent=n,cc._RF.pop()},{}],VisualConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"e50a2oB6P5I3LE8/vlH/qdn","VisualConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigLoader=void 0;var i=e("../../settings/GameSettings"),r=e("../BaseConfigLoader"),s=e("./DefaultVisualConfigProvider"),a=e("./VisualConfigValidator"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return i.GameSettings.VISUAL_CONFIG},t.prototype.createValidator=function(){return new a.VisualConfigValidator},t.prototype.getDefaultProvider=function(){return new s.DefaultVisualConfigProvider},t}(r.BaseConfigLoader);o.VisualConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultVisualConfigProvider":"DefaultVisualConfigProvider","./VisualConfigValidator":"VisualConfigValidator"}],VisualConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"ddcd1tnRPpEvq6CNyVNi8FC","VisualConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigValidator=void 0;var n=e("../../../core/utils/ensure"),i=function(){function e(){}return e.prototype.validate=function(e){var t=n.ensureObject(e,this,"data"),o=n.ensureNumber(t.gravity,this,"data.baseDropTime"),i=n.ensureNumber(t.initialSpawnLine,this,"data.initialSpawnLine"),r=n.ensureNumber(t.normalSpawnLine,this,"data.normalSpawnLine"),s=n.ensureNumber(t.tileWidth,this,"data.nodeWidth"),a=n.ensureNumber(t.tileHeight,this,"data.nodeHeight"),c=n.ensureNumber(t.boardWidthPadding,this,"data.boardWidthPadding"),u=n.ensureNumber(t.boardHeightPadding,this,"data.boardWidthPadding"),l=n.ensureObject(t.burst,this,"data.burst"),p=n.ensureNumber(l.minCount,this,"burstData.minCount"),d=n.ensureNumber(l.maxCount,this,"burstData.maxCount"),f=n.ensureNumber(l.minUpVelocity,this,"burstData.minUpVelocity"),h=n.ensureNumber(l.maxUpVelocity,this,"burstData.maxUpVelocity"),_=n.ensureNumber(l.horizontalSpread,this,"burstData.horizontalSpread"),y=n.ensureNumber(l.spawnRadius,this,"burstData.spawnRadius"),v=n.ensureNumber(l.minScale,this,"burstData.minScale"),m=n.ensureNumber(l.maxScale,this,"burstData.maxScale"),b=n.ensureNumber(l.minAngular,this,"burstData.minAngular"),w=n.ensureNumber(l.maxAngular,this,"burstData.maxAngular"),g=n.ensureNumber(l.gravity,this,"burstData.burstGravity"),T=n.ensureNumber(l.dragMin,this,"burstData.dragMin"),S=n.ensureNumber(l.dragMax,this,"burstData.dragMax"),R=n.ensureNumber(l.duration,this,"burstData.duration"),O=n.ensureNumber(l.fadeDelay,this,"burstData.fadeDelay"),P=n.ensureNumber(l.shrinkScale,this,"burstData.shrinkScale"),C=n.ensureObject(t.drop,this,"data.drop");return{gravity:o,initialSpawnLine:i,normalSpawnLine:r,tileWidth:s,tileHeight:a,boardWidthPadding:c,boardHeightPadding:u,burst:{minCount:p,maxCount:d,minUpVelocity:f,maxUpVelocity:h,horizontalSpread:_,spawnRadius:y,minScale:v,maxScale:m,minAngular:b,maxAngular:w,gravity:g,dragMin:T,dragMax:S,duration:R,fadeDelay:O,shrinkScale:P},drop:{delay:n.ensureNumber(C.delay,this,"dropData.delay"),bounce:n.ensureNumber(C.bounce,this,"dropData.bounce"),bounceDuration:n.ensureNumber(C.bounceDuration,this,"dropData.bounceDuration"),settleDuration:n.ensureNumber(C.settleDuration,this,"dropData.settleDuration")}}},e}();o.VisualConfigValidator=i,cc._RF.pop()},{"../../../core/utils/ensure":"ensure"}],VisualConfig:[function(e,t,o){"use strict";cc._RF.push(t,"25d26/EYZxAhKvwNvzom8R5","VisualConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],VisualTileStabilized:[function(e,t,o){"use strict";cc._RF.push(t,"33614n0IExCibPAYVhvGcCN","VisualTileStabilized"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileStabilized=void 0;var n=function(){return function(e,t){this.id=e,this.position=t}}();o.VisualTileStabilized=n,cc._RF.pop()},{}],algorithms:[function(e,t,o){"use strict";cc._RF.push(t,"f5e52IzeiFOF7YptTC83Tpo","algorithms"),Object.defineProperty(o,"__esModule",{value:!0}),o.intersection=void 0,o.intersection=function(e,t,o){var n=new Set(t),i=new Set(o);return e.filter(function(e){return n.has(e)&&i.has(e)})},cc._RF.pop()},{}],assert:[function(e,t,o){"use strict";function n(e,t,o){var n;if(n="function"==typeof t?t.name:t.constructor.name,!e)throw new Error("["+n+"] "+o)}function i(e,t,o){n(Array.isArray(e),t,o+" must be an array")}function r(e,t,o){n(e.length>0,t,o+" must not be empty")}cc._RF.push(t,"3cb7d9OgnZEJaI/WU7/lNKX","assert"),Object.defineProperty(o,"__esModule",{value:!0}),o.assertNumber=o.assertObject=o.assertString=o.assertNonEmptyArray=o.assertArrayNotEmpty=o.assertArray=o.assertNotNull=o.assert=void 0,o.assert=n,o.assertNotNull=function(e,t,o){n(null!==e&&void 0!==e,t,o+" must not be null nor undefined")},o.assertArray=i,o.assertArrayNotEmpty=r,o.assertNonEmptyArray=function(e,t,o){i(e,t,o),r(e,t,o)},o.assertString=function(e,t,o){n("string"==typeof e,t,o+" must be string")},o.assertObject=function(e,t,o){n("object"==typeof e,t,o+" must be object")},o.assertNumber=function(e,t,o){n("number"==typeof e&&!Number.isNaN(e),t,o+" must be number")},cc._RF.pop()},{}],calc:[function(e,t,o){"use strict";function n(e,t,o,n){var i=-(e-1)*o/2,r=(t-1)*n/2;return cc.v2(i,r)}cc._RF.push(t,"64e8aSSlcZIUo+/VlXg2quw","calc"),Object.defineProperty(o,"__esModule",{value:!0}),o.getSpeed=o.getOrigin=o.getLocal=void 0,o.getLocal=function(e,t,o,i,r){var s=n(t,o,i,r);return cc.v2(s.x+e.x*i,s.y-e.y*r)},o.getOrigin=n,o.getSpeed=function(e,t){return e*t},cc._RF.pop()},{}],ensure:[function(e,t,o){"use strict";cc._RF.push(t,"4a80emCBIlPbY4kzmojZq/X","ensure"),Object.defineProperty(o,"__esModule",{value:!0}),o.ensureEnumValue=o.ensureNonEmptyArray=o.ensureObject=o.ensureNotNull=o.ensureNumber=void 0;var n=e("./assert");o.ensureNumber=function(e,t,o){return n.assertNumber(e,t,o),e},o.ensureNotNull=function(e,t,o){return n.assertNotNull(e,t,o),e},o.ensureObject=function(e,t,o){return n.assertObject(e,t,o),e},o.ensureNonEmptyArray=function(e,t,o){return n.assertNotNull(e,t,o),n.assertNonEmptyArray(e,t,o),e},o.ensureEnumValue=function(e,t,o,i){var r=e[t];return n.assert(void 0!==r,o,"Unknown "+i+': "'+t+'"'),r},cc._RF.pop()},{"./assert":"assert"}],random:[function(e,t,o){"use strict";cc._RF.push(t,"a5d9cezF4BFNIl1SShDyYsy","random"),Object.defineProperty(o,"__esModule",{value:!0}),o.Random=void 0;var n=function(){function e(){}return e.intRange=function(e,t){return e+Math.floor(Math.random()*(t-e))},e.floatRange=function(e,t){return e+Math.random()*(t-e)},e.float=function(){return Math.random()},e.pick=function(e){if(0===e.length)throw new Error("[Random] Cannot pick from empty array");return e[this.intRange(0,e.length)]},e}();o.Random=n,cc._RF.pop()},{}]},{},["Matrix","ConfigLoader","IConfig","IConfigValidator","BaseConfigProvider","IConfigProvider","JsonConfigProvider","EventBus","IEvent","Subscription","SubscriptionGroup","ValueChangedEvent","IDisposable","IInitializable","ILifecycle","IValidatable","algorithms","assert","ensure","random","ApplicationGraph","BoardKey","BoardLogicController","BoardRuntimeController","BoardRuntimeModel","BaseController","GameStateController","GameContext","GameSession","BaseConfigLoader","ConfigMode","DefaultGameConfigProvider","GameConfig","GameConfigLoader","GameConfigValidator","DefaultVisualConfigProvider","VisualConfig","VisualConfigLoader","VisualConfigValidator","DomainGraph","BoardMutationsBatch","TileDestroyed","TileMoved","TileMutation","TileMutationHelper","TileRejected","TileSpawned","TileTransformed","BoardLogicModel","TileFactory","TileModel","TilePosition","TileRepository","TileType","BoardService","DestroyService","MoveService","SearchService","SpawnService","BoosterUsed","GameStateSync","MovesUpdate","ScoreUpdate","StateUpdate","BoosterType","GameStateModel","GameStateType","ScoreService","GameEntry","PresentationGraph","PresentationInstaller","BoardViewContext","GameLoaded","GameRestartRequest","PresentationReady","TileViewClicked","TileViewDestroyed","VisualTileStabilized","AltitudeMap","BoardView","BoardVisualModel","InitialBatchGate","SafeDropMap","TileDestructionFxHolder","TileFlashFxHolder","TileView","TileViewHolder","TileVisualAgent","TileVisualAgentFactory","TileVisualOrchestrator","TweenHelper","TweenSettings","BurstSettings","DestructionSettings","DropSettings","FadeSettings","FlashSettings","ITweenSettings","ShakeSettings","BurstTween","DestroyTween","DropTween","FadeTween","FlashTween","ITween","ShakeTween","TweenSystem","TweenType","ColorRecord","ShardAssets","TileAssets","DynamicTextViewContext","EventViewContext","BasePool","BaseView","ContextView","DynamicTextView","EventView","NodePool","PresentationView","PresentationViewContext","BurstMotion","DropMotions","BoosterTextViewContext","MovesTextViewContext","ScoreTextViewContext","BoosterTextView","MovesTextView","ScoreTextView","GameOverPopupContext","LoadingScreenContext","ScreenFadeContext","GameOverPopup","IPopup","LoadingScreen","ScreenFade","calc","GameSettings"]);