window.__require=function e(t,o,n){function r(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var u="function"==typeof __require&&__require;if(!a&&u)return u(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return r(t[s][1][e]||e)},l,l.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)r(n[s]);return r}({AltitudeMap:[function(e,t,o){"use strict";cc._RF.push(t,"988ee61LrlLxI8UCWKJq6dH","AltitudeMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.AltitudeMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e,t){this._map.set(e,t)},e.prototype.remove=function(e){this._map.set(e,null)},e.prototype.get=function(e){var t;return null!==(t=this._map.get(e))&&void 0!==t?t:null},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.AltitudeMap=n,cc._RF.pop()},{}],ApplicationGraph:[function(e,t,o){"use strict";cc._RF.push(t,"aec39C+01JLG6VYFxXRr/DH","ApplicationGraph"),Object.defineProperty(o,"__esModule",{value:!0}),o.ApplicationGraph=void 0;var n=e("./board/controllers/BoardLogicController"),r=e("./board/controllers/BoardRuntimeController"),i=e("./board/models/BoardRuntimeModel"),s=e("./state/controllers/GameStateController"),a=function(){return function(e,t){this.runtimeModel=new i.BoardRuntimeModel,this.runtimeController=new r.BoardRuntimeController(e,t,this.runtimeModel),this.logicController=new n.BoardLogicController(e,t,this.runtimeModel),this.stateController=new s.GameStateController(e,t)}}();o.ApplicationGraph=a,cc._RF.pop()},{"./board/controllers/BoardLogicController":"BoardLogicController","./board/controllers/BoardRuntimeController":"BoardRuntimeController","./board/models/BoardRuntimeModel":"BoardRuntimeModel","./state/controllers/GameStateController":"GameStateController"}],BaseConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"ea6f1JcQhJESrskp1XVPg26","BaseConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigLoader=void 0;var r=e("../../core/config/ConfigLoader"),i=e("../../core/config/providers/JsonConfigProvider"),s=e("./ConfigMode"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.createProvider=function(e,t){switch(e){case s.ConfigMode.JSON:return new i.JsonConfigProvider(this.getJsonPath(),t);default:return this.getDefaultProvider()}},t}(r.ConfigLoader);o.BaseConfigLoader=a,cc._RF.pop()},{"../../core/config/ConfigLoader":"ConfigLoader","../../core/config/providers/JsonConfigProvider":"JsonConfigProvider","./ConfigMode":"ConfigMode"}],BaseConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"062f5ambD5N9JvTzMqt3cqH","BaseConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigProvider=void 0;var n=e("../../utils/assert"),r=function(){function e(){}return e.prototype.get=function(){return n.assertNotNull(this.config,this,"config"),this.config},e}();o.BaseConfigProvider=r,cc._RF.pop()},{"../../utils/assert":"assert"}],BaseController:[function(e,t,o){"use strict";cc._RF.push(t,"badd4D/MYpB0pfYbiXf2xQf","BaseController"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseController=void 0;var n=function(){function e(){this._initialized=!1}return e.prototype.init=function(){this._initialized||(this._initialized=!0,this.onInit())},e.prototype.dispose=function(){this._initialized&&this.onDispose()},e.prototype.onDispose=function(){},e}();o.BaseController=n,cc._RF.pop()},{}],BoardKey:[function(e,t,o){"use strict";cc._RF.push(t,"e7833BfyBNJiZr6GHlnxgBl","BoardKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardKey=void 0;var n=e("../../domain/board/models/TileType"),r=function(){function e(){}return e.position=function(e){return e.x+":"+e.y},e.type=function(e){return""+n.TileType[e]},e}();o.BoardKey=r,cc._RF.pop()},{"../../domain/board/models/TileType":"TileType"}],BoardLogicController:[function(e,t,o){"use strict";cc._RF.push(t,"27f27ZNaFVKF6d9yDnQ1YrV","BoardLogicController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)n[r]=i[s];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardLogicController=void 0;var i=e("../../../../core/events/SubscriptionGroup"),s=e("../../../domain/board/events/BoardMutationsBatch"),a=e("../../../domain/board/events/mutations/TileMutationHelper"),c=e("../../../domain/board/events/mutations/TileRejected"),u=e("../../../domain/state/events/GameStateSync"),l=e("../../../domain/state/models/GameStateType"),p=e("../../../presentation/board/events/TileViewClicked"),d=e("../../common/controllers/BaseController"),f=e("../BoardKey"),h=function(e){function t(t,o,n){var r=e.call(this)||this;return r._subscriptions=new i.SubscriptionGroup,r.onTileClicked=function(e){if(console.log("[BOARD CONTROL] click allowed: "+r.clickAllowed()+", state: "+l.GameStateType[r._gameStateModel.state]+", board is locked: "+r._boardRuntime.lockedBoard()),r.clickAllowed()){var t=r.build(e.position);r._eventBus.emit(t)}},r._eventBus=t,r._boardRuntime=n,r._boardInfo=o.boardInfo,r._gameStateModel=o.gameStateModel,r._logicModel=o.logicModel,r._tileRepository=o.tileRepository,r._spawnService=o.spawnService,r._searchService=o.searchService,r._destroyService=o.destroyService,r._moveService=o.moveService,r}return n(t,e),t.prototype.onInit=function(){this._subscriptions.add(this._eventBus.on(p.TileViewClicked,this.onTileClicked))},t.prototype.clickAllowed=function(){return this._gameStateModel.state===l.GameStateType.PLAYING&&!this._boardRuntime.lockedBoard()},t.prototype.build=function(e){console.log("[BOARD CONTROL] building...");var t=this._logicModel.get(e);if(console.log("[BOARD CONTROL] "+t+" at "+f.BoardKey.position(e)),!t)return this.reject("_",c.TileRejectedReason.NON_EXISTANT);if(!this._boardRuntime.lockedTile(t))return this.reject(t,c.TileRejectedReason.UNSTABLE);console.log("[BOARD CONTROL] accepted...");var o=this.findCluster(e);return console.log("[BOARD CONTROL] cluster of "+o.length),this.validCluster(o)?(console.log("[BOARD CONTROL] MUTATING"),this.mutate(o)):(console.log("[BOARD CONTROL] NOT valid, rejecting"),this._boardRuntime.addUnstable(t),this.reject(t,c.TileRejectedReason.NO_MATCH))},t.prototype.validCluster=function(e){return e.length>=this._boardInfo.clusterSize},t.prototype.findCluster=function(e){var t=this._boardRuntime.allUnstable();return this._searchService.findCluster(e,t)},t.prototype.mutate=function(e){var t=this._destroyService.destroy(e);console.log("[BOARD CONTROL] destroyed: "+t.length);var o=this._searchService.findDrops();console.log("[BOARD CONTROL] dropped: "+o.length),this._moveService.move(o);var n=this._spawnService.spawn();console.log("[BOARD CONTROL] spawned: "+n.length),this._eventBus.emit(new u.GameStateSync(t.length));var i=r(t,o,n);return this.lockMutations(i),new s.BoardMutationsBatch(i)},t.prototype.lockMutations=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];this._boardRuntime.addUnstable(n.id)}},t.prototype.reject=function(e,t){return new s.BoardMutationsBatch([a.TileMutationHelper.rejected(e,t)])},t.prototype.dispose=function(){this._subscriptions.clear()},t}(d.BaseController);o.BoardLogicController=h,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../../domain/board/events/mutations/TileMutationHelper":"TileMutationHelper","../../../domain/board/events/mutations/TileRejected":"TileRejected","../../../domain/state/events/GameStateSync":"GameStateSync","../../../domain/state/models/GameStateType":"GameStateType","../../../presentation/board/events/TileViewClicked":"TileViewClicked","../../common/controllers/BaseController":"BaseController","../BoardKey":"BoardKey"}],BoardLogicModel:[function(e,t,o){"use strict";cc._RF.push(t,"41e01dqkI9LIKwApftjX2vt","BoardLogicModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardLogicModel=void 0;var n=e("../../../../core/collections/Matrix"),r=function(){function e(e,t){this.width=e,this.height=t,this._grid=new n.Matrix(this.width,this.height,function(){return null})}return e.prototype.register=function(e,t){this._grid.set(e.x,e.y,t)},e.prototype.move=function(e,t){var o=this._grid.get(e.x,e.y);o&&(this._grid.set(e.x,e.y,null),this._grid.set(t.x,t.y,o))},e.prototype.destroy=function(e){this._grid.get(e.x,e.y)&&this._grid.set(e.x,e.y,null)},e.prototype.get=function(e){return this._grid.get(e.x,e.y)},e.prototype.empty=function(e){return null===this._grid.get(e.x,e.y)},e}();o.BoardLogicModel=r,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix"}],BoardMutationsBatch:[function(e,t,o){"use strict";cc._RF.push(t,"9d99fTbKVFF9pbnBqDTUx0L","BoardMutationsBatch"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardMutationsBatch=void 0;var n=function(){return function(e){this.mutations=e}}();o.BoardMutationsBatch=n,cc._RF.pop()},{}],BoardRuntimeController:[function(e,t,o){"use strict";cc._RF.push(t,"8f35bQcKN5Myo0omYnLk7i5","BoardRuntimeController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRuntimeController=void 0;var r=e("../../../../core/events/SubscriptionGroup"),i=e("../../../presentation/board/events/TileViewDestroyed"),s=e("../../../presentation/board/events/VisualTileStabilized"),a=function(e){function t(t,o,n){var i=e.call(this)||this;return i._subscriptions=new r.SubscriptionGroup,i.onTileUnlocked=function(e){i._runtimeModel.removeUnstable(e.id)},i._eventBus=t,i._runtimeModel=n,i}return n(t,e),t.prototype.onInit=function(){var e=this;[s.VisualTileStabilized,i.VisualTileDestroyed].forEach(function(t){e._subscriptions.add(e._eventBus.on(t,e.onTileUnlocked))})},t.prototype.dispose=function(){this._subscriptions.clear()},t}(e("../../common/controllers/BaseController").BaseController);o.BoardRuntimeController=a,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../presentation/board/events/TileViewDestroyed":"TileViewDestroyed","../../../presentation/board/events/VisualTileStabilized":"VisualTileStabilized","../../common/controllers/BaseController":"BaseController"}],BoardRuntimeModel:[function(e,t,o){"use strict";cc._RF.push(t,"d7305ApDc5MsIieMe5u/p5F","BoardRuntimeModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRuntimeModel=void 0;var n=function(){function e(){this._blockers=new Set,this._unstables=new Set}return e.prototype.lockedBoard=function(){return 0!==this._blockers.size},e.prototype.lockedTile=function(e){return!this._unstables.has(e)},e.prototype.addBlocker=function(e){this._blockers.add(e)},e.prototype.addUnstable=function(e){this._unstables.add(e)},e.prototype.removeUnstable=function(e){this.deleteUnstable(e),this.deleteBlocker(e)},e.prototype.allUnstable=function(){return new Set(this._unstables)},e.prototype.deleteBlocker=function(e){this._blockers.delete(e)},e.prototype.deleteUnstable=function(e){this._unstables.delete(e)},e.prototype.clear=function(){this._blockers.clear(),this._unstables.clear()},e}();o.BoardRuntimeModel=n,cc._RF.pop()},{}],BoardService:[function(e,t,o){"use strict";cc._RF.push(t,"84623Zdp3FDb4pT4zg1jwcO","BoardService"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardService=void 0;var n=function(){return function(e,t){this.logicModel=e,this.tileRepository=t}}();o.BoardService=n,cc._RF.pop()},{}],BoardViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"493d5P3Og5P2pe7KPcaugF9","BoardViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BoardView:[function(e,t,o){"use strict";cc._RF.push(t,"bb883j+cbZB3Jz/i+gZlUKc","BoardView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardView=void 0;var i=e("../../../domain/board/events/BoardMutationsBatch"),s=e("../../common/assets/ShardAssets"),a=e("../../common/assets/TileAssets"),c=e("../../common/view/EventView"),u=e("../events/LoadingScreenFaded"),l=e("./TileVisualOrchestrator"),p=cc._decorator,d=p.ccclass,f=p.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.backgroundNode=null,t.backgroundLayer=null,t.tileLayer=null,t.fxLayer=null,t.tiles=null,t.shardAssets=null,t.flash=null,t.onBoardChanged=function(e){t._visualOrchestrator.dispatch(e)},t.onLoadingScreenFaded=function(e){t._visualOrchestrator.init(t.context.initialBoard)},t}return n(t,e),t.prototype.onInit=function(){this._visualOrchestrator=new l.TileVisualOrchestrator(this.context.eventBus,this.context.visualConfig,this.context.tweenHelper,this.context.boardCols,this.context.boardRows,this.backgroundLayer,this.tileLayer,this.fxLayer,this.tiles,this.shardAssets,this.flash),this.backgroundNode.width=this.context.boardCols*this.context.visualConfig.nodeWidth,this.backgroundNode.height=this.context.boardRows*this.context.visualConfig.nodeHeight,this.on(i.BoardMutationsBatch,this.onBoardChanged),this.on(u.LoadingScreenFaded,this.onLoadingScreenFaded)},r([f(cc.Node)],t.prototype,"backgroundNode",void 0),r([f(cc.Node)],t.prototype,"backgroundLayer",void 0),r([f(cc.Node)],t.prototype,"tileLayer",void 0),r([f(cc.Node)],t.prototype,"fxLayer",void 0),r([f(a.TileAssets)],t.prototype,"tiles",void 0),r([f(s.ShardAssets)],t.prototype,"shardAssets",void 0),r([f(cc.Prefab)],t.prototype,"flash",void 0),t=r([d],t)}(c.EventView);o.BoardView=h,cc._RF.pop()},{"../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../common/assets/ShardAssets":"ShardAssets","../../common/assets/TileAssets":"TileAssets","../../common/view/EventView":"EventView","../events/LoadingScreenFaded":"LoadingScreenFaded","./TileVisualOrchestrator":"TileVisualOrchestrator"}],BoardVisualModel:[function(e,t,o){"use strict";cc._RF.push(t,"3ee0dXcdXhKYpOom0IludlY","BoardVisualModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardVisualModel=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.register=function(e){this._map.set(e.id,e)},e.prototype.get=function(e){return this._map.get(e)},e.prototype.remove=function(e){this._map.delete(e)},e}();o.BoardVisualModel=n,cc._RF.pop()},{}],BombBoosterTextView:[function(e,t,o){"use strict";cc._RF.push(t,"88434/BgiJBpqNCjhb9dBF/","BombBoosterTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterTextView=void 0;var i=e("../../../domain/state/events/BoosterUsed"),s=e("../../common/view/DynamicTextView"),a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.eventType=function(){return i.BoosterUsed},t.prototype.accept=function(e){return e.type===this.context.boosterType},t.prototype.format=function(e){return e.toString()},t=r([a],t)}(s.DynamicTextView);o.BoosterTextView=c,cc._RF.pop()},{"../../../domain/state/events/BoosterUsed":"BoosterUsed","../../common/view/DynamicTextView":"DynamicTextView"}],BoosterTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"ad7953h5MNBzpo7ZXSfKW5B","BoosterTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BoosterType:[function(e,t,o){"use strict";cc._RF.push(t,"3c793bmMw5KT6mmyB8Wrq1c","BoosterType"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterType=void 0,function(e){e[e.SWAP=0]="SWAP",e[e.BOMB=1]="BOMB"}(o.BoosterType||(o.BoosterType={})),cc._RF.pop()},{}],BoosterUsed:[function(e,t,o){"use strict";cc._RF.push(t,"5f07d/l/dBBr4eJ9+J4+NIN","BoosterUsed");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterUsed=void 0;var r=function(e){function t(t,o){var n=e.call(this,o)||this;return n.type=t,n}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.BoosterUsed=r,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],BurstMotion:[function(e,t,o){"use strict";cc._RF.push(t,"3f6e1BOgJRPe4XWCkFtUykz","BurstMotion");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BurstMotion=void 0;var i=cc._decorator.ccclass,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vx=0,t.vy=0,t.gravity=0,t.drag=1,t.av=0,t.duration=.5,t.shrinkScale=.2,t._elapsed=0,t._initialScale=1,t._fadeStartTime=0,t._running=!1,t}return n(t,e),t.prototype.play=function(){this._elapsed=0,this._running=!0,this._initialScale=this.node.scale,this._fadeStartTime=.7*this.duration,this.node.opacity=255},t.prototype.update=function(e){if(this._running)if(this._elapsed+=e,this._elapsed>=this.duration)this.node.destroy();else{this.vy-=this.gravity*e;var t=Math.pow(this.drag,60*e);if(this.vx*=t,this.vy*=t,this.node.x+=this.vx*e,this.node.y+=this.vy*e,this.node.angle+=this.av*e,this._elapsed>=this._fadeStartTime){var o=(this._elapsed-this._fadeStartTime)/(this.duration-this._fadeStartTime);this.node.opacity=255*(1-o),this.node.scale=cc.misc.lerp(this._initialScale,this.shrinkScale,o)}}},t=r([i],t)}(cc.Component);o.BurstMotion=s,cc._RF.pop()},{}],BurstSettings:[function(e,t,o){"use strict";cc._RF.push(t,"b50e4KT3o1MnIKRTwzF+X7h","BurstSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BurstTween:[function(e,t,o){"use strict";cc._RF.push(t,"c36e4v40tlLbZuTno/y2TSo","BurstTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.BurstTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.BURST}return e.prototype.build=function(e){return cc.tween(e.node).delay(e.duration)},e}();o.BurstTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],ColorRecord:[function(e,t,o){"use strict";cc._RF.push(t,"921e673GLNLxbPemaL16Gr7","ColorRecord");var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ColorRecord=void 0;var r=e("../../../domain/board/models/TileType"),i=cc._decorator,s=i.ccclass,a=i.property,c=function(){function e(){this.type=r.TileType.RED,this.color=cc.Color.WHITE}return n([a({type:cc.Enum(r.TileType)})],e.prototype,"type",void 0),n([a(cc.Color)],e.prototype,"color",void 0),e=n([s("ColorRecord")],e)}();o.ColorRecord=c,cc._RF.pop()},{"../../../domain/board/models/TileType":"TileType"}],ConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"4c42df3M+lCVb4rhi8GvaA4","ConfigLoader");var n=this&&this.__awaiter||function(e,t,o,n){function r(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigLoader=void 0;var i=function(){function e(){}return e.prototype.load=function(e){return n(this,void 0,Promise,function(){var t,o;return r(this,function(n){switch(n.label){case 0:return t=this.createValidator(),[4,(o=this.createProvider(e,t)).load()];case 1:return n.sent(),[2,o.get()]}})})},e}();o.ConfigLoader=i,cc._RF.pop()},{}],ConfigMode:[function(e,t,o){"use strict";cc._RF.push(t,"66980YuZY9M9oIcppGVJado","ConfigMode"),Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigMode=void 0,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.JSON=1]="JSON"}(o.ConfigMode||(o.ConfigMode={})),cc._RF.pop()},{}],ContextView:[function(e,t,o){"use strict";cc._RF.push(t,"9c93bf+0u9PVaZ2BjXiiCzz","ContextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ContextView=void 0;var r=e("../../../../core/utils/assert"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._initialized=!1,t}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.onDestroy=function(){this.dispose()},t.prototype.validate=function(){},t.prototype.init=function(e){this._initialized||(r.assertNotNull(e,this,"context"),this.context=e,this.preInit(),this.onInit(),this.postInit(),this._initialized=!0)},t.prototype.preInit=function(){},t.prototype.onInit=function(){},t.prototype.postInit=function(){},t.prototype.dispose=function(){this._initialized&&(this.onDispose(),this._initialized=!1)},t.prototype.onDispose=function(){},t}(cc.Component);o.ContextView=i,cc._RF.pop()},{"../../../../core/utils/assert":"assert"}],DefaultGameConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"0e7f8Ecjk9GCJWqdqp3Vi3B","DefaultGameConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__awaiter||function(e,t,o,n){function r(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultGameConfigProvider=void 0;var s=e("../../../core/config/providers/BaseConfigProvider"),a=e("../../domain/board/models/TileType"),c=e("../../domain/state/models/BoosterType"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return r(this,void 0,Promise,function(){var e;return i(this,function(t){return e=new Map([[c.BoosterType.SWAP,3],[c.BoosterType.BOMB,3]]),this.config={board:{cols:8,rows:8,allowedTypes:[a.TileType.RED,a.TileType.GREEN,a.TileType.BLUE,a.TileType.PURPLE,a.TileType.YELLOW],clusterSize:3},gameState:{targetScore:500,maxMoves:20,scoreMultiplier:5,boosters:e}},[2]})})},t}(s.BaseConfigProvider);o.DefaultGameConfigProvider=u,cc._RF.pop()},{"../../../core/config/providers/BaseConfigProvider":"BaseConfigProvider","../../domain/board/models/TileType":"TileType","../../domain/state/models/BoosterType":"BoosterType"}],DefaultVisualConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"6146fuI6fNI1brorxqqlqYa","DefaultVisualConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__awaiter||function(e,t,o,n){function r(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultVisualConfigProvider=void 0;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return r(this,void 0,Promise,function(){var e;return i(this,function(t){return e={minCount:6,maxCount:12,minUpVelocity:750,maxUpVelocity:1200,horizontalSpread:350,spawnRadius:120,minScale:.9,maxScale:1.3,minAngular:-900,maxAngular:900,gravity:3e3,dragMin:.94,dragMax:.985,duration:.9,shrinkScale:.9},this.config={gravity:8,dropDelayParameter:.015,initialSpawnLine:8,normalSpawnLine:7,nodeWidth:100,nodeHeight:112,burst:e},[2]})})},t}(e("../../../core/config/providers/BaseConfigProvider").BaseConfigProvider);o.DefaultVisualConfigProvider=s,cc._RF.pop()},{"../../../core/config/providers/BaseConfigProvider":"BaseConfigProvider"}],DestroyService:[function(e,t,o){"use strict";cc._RF.push(t,"2017bzN6wxEHaE6OOFvY8CH","DestroyService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyService=void 0;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.destroy=function(e){for(var t=[],o=0,n=e;o<n.length;o++){var r=n[o],i=this.logicModel.get(r);if(i){this.logicModel.destroy(r),console.log("[DESTROY SERVICE] destroying: "+i),this.tileRepository.remove(i);var s={kind:"tile.destroy",id:i,at:r,cause:"match"};t.push(s)}}return t},t}(e("./BoardService").BoardService);o.DestroyService=r,cc._RF.pop()},{"./BoardService":"BoardService"}],DestroyTween:[function(e,t,o){"use strict";cc._RF.push(t,"c98f3o5sHxEuoZWEnT0oT+2","DestroyTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.DESTROY}return e.prototype.build=function(e){var t=e.node,o=t.scale,n=t.opacity;return cc.tween(t).to(e.squashDuration,{scale:o*e.squashScale},{easing:"sineOut"}).to(e.popDuration,{scale:o*e.popScale},{easing:"quadOut"}).parallel(cc.tween().to(e.shrinkDuration,{opacity:e.shrinkOpacity}),cc.tween().to(e.shrinkDuration,{scale:o*e.shrinkScale})).call(function(){t.scale=o,t.opacity=n})},e}();o.DestroyTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],DestructionSettings:[function(e,t,o){"use strict";cc._RF.push(t,"1cdf0mn/rJGZrEhGF/HLoC/","DestructionSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DomainGraph:[function(e,t,o){"use strict";cc._RF.push(t,"41165Rc0RxJUIBr1pAhMjhn","DomainGraph"),Object.defineProperty(o,"__esModule",{value:!0}),o.DomainGraph=void 0;var n=e("./board/models/BoardLogicModel"),r=e("./board/models/TileFactory"),i=e("./board/models/TileRepository"),s=e("./board/services/DestroyService"),a=e("./board/services/MoveService"),c=e("./board/services/SearchService"),u=e("./board/services/SpawnService"),l=e("./state/models/GameStateModel"),p=e("./state/services/ScoreService"),d=function(){return function(e){this.boardInfo=e.board,this.stateInfo=e.gameState,this.gameStateModel=new l.GameStateModel(this.stateInfo),this.logicModel=new n.BoardLogicModel(this.boardInfo.cols,this.boardInfo.rows),this.tileRepository=new i.TileRepository,this.tileFactory=new r.TileFactory,this.scoreService=new p.ScoreService(this.stateInfo.scoreMultiplier),this.spawnService=new u.SpawnService(this.logicModel,this.tileRepository,this.tileFactory,this.boardInfo.allowedTypes),this.searchService=new c.SearchService(this.logicModel,this.tileRepository),this.destroyService=new s.DestroyService(this.logicModel,this.tileRepository),this.moveService=new a.MoveService(this.logicModel,this.tileRepository)}}();o.DomainGraph=d,cc._RF.pop()},{"./board/models/BoardLogicModel":"BoardLogicModel","./board/models/TileFactory":"TileFactory","./board/models/TileRepository":"TileRepository","./board/services/DestroyService":"DestroyService","./board/services/MoveService":"MoveService","./board/services/SearchService":"SearchService","./board/services/SpawnService":"SpawnService","./state/models/GameStateModel":"GameStateModel","./state/services/ScoreService":"ScoreService"}],DropSettings:[function(e,t,o){"use strict";cc._RF.push(t,"d5b03ewPeJO5b6A2qxGH0/F","DropSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DropTween:[function(e,t,o){"use strict";cc._RF.push(t,"fafc8YvYKlCDpzTXkIP9ROC","DropTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DropTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.DROP}return e.prototype.build=function(e){var t=Math.abs(e.toY-e.fromY),o=Math.sqrt(2*t/e.gravity);return cc.tween(e.node).set({y:e.fromY}).delay(e.delay).to(o,{y:e.toY},{easing:"quadIn"}).to(e.bounceDuration,{y:e.toY+e.bounce},{easing:"quadOut"}).to(e.settleDuration,{y:e.toY},{easing:"quadIn"})},e}();o.DropTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],DynamicTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"243ecVuTBJBlo2DFPE2Htsc","DynamicTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DynamicTextView:[function(e,t,o){"use strict";cc._RF.push(t,"0f168cD/SdDKqVh9wvhZVsP","DynamicTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.DynamicTextView=void 0;var i=e("../../../../core/utils/assert"),s=e("./EventView"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetLabel=null,t.onValueChanged=function(e){t.accept(e)&&t.render(e.value)},t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),i.assertNotNull(this.targetLabel,this,"targetLabel")},t.prototype.preInit=function(){e.prototype.preInit.call(this),i.assertNumber(this.context.initialValue,this,"initialValue")},t.prototype.onInit=function(){this.on(this.eventType(),this.onValueChanged)},t.prototype.postInit=function(){this.render(this.context.initialValue)},t.prototype.accept=function(e){return!0},t.prototype.render=function(e){this.targetLabel.string=this.format(e)},r([u(cc.Label)],t.prototype,"targetLabel",void 0),t=r([c],t)}(s.EventView);o.DynamicTextView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./EventView":"EventView"}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"4dd3bCOr0RC6b0g0I2ZgBu1","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventBus=void 0;var n=function(){function e(){this._listeners=new Map}return e.prototype.on=function(e,t){var o,n=this,r=null!==(o=this._listeners.get(e))&&void 0!==o?o:[];return r.push(t),this._listeners.set(e,r),{unsubscribe:function(){return n.off(e,t)}}},e.prototype.off=function(e,t){var o=this._listeners.get(e);if(o){var n=o.indexOf(t);-1!==n&&o.splice(n,1)}},e.prototype.emit=function(e){var t=this._listeners.get(e.constructor);if(t)for(var o=0,n=t;o<n.length;o++){(0,n[o])(e)}},e.prototype.clear=function(){this._listeners.clear()},e}();o.EventBus=n,cc._RF.pop()},{}],EventViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"c34d1GkKTNIir2ulEw3eXmO","EventViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],EventView:[function(e,t,o){"use strict";cc._RF.push(t,"9dc55NMdhVDNaqP2Y3DA+nU","EventView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.EventView=void 0;var r=e("../../../../core/events/SubscriptionGroup"),i=e("../../../../core/utils/assert"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subscriptions=new r.SubscriptionGroup,t}return n(t,e),t.prototype.preInit=function(){i.assertNotNull(this.context.eventBus,this,"eventBus")},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this._subscriptions.clear()},t.prototype.on=function(e,t){var o=this.context.eventBus.on(e,t);this._subscriptions.add(o)},t.prototype.emit=function(e){this.context.eventBus.emit(e)},t}(e("./ContextView").ContextView);o.EventView=s,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../../core/utils/assert":"assert","./ContextView":"ContextView"}],FadeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"a2c91O6FmtG0rsgupz9InLy","FadeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],FadeTween:[function(e,t,o){"use strict";cc._RF.push(t,"34a2dq1IHlDTZMhESV3iwgA","FadeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.FadeTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.FADE}return e.prototype.build=function(e){return cc.tween(e.node).delay(e.delay).to(e.duration,{opacity:e.opacity},{easing:"quadOut"})},e}();o.FadeTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],FlashSettings:[function(e,t,o){"use strict";cc._RF.push(t,"ce14a7MiV9JjKi/YJUb6NOO","FlashSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],FlashTween:[function(e,t,o){"use strict";cc._RF.push(t,"7a5bdfwNbNNyLEQtCKA8K0x","FlashTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.FlashTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.FLASH}return e.prototype.build=function(e){return cc.tween(e.node).to(e.durationIn,{opacity:e.peakOpacity,scale:e.node.scale*e.scaleIn}).to(e.durationOut,{opacity:0,scale:e.node.scale*e.scaleOut}).call(function(){return e.node.destroy()})},e}();o.FlashTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],GameConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"2ed19M0P9lLlIQPuWAJuIRx","GameConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigLoader=void 0;var r=e("../BaseConfigLoader"),i=e("./DefaultGameConfigProvider"),s=e("./GameConfigValidator"),a=e("../../settings/GameSettings"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return a.GameSettings.GAME_CONFIG},t.prototype.createValidator=function(){return new s.GameConfigValidator},t.prototype.getDefaultProvider=function(){return new i.DefaultGameConfigProvider},t}(r.BaseConfigLoader);o.GameConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultGameConfigProvider":"DefaultGameConfigProvider","./GameConfigValidator":"GameConfigValidator"}],GameConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"041e3xL6eVI+o3GAT8qc0ku","GameConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigValidator=void 0;var n=e("../../../core/utils/ensure"),r=e("../../domain/board/models/TileType"),i=e("../../domain/state/models/BoosterType"),s=function(){function e(){}return e.prototype.validate=function(e){var t=this,o=n.ensureObject(e,this,"raw"),s=n.ensureObject(o.board,this,"board"),a={cols:n.ensureNumber(s.cols,this,"board.cols"),rows:n.ensureNumber(s.rows,this,"board.rows"),clusterSize:n.ensureNumber(s.clusterSize,this,"board.cluster"),allowedTypes:n.ensureNonEmptyArray(s.allowedTypes,this,"board.types").map(function(e,o){return n.ensureEnumValue(r.TileType,e,t,"board.allowedTypes"+o)})},c=n.ensureObject(o.gameState,this,"gameState"),u=n.ensureNumber(c.targetScore,this,"gameState.targetScore"),l=n.ensureNumber(c.maxMoves,this,"gameState.maxMoves"),p=n.ensureNumber(c.scoreMultiplier,this,"gameState.scoreMultiplier"),d=n.ensureObject(c.boosters,this,"gameStateData.boosters"),f=new Map;console.log("boostersData",d);for(var h=0,_=Object.entries(d);h<_.length;h++){var y=_[h],v=y[0],g=y[1],b=n.ensureEnumValue(i.BoosterType,v,this,"gameState.boosters."+v),w=n.ensureNumber(g,this,"gameState.boosters."+v);f.set(b,w)}return{board:a,gameState:{targetScore:u,maxMoves:l,scoreMultiplier:p,boosters:f}}},e}();o.GameConfigValidator=s,cc._RF.pop()},{"../../../core/utils/ensure":"ensure","../../domain/board/models/TileType":"TileType","../../domain/state/models/BoosterType":"BoosterType"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"1b26eLVJPZKR4fSnAImer1v","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],GameContext:[function(e,t,o){"use strict";cc._RF.push(t,"64bc0LEG7ZINbxYKyD+r/S/","GameContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameContext=void 0;var n=e("../../core/events/EventBus"),r=e("../application/ApplicationGraph"),i=e("../domain/DomainGraph"),s=function(){return function(e){this.eventBus=new n.EventBus,this.domain=new i.DomainGraph(e),this.app=new r.ApplicationGraph(this.eventBus,this.domain)}}();o.GameContext=s,cc._RF.pop()},{"../../core/events/EventBus":"EventBus","../application/ApplicationGraph":"ApplicationGraph","../domain/DomainGraph":"DomainGraph"}],GameEntry:[function(e,t,o){"use strict";cc._RF.push(t,"b0ca3TD77RJ4Zf8PJxueHcl","GameEntry");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameEntry=void 0;var i=e("../bootstrap/GameStartup"),s=e("../presentation/context/PresentationInstaller"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.presentationInstaller=null,t}return n(t,e),t.prototype.start=function(){this.startup=new i.GameStartup(this.presentationInstaller),this.startup.start()},t.prototype.onDestroy=function(){var e;null===(e=this.startup)||void 0===e||e.dispose()},r([u(s.PresentationInstaller)],t.prototype,"presentationInstaller",void 0),t=r([c],t)}(cc.Component);o.GameEntry=l,cc._RF.pop()},{"../bootstrap/GameStartup":"GameStartup","../presentation/context/PresentationInstaller":"PresentationInstaller"}],GameSettings:[function(e,t,o){"use strict";cc._RF.push(t,"6d565FyS8BE1bBzNxD+96YT","GameSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameSettings=void 0;var n=e("../config/ConfigMode");o.GameSettings={CONFIG_MODE:n.ConfigMode.JSON,GAME_CONFIG:"configs/game-config",VISUAL_CONFIG:"configs/visual-config"},cc._RF.pop()},{"../config/ConfigMode":"ConfigMode"}],GameStartup:[function(e,t,o){"use strict";cc._RF.push(t,"ff254STAfZKYa7pYw6iX8H9","GameStartup");var n=this&&this.__awaiter||function(e,t,o,n){function r(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameStartup=void 0;var i=e("../config/game/GameConfigLoader"),s=e("../config/visual/VisualConfigLoader"),a=e("../presentation/context/PresentationContext"),c=e("../settings/GameSettings"),u=e("./GameContext"),l=function(){function e(e){this.presentationInstaller=e}return e.prototype.start=function(){return n(this,void 0,Promise,function(){var e,t,o,n,l,p=this;return r(this,function(r){switch(r.label){case 0:return e=c.GameSettings.CONFIG_MODE,[4,(new i.GameConfigLoader).load(e)];case 1:return t=r.sent(),[4,(new s.VisualConfigLoader).load(e)];case 2:return o=r.sent(),this._gameContext=new u.GameContext(t),this._gameContext.app.stateController.init(),this._gameContext.app.logicController.init(),this._gameContext.app.runtimeController.init(),(n=this._gameContext.domain.spawnService.spawn()).forEach(function(e){return p._gameContext.app.runtimeModel.addBlocker(e.id)}),l=new a.PresentationContext(o,t,this._gameContext.eventBus,this._gameContext.domain.gameStateModel,n),this.presentationInstaller.init(l),[2]}})})},e.prototype.dispose=function(){this._gameContext.app.logicController.dispose(),this._gameContext.app.stateController.dispose(),this._gameContext.eventBus.clear()},e}();o.GameStartup=l,cc._RF.pop()},{"../config/game/GameConfigLoader":"GameConfigLoader","../config/visual/VisualConfigLoader":"VisualConfigLoader","../presentation/context/PresentationContext":"PresentationContext","../settings/GameSettings":"GameSettings","./GameContext":"GameContext"}],GameStateController:[function(e,t,o){"use strict";cc._RF.push(t,"8abc8oftaBD6qCBxj9JRRs9","GameStateController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateController=void 0;var r=e("../../../../core/events/SubscriptionGroup"),i=e("../../../domain/state/events/GameStateSync"),s=e("../../../domain/state/events/MovesUpdate"),a=e("../../../domain/state/events/ScoreUpdate"),c=e("../../../domain/state/events/StateUpdate"),u=e("../../../domain/state/models/GameStateType"),l=function(e){function t(t,o){var n=e.call(this)||this;return n._subscriptions=new r.SubscriptionGroup,n.onBoardProcessed=function(e){if(!(e.destroyed<1)){var t=n._gameStateModel.state,o=n._gameStateModel.currentScore,r=n._gameStateModel.movesLeft;console.log("[GAME STATE] BEFORE "+u.GameStateType[t]+", "+o+", "+r),n._gameStateModel.addScore(n._scoreService.calculate(e.destroyed)),n._gameStateModel.currentScore>=n._gameStateModel.targetScore&&n._gameStateModel.setState(u.GameStateType.WON),n._gameStateModel.useMove(),0===n._gameStateModel.movesLeft&&n._gameStateModel.state!==u.GameStateType.WON&&n._gameStateModel.setState(u.GameStateType.LOST),o!==n._gameStateModel.currentScore&&n._eventBus.emit(new a.ScoreUpdate(n._gameStateModel.currentScore)),r!==n._gameStateModel.movesLeft&&n._eventBus.emit(new s.MovesUpdate(n._gameStateModel.movesLeft)),t!==n._gameStateModel.state&&n._eventBus.emit(new c.StateUpdate(n._gameStateModel.state)),console.log("[GAME STATE] AFTER "+u.GameStateType[n._gameStateModel.state]+", "+n._gameStateModel.currentScore+", "+n._gameStateModel.movesLeft)}},n._eventBus=t,n._stateInfo=o.stateInfo,n._gameStateModel=o.gameStateModel,n._scoreService=o.scoreService,n}return n(t,e),t.prototype.onInit=function(){this._gameStateModel.setState(u.GameStateType.PLAYING),this._subscriptions.add(this._eventBus.on(i.GameStateSync,this.onBoardProcessed))},t.prototype.dispose=function(){this._subscriptions.clear()},t}(e("../../common/controllers/BaseController").BaseController);o.GameStateController=l,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../domain/state/events/GameStateSync":"GameStateSync","../../../domain/state/events/MovesUpdate":"MovesUpdate","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../../domain/state/events/StateUpdate":"StateUpdate","../../../domain/state/models/GameStateType":"GameStateType","../../common/controllers/BaseController":"BaseController"}],GameStateModel:[function(e,t,o){"use strict";cc._RF.push(t,"99471UrmwxBoYieGRlv584Z","GameStateModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateModel=void 0;var n=e("./GameStateType"),r=function(){function e(e){this.targetScore=e.targetScore,this.maxMoves=e.maxMoves,this._movesLeft=this.maxMoves,this._currentScore=0,this._stateType=n.GameStateType.NONE,this._boosters=new Map(e.boosters)}return Object.defineProperty(e.prototype,"movesLeft",{get:function(){return this._movesLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentScore",{get:function(){return this._currentScore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._stateType},enumerable:!1,configurable:!0}),e.prototype.addScore=function(e){this._currentScore+=e},e.prototype.useMove=function(){this._movesLeft--},e.prototype.setState=function(e){this._stateType=e},e.prototype.useBooster=function(e){var t=this._boosters.get(e);t&&0!==t&&this._boosters.set(e,t-1)},e}();o.GameStateModel=r,cc._RF.pop()},{"./GameStateType":"GameStateType"}],GameStateSync:[function(e,t,o){"use strict";cc._RF.push(t,"5f8a58DoyJKYaXL8lqaFZu+","GameStateSync"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateSync=void 0;var n=function(){return function(e){this.destroyed=e}}();o.GameStateSync=n,cc._RF.pop()},{}],GameStateType:[function(e,t,o){"use strict";cc._RF.push(t,"1d988esIF9J9rI4hJixXE/p","GameStateType"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateType=void 0,function(e){e[e.NONE=0]="NONE",e[e.PLAYING=1]="PLAYING",e[e.WON=2]="WON",e[e.LOST=3]="LOST"}(o.GameStateType||(o.GameStateType={})),cc._RF.pop()},{}],IConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"58c4c78lEFJBK0t7vKUhhpW","IConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"fd0b3vkXQdNkKrm68/euUS2","IConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfig:[function(e,t,o){"use strict";cc._RF.push(t,"8a20aZkj7NIib5OJO2YOEVQ","IConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IDisposable:[function(e,t,o){"use strict";cc._RF.push(t,"0d1f2BKAyRKradOcgIbpJtI","IDisposable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IEvent:[function(e,t,o){"use strict";cc._RF.push(t,"8fa1c68GtVNRKFHm/nx3oTX","IEvent"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IInitializable:[function(e,t,o){"use strict";cc._RF.push(t,"ee3c8BQs6BEYJwkQjEK6TMK","IInitializable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"651bbPMAMtJFrMr+hApoZfB","ITweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITween:[function(e,t,o){"use strict";cc._RF.push(t,"220bdQQ2z1EdpCtBl1xwWsI","ITween"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IValidatable:[function(e,t,o){"use strict";cc._RF.push(t,"16605S+cj5B/rtndFr9BxXG","IValidatable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],JsonConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"f53f10PjOVPJaepW1ma/Plz","JsonConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__awaiter||function(e,t,o,n){function r(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.JsonConfigProvider=void 0;var s=function(e){function t(t,o){var n=e.call(this)||this;return n._path=t,n._validator=o,n}return n(t,e),t.prototype.load=function(){return r(this,void 0,Promise,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.loadJsonAsset(this._path)];case 1:return e=t.sent(),this.config=this._validator.validate(e.json),[2]}})})},t.prototype.loadJsonAsset=function(e){return new Promise(function(t,o){cc.resources.load(e,cc.JsonAsset,function(n,r){n||!r?o(new Error("[JsonGameConfigProvider] Failed to load: "+e+"\n"+n)):t(r)})})},t}(e("./BaseConfigProvider").BaseConfigProvider);o.JsonConfigProvider=s,cc._RF.pop()},{"./BaseConfigProvider":"BaseConfigProvider"}],LoadingScreenContext:[function(e,t,o){"use strict";cc._RF.push(t,"b1e87OzaF5DF7z8FN3AvXer","LoadingScreenContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],LoadingScreenFaded:[function(e,t,o){"use strict";cc._RF.push(t,"8d5eeOI/TNJhYjvKHrtytGi","LoadingScreenFaded"),Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreenFaded=void 0;var n=function(){return function(){}}();o.LoadingScreenFaded=n,cc._RF.pop()},{}],LoadingScreen:[function(e,t,o){"use strict";cc._RF.push(t,"d8954Dv6jtN0qvl86oXQZgx","LoadingScreen");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreen=void 0;var i=e("../../board/events/LoadingScreenFaded"),s=e("../../board/events/PresentationReady"),a=e("../../common/animations/TweenSettings"),c=e("../../common/view/EventView"),u=cc._decorator,l=u.ccclass,p=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screen=null,t.screenDelay=5,t.screenFadeOutDuration=.2,t.dots=[],t.dotsFadeInDuration=.5,t.dotsBetweenDelay=.15,t.dotsFadeOutDuration=.3,t.dotPauseBetweenLoops=.2,t.onPresentationReady=function(){t.fadeScreen()},t}return n(t,e),t.prototype.onInit=function(){this.resetDots(),this.startAnimation(),this.on(s.PresentationReady,this.onPresentationReady)},t.prototype.resetDots=function(){for(var e=0,t=this.dots;e<t.length;e++){t[e].opacity=0}},t.prototype.startAnimation=function(){var e=this;this._tween=cc.tween();for(var t=function(t){var n=o.dots[t];o._tween.delay(o.dotsBetweenDelay),o._tween.call(function(){return e.fadeDot(n)})},o=this,n=0;n<this.dots.length;n++)t(n);this._tween.delay(this.dotPauseBetweenLoops),this._tween=cc.tween(this.screen).repeatForever(this._tween).start()},t.prototype.fadeDot=function(e){cc.tween(e).set({opacity:0}).to(this.dotsFadeInDuration,{opacity:255}).to(this.dotsFadeOutDuration,{opacity:0}).start()},t.prototype.fadeScreen=function(){var e=this;this.context.tweenHelper.build(a.TweenSettings.fade(this.screen,this.screenDelay,this.screenFadeOutDuration,0)).call(function(){e.emit(new i.LoadingScreenFaded),cc.Tween.stopAllByTarget(e.screen)}).start()},r([p(cc.Node)],t.prototype,"screen",void 0),r([p],t.prototype,"screenDelay",void 0),r([p],t.prototype,"screenFadeOutDuration",void 0),r([p([cc.Node])],t.prototype,"dots",void 0),r([p],t.prototype,"dotsFadeInDuration",void 0),r([p],t.prototype,"dotsBetweenDelay",void 0),r([p],t.prototype,"dotsFadeOutDuration",void 0),r([p],t.prototype,"dotPauseBetweenLoops",void 0),t=r([l],t)}(c.EventView);o.LoadingScreen=d,cc._RF.pop()},{"../../board/events/LoadingScreenFaded":"LoadingScreenFaded","../../board/events/PresentationReady":"PresentationReady","../../common/animations/TweenSettings":"TweenSettings","../../common/view/EventView":"EventView"}],Matrix:[function(e,t,o){"use strict";cc._RF.push(t,"320baWGsBZEno88utR9Y4nE","Matrix"),Object.defineProperty(o,"__esModule",{value:!0}),o.Matrix=void 0;var n=function(){function e(e,t,o){this._width=e,this._height=t,this._data=new Array(t);for(var n=0;n<t;n++){for(var r=new Array(e),i=0;i<e;i++)r[i]=o(i,n);this._data[n]=r}}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.get=function(e,t){return this._data[t][e]},e.prototype.set=function(e,t,o){this._data[t][e]=o},e.prototype.swap=function(e,t,o,n){var r=this._data[t][e];this._data[t][e]=this._data[n][o],this._data[n][o]=r},e.prototype.forEach=function(e){for(var t=0;t<this._height;t++)for(var o=0;o<this._width;o++)e(this._data[t][o],o,t)},e}();o.Matrix=n,cc._RF.pop()},{}],MoveService:[function(e,t,o){"use strict";cc._RF.push(t,"180c6G6rN9G/Iwx7rb1B39H","MoveService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MoveService=void 0;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.move=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];this.logicModel.get(n.from)&&this.logicModel.move(n.from,n.to)}},t}(e("./BoardService").BoardService);o.MoveService=r,cc._RF.pop()},{"./BoardService":"BoardService"}],MovesTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"edbdcH0xDlCDLhdQ15+puc6","MovesTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],MovesTextView:[function(e,t,o){"use strict";cc._RF.push(t,"d8aafGKJJ1BEZQfGSesrZxi","MovesTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.MovesTextView=void 0;var i=e("../../../domain/state/events/MovesUpdate"),s=e("../../common/view/DynamicTextView"),a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.eventType=function(){return i.MovesUpdate},t.prototype.format=function(e){return e.toString()},t=r([a],t)}(s.DynamicTextView);o.MovesTextView=c,cc._RF.pop()},{"../../../domain/state/events/MovesUpdate":"MovesUpdate","../../common/view/DynamicTextView":"DynamicTextView"}],MovesUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"bb92aCNWRxErro9vapvBuh4","MovesUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MovesUpdate=void 0;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.MovesUpdate=r,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],PresentationContext:[function(e,t,o){"use strict";cc._RF.push(t,"42e70c7wJdHjIwqH428F/4G","PresentationContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationContext=void 0;var n=function(){return function(e,t,o,n,r){this.visualConfig=e,this.eventBus=o,this.movesLeft=n.movesLeft,this.targetScore=n.targetScore,this.currentScore=n.currentScore,this.boardCols=t.board.cols,this.boardRows=t.board.rows,this.initialBoard=r}}();o.PresentationContext=n,cc._RF.pop()},{}],PresentationInstaller:[function(e,t,o){"use strict";cc._RF.push(t,"4e52fEwHilAvZkfHNvNYkuB","PresentationInstaller");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationInstaller=void 0;var i=e("../../../core/utils/assert"),s=e("../board/events/PresentationReady"),a=e("../board/view/BoardView"),c=e("../common/animations/TweenHelper"),u=e("../common/view/EventView"),l=e("../state/view/BombBoosterTextView"),p=e("../state/view/LoadingScreen"),d=e("../state/view/MovesTextView"),f=e("../state/view/ScoreTextView"),h=cc._decorator,_=h.ccclass,y=h.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loadingScreen=null,t.boardView=null,t.movesTextView=null,t.scoreTextView=null,t.bombBoosterTextView=null,t.swapBoosterTextView=null,t}return n(t,e),t.prototype.onLoad=function(){i.assertNotNull(this.boardView,this,"BoardView"),i.assertNotNull(this.movesTextView,this,"MovesTextView"),i.assertNotNull(this.scoreTextView,this,"ScoreTextView")},t.prototype.preInit=function(){i.assertNotNull(this.context,this,"viewContext")},t.prototype.onInit=function(){var e=new c.TweenHelper;this.loadingScreen.init({eventBus:this.context.eventBus,tweenHelper:e}),this.boardView.init({eventBus:this.context.eventBus,visualConfig:this.context.visualConfig,tweenHelper:e,boardCols:this.context.boardCols,boardRows:this.context.boardRows,initialBoard:this.context.initialBoard}),this.movesTextView.init({eventBus:this.context.eventBus,initialValue:this.context.movesLeft}),this.scoreTextView.init({eventBus:this.context.eventBus,initialValue:this.context.currentScore,targetScore:this.context.targetScore})},t.prototype.postInit=function(){this.emit(new s.PresentationReady)},t.prototype.dispose=function(){this.boardView.dispose(),this.movesTextView.dispose(),this.scoreTextView.dispose()},r([y(p.LoadingScreen)],t.prototype,"loadingScreen",void 0),r([y(a.BoardView)],t.prototype,"boardView",void 0),r([y(d.MovesTextView)],t.prototype,"movesTextView",void 0),r([y(f.ScoreTextView)],t.prototype,"scoreTextView",void 0),r([y(l.BoosterTextView)],t.prototype,"bombBoosterTextView",void 0),r([y(l.BoosterTextView)],t.prototype,"swapBoosterTextView",void 0),t=r([_],t)}(u.EventView);o.PresentationInstaller=v,cc._RF.pop()},{"../../../core/utils/assert":"assert","../board/events/PresentationReady":"PresentationReady","../board/view/BoardView":"BoardView","../common/animations/TweenHelper":"TweenHelper","../common/view/EventView":"EventView","../state/view/BombBoosterTextView":"BombBoosterTextView","../state/view/LoadingScreen":"LoadingScreen","../state/view/MovesTextView":"MovesTextView","../state/view/ScoreTextView":"ScoreTextView"}],PresentationReady:[function(e,t,o){"use strict";cc._RF.push(t,"4016b5BZYJKQ4tAffi0vSpn","PresentationReady"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationReady=void 0;var n=function(){return function(){}}();o.PresentationReady=n,cc._RF.pop()},{}],SafeDropMap:[function(e,t,o){"use strict";cc._RF.push(t,"c37022szChNwLd+74Hk4RN5","SafeDropMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.SafeDropMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e,t){var o,n=null!==(o=this._map.get(e))&&void 0!==o?o:new Set;n.add(t),this._map.set(e,n),console.log("[DROP MAP] ADD at x:"+e+", now "+n.size)},e.prototype.subtract=function(e,t){var o=this._map.get(e);o&&(o.delete(t),console.log("[DROP MAP] SUBSTRACT at x:"+e+", now "+o.size))},e.prototype.get=function(e){var t=this._map.get(e);return t?t.size:0},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.SafeDropMap=n,cc._RF.pop()},{}],ScoreService:[function(e,t,o){"use strict";cc._RF.push(t,"ed1f8pLuO9IALBgNsqVtvjL","ScoreService"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreService=void 0;var n=function(){function e(e){this._scoreMultiplier=e}return e.prototype.calculate=function(e){return e*e*this._scoreMultiplier},e}();o.ScoreService=n,cc._RF.pop()},{}],ScoreTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"7af9aTEbmRII6sX9caFBjRn","ScoreTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ScoreTextView:[function(e,t,o){"use strict";cc._RF.push(t,"7bd0f5hs8VARYsgFprc1Aea","ScoreTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreTextView=void 0;var i=e("../../../../core/utils/assert"),s=e("../../../domain/state/events/ScoreUpdate"),a=e("../../common/view/DynamicTextView"),c=cc._decorator.ccclass,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.preInit=function(){e.prototype.preInit.call(this),i.assertNumber(this.context.targetScore,this,"initialValue")},t.prototype.eventType=function(){return s.ScoreUpdate},t.prototype.format=function(e){return e+"/"+this.context.targetScore},t=r([c],t)}(a.DynamicTextView);o.ScoreTextView=u,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../common/view/DynamicTextView":"DynamicTextView"}],ScoreUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"751d9buhcZDmq08o3hoKjZ/","ScoreUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreUpdate=void 0;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.ScoreUpdate=r,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],SearchService:[function(e,t,o){"use strict";cc._RF.push(t,"146bchEKatLLLIq9vBSpvaC","SearchService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SearchService=void 0;var r=e("../../../../core/collections/Matrix"),i=e("../models/TileType"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.findCluster=function(e,t){var o=this.logicModel.get(e);if(!o)return[];for(var n=this.tileRepository.get(o),s=[],a=new r.Matrix(this.logicModel.width,this.logicModel.height,function(){return!1}),c=[e];c.length>0&&n!==i.TileType.EMPTY;){var u=c.pop();if(u&&!a.get(u.x,u.y)){a.set(u.x,u.y,!0);var l=this.logicModel.get(u);l&&(t.has(l)||this.tileRepository.get(l)!==n||(s.push(u),c.push.apply(c,this.findNeighbors(u))))}}return s},t.prototype.findNeighbors=function(e){for(var t=[],o=0,n=[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}];o<n.length;o++){var r=n[o];r.x<0||r.y<0||r.x>=this.logicModel.width||r.y>=this.logicModel.height||t.push(r)}return t},t.prototype.findDrops=function(){for(var e=[],t=this.logicModel.width-1;t>=0;t--)for(var o=0,n=this.logicModel.height-1;n>=0;n--){var r={x:t,y:n};if(this.logicModel.empty(r))o++;else if(o>0){var i=this.logicModel.get(r);if(!i)continue;var s={kind:"tile.moved",id:i,from:r,to:{x:t,y:n+o},cause:"drop"};e.push(s)}}return e},t}(e("./BoardService").BoardService);o.SearchService=s,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix","../models/TileType":"TileType","./BoardService":"BoardService"}],ShakeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"e713e/x+YVACa7ott/cyQ50","ShakeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ShakeTween:[function(e,t,o){"use strict";cc._RF.push(t,"82609dFDHRKJZdRjD/ogRNx","ShakeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.ShakeTween=void 0;var n=e("./TweenType"),r=function(){function e(){this.type=n.TweenType.SHAKE}return e.prototype.build=function(e){var t=e.node.angle;return cc.tween(e.node).to(e.duration,{angle:t+e.amplitude}).to(2*e.duration,{angle:t-e.amplitude}).to(2*e.duration,{angle:t+e.amplitude}).to(e.duration,{angle:t})},e}();o.ShakeTween=r,cc._RF.pop()},{"./TweenType":"TweenType"}],ShardAssets:[function(e,t,o){"use strict";cc._RF.push(t,"d807c/ZvdlLxIOeuPL7Pjdl","ShardAssets");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ShardAssets=void 0;var i=e("../../../../core/utils/assert"),s=e("./ColorRecord"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shards=[],t.colorRecords=[],t.colorMap=new Map,t}return n(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.colorRecords;e<t.length;e++){var o=t[e];this.colorMap.set(o.type,o.color)}},t.prototype.createRandomShard=function(){var e=this.shards[Math.floor(Math.random()*this.shards.length)];return cc.instantiate(e)},t.prototype.getColor=function(e){var t=this.colorMap.get(e);return i.assertNotNull(t,this,"color"),t},r([u([cc.Prefab])],t.prototype,"shards",void 0),r([u([s.ColorRecord])],t.prototype,"colorRecords",void 0),t=r([c],t)}(cc.Component);o.ShardAssets=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./ColorRecord":"ColorRecord"}],SpawnService:[function(e,t,o){"use strict";cc._RF.push(t,"c0001pCwYVP95cvO6tOSR2c","SpawnService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SpawnService=void 0;var r=function(e){function t(t,o,n,r){var i=e.call(this,t,o)||this;return i.factory=n,i.types=r,i}return n(t,e),t.prototype.spawn=function(){for(var e=[],t=0;t<this.logicModel.width;t++)for(var o=0;o<this.logicModel.height;o++){var n={x:t,y:o};if(!this.logicModel.get(n)){var r=this.randomType(),i=this.factory.create(r);this.logicModel.register(n,i.id),this.tileRepository.register(i.id,r);var s={kind:"tile.spawned",id:i.id,at:n,type:r};e.push(s)}}return e},t.prototype.randomType=function(){return this.types[Math.floor(Math.random()*this.types.length)]},t}(e("./BoardService").BoardService);o.SpawnService=r,cc._RF.pop()},{"./BoardService":"BoardService"}],StateUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"82fee7RjSJKA7WiawWb45fq","StateUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.StateUpdate=void 0;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.StateUpdate=r,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],SubscriptionGroup:[function(e,t,o){"use strict";cc._RF.push(t,"18bfaE9+69Bu4GzKQB8eC60","SubscriptionGroup"),Object.defineProperty(o,"__esModule",{value:!0}),o.SubscriptionGroup=void 0;var n=function(){function e(){this._subscriptions=[]}return e.prototype.add=function(e){this._subscriptions.push(e)},e.prototype.clear=function(){for(var e=0,t=this._subscriptions;e<t.length;e++){t[e].unsubscribe()}this._subscriptions.length=0},e}();o.SubscriptionGroup=n,cc._RF.pop()},{}],Subscription:[function(e,t,o){"use strict";cc._RF.push(t,"e054aPiy9xJ/roTuUKhU0v3","Subscription"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],SwapBoosterTextView:[function(e,t,o){"use strict";cc._RF.push(t,"da694MF1xJEgqpHaasJgqT+","SwapBoosterTextView"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileAssets:[function(e,t,o){"use strict";cc._RF.push(t,"4db3f6Nos5B9K7+VqraVTc/","TileAssets");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileAssets=void 0;var i=e("../../../../core/utils/assert"),s=e("../../../../core/utils/ensure"),a=e("../../../domain/board/models/TileType"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=null,t.empty=null,t.red=null,t.green=null,t.blue=null,t.purple=null,t.yellow=null,t.bomb=null,t}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.validate=function(){this._map=new Map([[a.TileType.EMPTY,s.ensureNotNull(this.empty,this,"EMPTY")],[a.TileType.RED,s.ensureNotNull(this.red,this,"RED")],[a.TileType.GREEN,s.ensureNotNull(this.green,this,"GREEN")],[a.TileType.BLUE,s.ensureNotNull(this.blue,this,"BLUE")],[a.TileType.PURPLE,s.ensureNotNull(this.purple,this,"PURPLE")],[a.TileType.YELLOW,s.ensureNotNull(this.yellow,this,"YELLOW")],[a.TileType.BOMB,s.ensureNotNull(this.bomb,this,"BOMB")]])},t.prototype.getPrefab=function(){return this.tile},t.prototype.getSprite=function(e){var t=this._map.get(e);return i.assertNotNull(t,this,"Sprite for type "+a.TileType[e]),t},r([l(cc.Prefab)],t.prototype,"tile",void 0),r([l(cc.SpriteFrame)],t.prototype,"empty",void 0),r([l(cc.SpriteFrame)],t.prototype,"red",void 0),r([l(cc.SpriteFrame)],t.prototype,"green",void 0),r([l(cc.SpriteFrame)],t.prototype,"blue",void 0),r([l(cc.SpriteFrame)],t.prototype,"purple",void 0),r([l(cc.SpriteFrame)],t.prototype,"yellow",void 0),r([l(cc.SpriteFrame)],t.prototype,"bomb",void 0),t=r([u],t)}(cc.Component);o.TileAssets=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../../core/utils/ensure":"ensure","../../../domain/board/models/TileType":"TileType"}],TileDestroyed:[function(e,t,o){"use strict";cc._RF.push(t,"1a542/xHkpO3K4fTYJWIYxc","TileDestroyed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileDestructionFx:[function(e,t,o){"use strict";cc._RF.push(t,"fa889HNT5ZOM7erXQ3EGnf4","TileDestructionFx"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileDestructionFx=void 0;var n=e("../../../../core/utils/random"),r=e("../../common/animations/TweenSettings"),i=e("./components/BurstMotion"),s=function(){function e(e,t,o,n){this._tweenHelper=e,this._fxLayer=t,this._shards=o,this._gravity=n}return e.prototype.play=function(e,t,o){for(var s=n.Random.intRange(o.minCount,o.maxCount),a=0;a<s;a++){var c=this._shards.createRandomShard(),u=this._shards.getColor(t);c.setParent(this._fxLayer);var l=cc.v3(n.Random.floatRange(-o.spawnRadius,o.spawnRadius),n.Random.floatRange(-o.spawnRadius,o.spawnRadius),0);c.setPosition(e.clone().add(l)),c.color=u,c.scale=n.Random.floatRange(o.minScale,o.maxScale);var p=c.addComponent(i.BurstMotion),d=n.Random.floatRange(-o.horizontalSpread,o.horizontalSpread)*Math.PI/180,f=n.Random.floatRange(o.minUpVelocity,o.maxUpVelocity);p.vx=Math.sin(d)*f,p.vy=Math.cos(d)*f,p.gravity=o.gravity,p.drag=n.Random.floatRange(o.dragMin,o.dragMax),p.av=n.Random.floatRange(o.minAngular,o.maxAngular),p.duration=o.duration,p.shrinkScale=o.shrinkScale,p.play(),this._tweenHelper.build(r.TweenSettings.burst(c,o.duration)).start()}},e}();o.TileDestructionFx=s,cc._RF.pop()},{"../../../../core/utils/random":"random","../../common/animations/TweenSettings":"TweenSettings","./components/BurstMotion":"BurstMotion"}],TileFactory:[function(e,t,o){"use strict";cc._RF.push(t,"f5173b4yopNF56G2A/Gy+sM","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var n=function(){function e(){this._nextId=0}return e.prototype.create=function(e){return{id:"tile_"+this._nextId++,type:e}},e}();o.TileFactory=n,cc._RF.pop()},{}],TileFlashFx:[function(e,t,o){"use strict";cc._RF.push(t,"ffd88X+vuZE9Lpoox8bLYzG","TileFlashFx"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFlashFx=void 0;var n=e("../../common/animations/TweenSettings"),r=function(){function e(e,t,o){this._tweenHelper=e,this._fxLayer=t,this._prefab=o}return e.prototype.play=function(e){var t=cc.instantiate(this._prefab);t.setParent(this._fxLayer),t.setPosition(e),t.opacity=0,this._tweenHelper.build(n.TweenSettings.flash(t)).start()},e}();o.TileFlashFx=r,cc._RF.pop()},{"../../common/animations/TweenSettings":"TweenSettings"}],TileModel:[function(e,t,o){"use strict";cc._RF.push(t,"917c78DkrFDE6IMAgJyVb7P","TileModel"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMoved:[function(e,t,o){"use strict";cc._RF.push(t,"20fc60xOqNB5qltU9zcKtig","TileMoved"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMutationHelper:[function(e,t,o){"use strict";cc._RF.push(t,"ca548z/0P5D9YGKLCo3XCci","TileMutationHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileMutationHelper=void 0;var n=function(){function e(){}return e.rejected=function(e,t){return{kind:"tile.rejected",id:e,reason:t}},e.destroyed=function(e,t,o){return{kind:"tile.destroy",id:e,at:t,cause:o}},e.moved=function(e,t,o,n){return{kind:"tile.moved",id:e,from:t,to:o,cause:n}},e.spawned=function(e,t,o){return{kind:"tile.spawned",id:e,type:t,at:o}},e.transformed=function(e,t,o){return{kind:"tile.transformed",id:e,before:t,after:o}},e}();o.TileMutationHelper=n,cc._RF.pop()},{}],TileMutation:[function(e,t,o){"use strict";cc._RF.push(t,"4e77f3qoCpKXKR2amsmAHV/","TileMutation"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TilePosition:[function(e,t,o){"use strict";cc._RF.push(t,"e31ab1Szq1KkpQ2i09M9pA2","TilePosition"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileRejected:[function(e,t,o){"use strict";cc._RF.push(t,"4afe1hIvUdP2oIcsQgtGDqE","TileRejected"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRejectedReason=void 0,o.TileRejectedReason={NO_MATCH:"no_match",UNSTABLE:"unstable",NON_EXISTANT:"non_existant"},cc._RF.pop()},{}],TileRepository:[function(e,t,o){"use strict";cc._RF.push(t,"35350obStpNGJZk1bJk7MEK","TileRepository"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRepository=void 0;var n=function(){function e(){this._tiles=new Map}return e.prototype.register=function(e,t){this._tiles.set(e,t)},e.prototype.get=function(e){var t=this._tiles.get(e);return t||null},e.prototype.remove=function(e){this._tiles.delete(e)},e}();o.TileRepository=n,cc._RF.pop()},{}],TileSpawned:[function(e,t,o){"use strict";cc._RF.push(t,"d8b33ZW3klA5YiCWrnTZWSz","TileSpawned"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileTransformed:[function(e,t,o){"use strict";cc._RF.push(t,"745d4yYFSxPpKHxydqVXs3Z","TileTransformed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileType:[function(e,t,o){"use strict";cc._RF.push(t,"ff92aR8Ym9CB7br3M3C8KnH","TileType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e[e.EMPTY=0]="EMPTY",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=3]="BLUE",e[e.PURPLE=4]="PURPLE",e[e.YELLOW=5]="YELLOW",e[e.BOMB=6]="BOMB",e[e.SUPER_BOMB=7]="SUPER_BOMB",e[e.HORIZONTAL_ROCKET=8]="HORIZONTAL_ROCKET",e[e.VERTICAL_ROCKET=9]="VERTICAL_ROCKET"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],TileViewClicked:[function(e,t,o){"use strict";cc._RF.push(t,"a68acF83zxITq3p8hOpX+c1","TileViewClicked"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileViewClicked=void 0;var n=function(){return function(e){this.position=e}}();o.TileViewClicked=n,cc._RF.pop()},{}],TileViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"c7e41M2uOVIuYIyMt4LhB8p","TileViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileViewDestroyed:[function(e,t,o){"use strict";cc._RF.push(t,"c7fa4fi2uVKK6vuk1q7QEge","TileViewDestroyed"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileDestroyed=void 0;var n=function(){return function(e){this.id=e}}();o.VisualTileDestroyed=n,cc._RF.pop()},{}],TileViewPool:[function(e,t,o){"use strict";cc._RF.push(t,"c104dYJlUtIwqc6fbb0RLYU","TileViewPool"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileViewPool=void 0;var n=e("../../../../core/utils/assert"),r=e("./TileView"),i=function(){function e(e,t,o){this._eventBus=e,this._tiles=t,this._parent=o,this._pool=[],this._map=new Map}return e.prototype.pull=function(e,t){var o=this._pool.pop();o&&cc.isValid(o)&&!cc.isValid(o.node)||(o=cc.instantiate(this._tiles.getPrefab()).getComponent(r.TileView));return n.assertNotNull(o,this,"pool is broken"),o.node.setParent(this._parent),o.node.setPosition(0,0),o.node.setScale(1,1),o.node.angle=0,o.node.opacity=255,o.node.active=!0,o.set(this._tiles.getSprite(t)),o.init({eventBus:this._eventBus}),this._map.set(e,o),o},e.prototype.release=function(e){var t=this._map.get(e);t&&cc.isValid(t)&&!cc.isValid(t.node)&&(cc.Tween.stopAllByTarget(t.node),t.hide(),t.node.removeFromParent(),this._pool.push(t),this._map.delete(e))},e}();o.TileViewPool=i,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./TileView":"TileView"}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"0eda0LA+Q5BwrB21iLZDWRq","TileView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var i=e("../../../../core/utils/assert"),s=e("../../common/view/ContextView"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),i.assertNotNull(this.sprite,this,"Sprite")},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},t.prototype.set=function(e){this.sprite.spriteFrame=e},t.prototype.stabilize=function(){this.node.setScale(1,1),this.node.angle=0,this.node.opacity=255,this.node.active=!0},r([u(cc.Sprite)],t.prototype,"sprite",void 0),t=r([c],t)}(s.ContextView);o.TileView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../common/view/ContextView":"ContextView"}],TileVisualAgentFactory:[function(e,t,o){"use strict";cc._RF.push(t,"e178a4bXWpLJoM3hUJ+TCHM","TileVisualAgentFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgentFactory=void 0;var n=e("./TileVisualAgent"),r=function(){function e(e,t,o,n,r,i,s,a,c,u,l){this._visualConfig=e,this._eventBus=t,this._tweenHelper=o,this._pool=n,this._boardCols=r,this._boardRows=i,this._backgroundLayer=s,this._tileLayer=a,this._fxLayer=c,this._destructionFx=u,this._flashFx=l}return e.prototype.create=function(e,t){var o=this._pool.pull(e,t);return new n.TileVisualAgent(this._visualConfig,this._eventBus,this._tweenHelper,e,o,t,this._boardCols,this._boardRows,this._backgroundLayer,this._tileLayer,this._fxLayer,this._destructionFx,this._flashFx)},e}();o.TileVisualAgentFactory=r,cc._RF.pop()},{"./TileVisualAgent":"TileVisualAgent"}],TileVisualAgent:[function(e,t,o){"use strict";cc._RF.push(t,"0d826Kcf5hPF5BGQIQZpQiO","TileVisualAgent"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgent=void 0;var n=e("../../../application/board/BoardKey"),r=e("../../common/animations/TweenSettings"),i=e("../../utils/calc"),s=e("../events/TileViewClicked"),a=e("../events/TileViewDestroyed"),c=e("../events/VisualTileStabilized"),u=function(){function e(e,t,o,n,r,i,s,a,c,u,l,p,d){this._position=null,this._target=null,this._tween=null,this._visualConfig=e,this._eventBus=t,this._tweenHelper=o,this._id=n,this._view=r,this._type=i,this._boardCols=s,this._boardRows=a,this._nodeWidth=r.node.width,this._nodeHeight=r.node.height,this._backgroundLayer=c,this._tileLayer=u,this._fxLayer=l,this._destructionFx=p,this._flashFx=d}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var e;return null!==(e=this._type)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){var e;return null!==(e=this._position)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var e;return null!==(e=this._target)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return null!==this._tween},enumerable:!1,configurable:!0}),e.prototype.spawn=function(e,t,o,i){var s=this;this._position=t;var a=this.local(t);console.log("[SPAWN] "+n.BoardKey.type(e)+" at "+n.BoardKey.position(o)+" with offset "+t);var u=this.local(o);this.prepare(a),this.subscribe(),this._tween=this._tweenHelper.build(r.TweenSettings.drop(this._view.node,a.y,u.y,this._visualConfig.gravity,i)).call(function(){s.clear(),s._position=o,s._target=null,s._eventBus.emit(new c.VisualTileStabilized(s._id,s._position)),console.log("[AGENT] "+s.id+" SPAWN FINISHED!")}).start()},e.prototype.drop=function(e,t){var o=this;if(this._position!==e){this.busy&&(this.clear(),this._view.node.setParent(this._tileLayer),this._view.stabilize()),this.view.node.setParent(this._tileLayer),console.log("[AGENT] "+this.id+" is startng to move"),this._target=e;var n=this.local(this._target).y;this._tween=this._tweenHelper.build(r.TweenSettings.drop(this._view.node,this._view.node.y,n,this._visualConfig.gravity,t)).call(function(){o.clear(),o._position=e,o._target=null,o.view.node.setParent(o._tileLayer),o._eventBus.emit(new c.VisualTileStabilized(o._id,o._position)),console.log("[AGENT] "+o.id+" MOVE FINISHED!")}).start()}},e.prototype.destroy=function(){var e=this._view.node.position;this._destructionFx.play(e,this._type,this._visualConfig.burst),this._flashFx.play(e),this._view.node.setParent(this._backgroundLayer),this.clear(),this.hide(),this.unsubscribe(),this._eventBus.emit(new a.VisualTileDestroyed(this._id))},e.prototype.shake=function(){var e=this;this._view.node.setParent(this._tileLayer),this._tween=this._tweenHelper.build(r.TweenSettings.shake(this._view.node)).call(function(){e.clear(),e._eventBus.emit(new c.VisualTileStabilized(e._id,e._position))}).start()},e.prototype.prepare=function(e){this._view.stabilize(),this._view.node.setParent(this._tileLayer),this._view.node.setPosition(e),this._view.show()},e.prototype.clear=function(){this._tween&&this._tween.stop(),this._tween=null},e.prototype.hide=function(){this.view.hide()},e.prototype.onClick=function(){!this.busy&&this._position&&this._eventBus.emit(new s.TileViewClicked(this._position))},e.prototype.subscribe=function(){this._view.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.unsubscribe=function(){this._view.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.local=function(e){return i.getLocal(e,this._boardCols,this._boardRows,this._nodeWidth,this._nodeHeight)},e}();o.TileVisualAgent=u,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../common/animations/TweenSettings":"TweenSettings","../../utils/calc":"calc","../events/TileViewClicked":"TileViewClicked","../events/TileViewDestroyed":"TileViewDestroyed","../events/VisualTileStabilized":"VisualTileStabilized"}],TileVisualOrchestrator:[function(e,t,o){"use strict";cc._RF.push(t,"79985Ho6MlB3pAuxEpEnlOu","TileVisualOrchestrator"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualOrchestrator=void 0;var n=e("../../../application/board/BoardKey"),r=e("../../../domain/board/events/mutations/TileRejected"),i=e("../events/TileViewDestroyed"),s=e("../events/VisualTileStabilized"),a=e("../fx/TileDestructionFx"),c=e("../fx/TileFlashFx"),u=e("./BoardVisualModel"),l=e("./SafeDropMap"),p=e("./TileViewPool"),d=e("./TileVisualAgentFactory"),f=function(){function e(e,t,o,n,r,f,h,_,y,v,g){var b=this;this.onTileStabilized=function(e){b._safeDropMap.subtract(e.position.x,e.id)},this.onTileDestroyed=function(e){b._tilePool.release(e.id),b._visualModel.remove(e.id)},this._eventBus=e,this._visualConfig=t,this._tweenHelper=o,this._boardCols=n,this._boardRows=r,this._backgroundLayer=f,this._tileLayer=h,this._fxLayer=_,this._tiles=y,this._shards=v,this._flash=g,this._visualModel=new u.BoardVisualModel,this._tilePool=new p.TileViewPool(this._eventBus,this._tiles,this._tileLayer),this._destructionFx=new a.TileDestructionFx(this._tweenHelper,this._fxLayer,this._shards,this._visualConfig.gravity),this._flashFx=new c.TileFlashFx(this._tweenHelper,this._fxLayer,this._flash),this._visualAgentFactory=new d.TileVisualAgentFactory(this._visualConfig,this._eventBus,this._tweenHelper,this._tilePool,this._boardCols,this._boardRows,this._backgroundLayer,this._tileLayer,this._fxLayer,this._destructionFx,this._flashFx),this._safeDropMap=new l.SafeDropMap,this._eventBus.on(s.VisualTileStabilized,this.onTileStabilized),this._eventBus.on(i.VisualTileDestroyed,this.onTileDestroyed)}return e.prototype.init=function(e){var t=this;e.forEach(function(e){var o=t._visualAgentFactory.create(e.id,e.type);t._visualModel.register(o);var n={x:e.at.x,y:-e.at.y-t._visualConfig.initialSpawnLine};o.spawn(e.type,n,e.at,t.getDropDelay(n))})},e.prototype.dispatch=function(e){for(var t=0,o=e.mutations;t<o.length;t++){if("tile.spawned"===(c=o[t]).kind){var i=this._visualAgentFactory.create(c.id,c.type);this._visualModel.register(i),this._safeDropMap.add(c.at.x,i.id)}}this._safeDropMap.forEach(function(e,t){return console.log("[DISPATCH] spawning "+e+" nodes in "+t+" column")}),console.log("[DISPATCH] mutations: "+e.mutations.length);for(var s=0,a=e.mutations;s<a.length;s++){var c;switch((c=a[s]).kind){case"tile.spawned":console.log("[DISPATCH] dispatching spawn at: "+n.BoardKey.position(c.at)+"; id: "+c.id);i=this._visualModel.get(c.id);var u=this._safeDropMap.get(c.at.x);if(console.log("[OFFSET CALCULCATED] "+u+" for "+c.at.x),!i)continue;console.log("[DISPATCH] SPAWN DISPATCHED");var l={x:c.at.x,y:c.at.y-u-this._visualConfig.normalSpawnLine};i.spawn(c.type,l,c.at,this.getDropDelay(l));break;case"tile.moved":if(console.log("[DISPATCH] dispatching move from: "+n.BoardKey.position(c.from)+"; to: "+n.BoardKey.position(c.to)+"; id: "+c.id),!(i=this._visualModel.get(c.id)))continue;console.log("[DISPATCH] MOVE DISPATCHED"),i.drop(c.to,this.getDropDelay(i.position));break;case"tile.destroy":if(console.log("[DISPATCH] dispatching destroy at: "+n.BoardKey.position(c.at)+"; id: "+c.id),!(i=this._visualModel.get(c.id)))continue;console.log("[DISPATCH] DESTROY DISPATCHED"),i.destroy();break;case"tile.transformed":if(!(i=this._visualModel.get(c.id)))continue;break;case"tile.rejected":if(console.log("[DISPATCH] rejected: "+c.reason),!(i=this._visualModel.get(c.id)))continue;c.reason==r.TileRejectedReason.NO_MATCH&&i.shake(),console.log("[DISPATCH] agent: "+i.id+"; position: "+n.BoardKey.position(i.position));break;default:throw new Error("Unsupported mutation kind: "+c.kind)}}},e.prototype.getDropDelay=function(e){return(this._boardRows-e.y)*this._visualConfig.dropDelayParameter},e}();o.TileVisualOrchestrator=f,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../../domain/board/events/mutations/TileRejected":"TileRejected","../events/TileViewDestroyed":"TileViewDestroyed","../events/VisualTileStabilized":"VisualTileStabilized","../fx/TileDestructionFx":"TileDestructionFx","../fx/TileFlashFx":"TileFlashFx","./BoardVisualModel":"BoardVisualModel","./SafeDropMap":"SafeDropMap","./TileViewPool":"TileViewPool","./TileVisualAgentFactory":"TileVisualAgentFactory"}],TweenHelper:[function(e,t,o){"use strict";cc._RF.push(t,"2ee8fX9cuhK1rpLwq9wgYPG","TweenHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenHelper=void 0;var n=e("../../../../core/utils/assert"),r=e("./tweens/DestroyTween"),i=e("./tweens/ShakeTween"),s=e("./tweens/DropTween"),a=e("./tweens/FadeTween"),c=e("./tweens/BurstTween"),u=e("./tweens/FlashTween"),l=function(){function e(){this.tweens=new Map,this.register()}return e.prototype.register=function(){this.add(new r.DestroyTween),this.add(new a.FadeTween),this.add(new s.DropTween),this.add(new i.ShakeTween),this.add(new c.BurstTween),this.add(new u.FlashTween)},e.prototype.add=function(e){this.tweens.set(e.type,e)},e.prototype.build=function(e){var t=this.tweens.get(e.type);return n.assertNotNull(t,this,"tween"),t.build(e)},e}();o.TweenHelper=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./tweens/BurstTween":"BurstTween","./tweens/DestroyTween":"DestroyTween","./tweens/DropTween":"DropTween","./tweens/FadeTween":"FadeTween","./tweens/FlashTween":"FlashTween","./tweens/ShakeTween":"ShakeTween"}],TweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"0181cXWOh9Oia7D8sqe+9Xy","TweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenSettings=void 0;var n=e("./tweens/TweenType"),r=function(){function e(){}return e.fade=function(e,t,o,r){return{type:n.TweenType.FADE,node:e,delay:t,duration:o,opacity:r}},e.drop=function(e,t,o,r,i){return{type:n.TweenType.DROP,node:e,fromY:t,toY:o,gravity:r,delay:i,easing:"quadIn",bounce:10,bounceDuration:.08,settleDuration:.08}},e.destroy=function(e){return{type:n.TweenType.DESTROY,node:e,squashDuration:.05,squashScale:.95,popDuration:.03,popScale:1.2,shrinkDuration:.3,shrinkOpacity:0,shrinkScale:.2}},e.shake=function(e){return{type:n.TweenType.SHAKE,node:e,duration:.05,amplitude:8}},e.burst=function(e,t){return{type:n.TweenType.BURST,node:e,duration:t}},e.flash=function(e){return{type:n.TweenType.FLASH,node:e,durationIn:.11,scaleIn:1,durationOut:.16,scaleOut:1.5,peakOpacity:160}},e}();o.TweenSettings=r,cc._RF.pop()},{"./tweens/TweenType":"TweenType"}],TweenType:[function(e,t,o){"use strict";cc._RF.push(t,"4816dhJDk9IGJvlwlnEfHAF","TweenType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenType=void 0,function(e){e[e.FADE=0]="FADE",e[e.DESTROY=1]="DESTROY",e[e.DROP=2]="DROP",e[e.SPAWN=3]="SPAWN",e[e.SHAKE=4]="SHAKE",e[e.BURST=5]="BURST",e[e.FLASH=6]="FLASH"}(o.TweenType||(o.TweenType={})),cc._RF.pop()},{}],ValueChangedEvent:[function(e,t,o){"use strict";cc._RF.push(t,"323e3lkPd9Nzq1jCSpLjod2","ValueChangedEvent"),Object.defineProperty(o,"__esModule",{value:!0}),o.ValueChangedEvent=void 0;var n=function(){return function(e){this.value=e}}();o.ValueChangedEvent=n,cc._RF.pop()},{}],VisualConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"e50a2oB6P5I3LE8/vlH/qdn","VisualConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigLoader=void 0;var r=e("../../settings/GameSettings"),i=e("../BaseConfigLoader"),s=e("./DefaultVisualConfigProvider"),a=e("./VisualConfigValidator"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return r.GameSettings.VISUAL_CONFIG},t.prototype.createValidator=function(){return new a.VisualConfigValidator},t.prototype.getDefaultProvider=function(){return new s.DefaultVisualConfigProvider},t}(i.BaseConfigLoader);o.VisualConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultVisualConfigProvider":"DefaultVisualConfigProvider","./VisualConfigValidator":"VisualConfigValidator"}],VisualConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"ddcd1tnRPpEvq6CNyVNi8FC","VisualConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigValidator=void 0;var n=e("../../../core/utils/ensure"),r=function(){function e(){}return e.prototype.validate=function(e){var t=n.ensureObject(e,this,"data"),o=n.ensureNumber(t.gravity,this,"data.baseDropTime"),r=n.ensureNumber(t.dropDelayParameter,this,"data.dropDelayParameter"),i=n.ensureNumber(t.initialSpawnLine,this,"data.initialSpawnLine"),s=n.ensureNumber(t.normalSpawnLine,this,"data.normalSpawnLine"),a=n.ensureNumber(t.nodeWidth,this,"data.nodeWidth"),c=n.ensureNumber(t.nodeHeight,this,"data.nodeHeight"),u=n.ensureObject(t.burst,this,"data.burst");return{gravity:o,dropDelayParameter:r,initialSpawnLine:i,normalSpawnLine:s,nodeWidth:a,nodeHeight:c,burst:{minCount:n.ensureNumber(u.minCount,this,"burstData.minCount"),maxCount:n.ensureNumber(u.maxCount,this,"burstData.maxCount"),minUpVelocity:n.ensureNumber(u.minUpVelocity,this,"burstData.minUpVelocity"),maxUpVelocity:n.ensureNumber(u.maxUpVelocity,this,"burstData.maxUpVelocity"),horizontalSpread:n.ensureNumber(u.horizontalSpread,this,"burstData.horizontalSpread"),spawnRadius:n.ensureNumber(u.spawnRadius,this,"burstData.spawnRadius"),minScale:n.ensureNumber(u.minScale,this,"burstData.minScale"),maxScale:n.ensureNumber(u.maxScale,this,"burstData.maxScale"),minAngular:n.ensureNumber(u.minAngular,this,"burstData.minAngular"),maxAngular:n.ensureNumber(u.maxAngular,this,"burstData.maxAngular"),gravity:n.ensureNumber(u.gravity,this,"burstData.burstGravity"),dragMin:n.ensureNumber(u.dragMin,this,"burstData.dragMin"),dragMax:n.ensureNumber(u.dragMax,this,"burstData.dragMax"),duration:n.ensureNumber(u.duration,this,"burstData.duration"),shrinkScale:n.ensureNumber(u.shrinkScale,this,"burstData.shrinkScale")}}},e}();o.VisualConfigValidator=r,cc._RF.pop()},{"../../../core/utils/ensure":"ensure"}],VisualConfig:[function(e,t,o){"use strict";cc._RF.push(t,"25d26/EYZxAhKvwNvzom8R5","VisualConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],VisualTileStabilized:[function(e,t,o){"use strict";cc._RF.push(t,"33614n0IExCibPAYVhvGcCN","VisualTileStabilized"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileStabilized=void 0;var n=function(){return function(e,t){this.id=e,this.position=t}}();o.VisualTileStabilized=n,cc._RF.pop()},{}],algorithms:[function(e,t,o){"use strict";cc._RF.push(t,"f5e52IzeiFOF7YptTC83Tpo","algorithms"),Object.defineProperty(o,"__esModule",{value:!0}),o.intersection=void 0,o.intersection=function(e,t,o){var n=new Set(t),r=new Set(o);return e.filter(function(e){return n.has(e)&&r.has(e)})},cc._RF.pop()},{}],assert:[function(e,t,o){"use strict";function n(e,t,o){var n;if(n="function"==typeof t?t.name:t.constructor.name,!e)throw new Error("["+n+"] "+o)}function r(e,t,o){n(Array.isArray(e),t,o+" must be an array")}function i(e,t,o){n(e.length>0,t,o+" must not be empty")}cc._RF.push(t,"3cb7d9OgnZEJaI/WU7/lNKX","assert"),Object.defineProperty(o,"__esModule",{value:!0}),o.assertNumber=o.assertObject=o.assertString=o.assertNonEmptyArray=o.assertArrayNotEmpty=o.assertArray=o.assertNotNull=o.assert=void 0,o.assert=n,o.assertNotNull=function(e,t,o){n(null!==e&&void 0!==e,t,o+" must not be null nor undefined")},o.assertArray=r,o.assertArrayNotEmpty=i,o.assertNonEmptyArray=function(e,t,o){r(e,t,o),i(e,t,o)},o.assertString=function(e,t,o){n("string"==typeof e,t,o+" must be string")},o.assertObject=function(e,t,o){n("object"==typeof e,t,o+" must be object")},o.assertNumber=function(e,t,o){n("number"==typeof e&&!Number.isNaN(e),t,o+" must be number")},cc._RF.pop()},{}],calc:[function(e,t,o){"use strict";function n(e,t,o,n){var r=-(e-1)*o/2,i=(t-1)*n/2;return cc.v2(r,i)}cc._RF.push(t,"64e8aSSlcZIUo+/VlXg2quw","calc"),Object.defineProperty(o,"__esModule",{value:!0}),o.getSpeed=o.getOrigin=o.getLocal=void 0,o.getLocal=function(e,t,o,r,i){var s=n(t,o,r,i);return cc.v2(s.x+e.x*r,s.y-e.y*i)},o.getOrigin=n,o.getSpeed=function(e,t){return e*t},cc._RF.pop()},{}],ensure:[function(e,t,o){"use strict";cc._RF.push(t,"4a80emCBIlPbY4kzmojZq/X","ensure"),Object.defineProperty(o,"__esModule",{value:!0}),o.ensureEnumValue=o.ensureNonEmptyArray=o.ensureObject=o.ensureNotNull=o.ensureNumber=void 0;var n=e("./assert");o.ensureNumber=function(e,t,o){return n.assertNumber(e,t,o),e},o.ensureNotNull=function(e,t,o){return n.assertNotNull(e,t,o),e},o.ensureObject=function(e,t,o){return n.assertObject(e,t,o),e},o.ensureNonEmptyArray=function(e,t,o){return n.assertNotNull(e,t,o),n.assertNonEmptyArray(e,t,o),e},o.ensureEnumValue=function(e,t,o,r){var i=e[t];return n.assert(void 0!==i,o,"Unknown "+r+': "'+t+'"'),i},cc._RF.pop()},{"./assert":"assert"}],random:[function(e,t,o){"use strict";cc._RF.push(t,"a5d9cezF4BFNIl1SShDyYsy","random"),Object.defineProperty(o,"__esModule",{value:!0}),o.Random=void 0;var n=function(){function e(){}return e.intRange=function(e,t){return e+Math.floor(Math.random()*(t-e))},e.floatRange=function(e,t){return e+Math.random()*(t-e)},e.float=function(){return Math.random()},e.pick=function(e){if(0===e.length)throw new Error("[Random] Cannot pick from empty array");return e[this.intRange(0,e.length)]},e}();o.Random=n,cc._RF.pop()},{}]},{},["Matrix","ConfigLoader","IConfig","IConfigValidator","BaseConfigProvider","IConfigProvider","JsonConfigProvider","EventBus","IEvent","Subscription","SubscriptionGroup","ValueChangedEvent","IDisposable","IInitializable","IValidatable","algorithms","assert","ensure","random","ApplicationGraph","BoardKey","BoardLogicController","BoardRuntimeController","BoardRuntimeModel","BaseController","GameStateController","GameContext","GameStartup","BaseConfigLoader","ConfigMode","DefaultGameConfigProvider","GameConfig","GameConfigLoader","GameConfigValidator","DefaultVisualConfigProvider","VisualConfig","VisualConfigLoader","VisualConfigValidator","DomainGraph","BoardMutationsBatch","TileDestroyed","TileMoved","TileMutation","TileMutationHelper","TileRejected","TileSpawned","TileTransformed","BoardLogicModel","TileFactory","TileModel","TilePosition","TileRepository","TileType","BoardService","DestroyService","MoveService","SearchService","SpawnService","BoosterUsed","GameStateSync","MovesUpdate","ScoreUpdate","StateUpdate","BoosterType","GameStateModel","GameStateType","ScoreService","GameEntry","BoardViewContext","TileViewContext","LoadingScreenFaded","PresentationReady","TileViewClicked","TileViewDestroyed","VisualTileStabilized","TileDestructionFx","TileFlashFx","BurstMotion","AltitudeMap","BoardView","BoardVisualModel","SafeDropMap","TileView","TileViewPool","TileVisualAgent","TileVisualAgentFactory","TileVisualOrchestrator","TweenHelper","TweenSettings","BurstSettings","DestructionSettings","DropSettings","FadeSettings","FlashSettings","ITweenSettings","ShakeSettings","BurstTween","DestroyTween","DropTween","FadeTween","FlashTween","ITween","ShakeTween","TweenType","ColorRecord","ShardAssets","TileAssets","DynamicTextViewContext","EventViewContext","ContextView","DynamicTextView","EventView","PresentationContext","PresentationInstaller","BoosterTextViewContext","LoadingScreenContext","MovesTextViewContext","ScoreTextViewContext","SwapBoosterTextView","BombBoosterTextView","LoadingScreen","MovesTextView","ScoreTextView","calc","GameSettings"]);