window.__require=function e(t,o,n){function i(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var u="function"==typeof __require&&__require;if(!a&&u)return u(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({AltitudeMap:[function(e,t,o){"use strict";cc._RF.push(t,"988ee61LrlLxI8UCWKJq6dH","AltitudeMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.AltitudeMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e,t){this._map.set(e,t)},e.prototype.remove=function(e){this._map.set(e,null)},e.prototype.get=function(e){var t;return null!==(t=this._map.get(e))&&void 0!==t?t:null},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.AltitudeMap=n,cc._RF.pop()},{}],BaseConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"7522bpvPlRNbYbk5wGJBVPn","BaseConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigLoader=void 0;var i=e("../../../../core/config/ConfigLoader"),r=e("../../../../core/config/providers/JsonConfigProvider"),s=e("./ConfigMode"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.createProvider=function(e,t){switch(e){case s.ConfigMode.JSON:return new r.JsonConfigProvider(this.getJsonPath(),t);default:return this.getDefaultProvider()}},t}(i.ConfigLoader);o.BaseConfigLoader=a,cc._RF.pop()},{"../../../../core/config/ConfigLoader":"ConfigLoader","../../../../core/config/providers/JsonConfigProvider":"JsonConfigProvider","./ConfigMode":"ConfigMode"}],BaseConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"062f5ambD5N9JvTzMqt3cqH","BaseConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseConfigProvider=void 0;var n=e("../utils/assert"),i=function(){function e(){}return e.prototype.get=function(){return n.assertNotNull(this.config,this,"config"),this.config},e}();o.BaseConfigProvider=i,cc._RF.pop()},{"../utils/assert":"assert"}],BaseController:[function(e,t,o){"use strict";cc._RF.push(t,"badd4D/MYpB0pfYbiXf2xQf","BaseController"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseController=void 0;var n=function(){function e(){this._initialized=!1}return e.prototype.init=function(){this._initialized||(this._initialized=!0,this.onInit())},e.prototype.dispose=function(){this._initialized&&this.onDispose()},e.prototype.onDispose=function(){},e}();o.BaseController=n,cc._RF.pop()},{}],BoardController:[function(e,t,o){"use strict";cc._RF.push(t,"822885m60hJ9aKNQsvvr2h0","BoardController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<o;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)n[i]=r[s];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardController=void 0;var r=e("../../../../core/events/SubscriptionGroup"),s=e("../../../domain/board/events/BoardMutationsBatch"),a=e("../../../domain/board/events/mutations/TileMutations"),c=e("../../../domain/board/events/mutations/TileRejected"),u=e("../../../domain/state/events/GameStateSync"),l=e("../../../presentation/board/events/VisualTileClicked"),p=e("../../common/controllers/BaseController"),d=e("../runtime/BoardRuntimeModel"),f=function(e){function t(t){var o=e.call(this)||this;return o._subscriptions=new r.SubscriptionGroup,o.onTileClicked=function(e){var t=o._boardRuntime.stableBoard();if(console.log("[CONTROL] board stability: "+t),t){var n=o.build(e.position);o._eventBus.emit(n)}},o._gameConfig=t.gameConfig,o._eventBus=t.eventBus,o._gameStateModel=t.gameStateModel,o._logicModel=t.logicModel,o._boardRuntime=t.runtimeModel,o._tileRepository=t.tileRepository,o._spawnService=t.spawnService,o._searchService=t.searchService,o._destroyService=t.destroyService,o._moveService=t.moveService,o}return n(t,e),t.prototype.onInit=function(){this._subscriptions.add(this._eventBus.on(l.VisualTileClicked,this.onTileClicked))},t.prototype.build=function(e){var t=this._logicModel.get(e);if(!t)return new s.BoardMutationsBatch([a.TileMutations.rejected("_",c.TileRejectedReason.NON_EXISTANT)]);if(!this._boardRuntime.stableTile(t))return new s.BoardMutationsBatch([a.TileMutations.rejected(t,c.TileRejectedReason.UNSTABLE)]);var o=this._searchService.findCluster(e);if(o.length<this._gameConfig.clusterSize)return this._boardRuntime.lockTile(t,d.TileLock.SHAKE),new s.BoardMutationsBatch([a.TileMutations.rejected(t,c.TileRejectedReason.NO_MATCH)]);var n=this._destroyService.destroy(o),r=this._searchService.findDrops();this._moveService.move(r,d.TileLock.DROP);var l=this._spawnService.spawn();return this._eventBus.emit(new u.GameStateSync(n.length)),new s.BoardMutationsBatch(i(n,r,l))},t.prototype.dispose=function(){this._subscriptions.clear()},t}(p.BaseController);o.BoardController=f,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../../domain/board/events/mutations/TileMutations":"TileMutations","../../../domain/board/events/mutations/TileRejected":"TileRejected","../../../domain/state/events/GameStateSync":"GameStateSync","../../../presentation/board/events/VisualTileClicked":"VisualTileClicked","../../common/controllers/BaseController":"BaseController","../runtime/BoardRuntimeModel":"BoardRuntimeModel"}],BoardKey:[function(e,t,o){"use strict";cc._RF.push(t,"e7833BfyBNJiZr6GHlnxgBl","BoardKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardKey=void 0;var n=e("../../domain/board/models/TileType"),i=function(){function e(){}return e.position=function(e){return e.x+":"+e.y},e.type=function(e){return""+n.TileType[e]},e}();o.BoardKey=i,cc._RF.pop()},{"../../domain/board/models/TileType":"TileType"}],BoardLogicalModel:[function(e,t,o){"use strict";cc._RF.push(t,"dbcb0mgiXNKwLZONqL+86Y2","BoardLogicalModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardLogicalModel=void 0;var n=e("../../../../core/collections/Matrix"),i=function(){function e(e,t){this.width=e,this.height=t,this._grid=new n.Matrix(this.width,this.height,function(){return null})}return e.prototype.register=function(e,t){this._grid.set(e.x,e.y,t)},e.prototype.move=function(e,t){var o=this._grid.get(e.x,e.y);o&&(this._grid.set(e.x,e.y,null),this._grid.set(t.x,t.y,o))},e.prototype.destroy=function(e){this._grid.get(e.x,e.y)&&this._grid.set(e.x,e.y,null)},e.prototype.get=function(e){return this._grid.get(e.x,e.y)},e.prototype.empty=function(e){return null===this._grid.get(e.x,e.y)},e}();o.BoardLogicalModel=i,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix"}],BoardMutationsBatch:[function(e,t,o){"use strict";cc._RF.push(t,"9d99fTbKVFF9pbnBqDTUx0L","BoardMutationsBatch"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardMutationsBatch=void 0;var n=function(){return function(e){this.mutations=e}}();o.BoardMutationsBatch=n,cc._RF.pop()},{}],BoardRuntimeModel:[function(e,t,o){"use strict";var n;cc._RF.push(t,"d7305ApDc5MsIieMe5u/p5F","BoardRuntimeModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRuntimeModel=o.TileLock=void 0,function(e){e[e.NONE=0]="NONE",e[e.DESTROY=1]="DESTROY",e[e.DROP=2]="DROP",e[e.SPAWN=4]="SPAWN",e[e.SHAKE=8]="SHAKE",e[e.SWAP=16]="SWAP"}(n=o.TileLock||(o.TileLock={}));var i=function(){function e(){this._tileLocks=new Map,this._boardLocks=0}return e.prototype.stableTile=function(e){return this._tileLocks.get(e)===n.NONE},e.prototype.lockTile=function(e,t){var o=this._tileLocks.get(e);o?this._tileLocks.set(e,o|t):this.registerTile(e,t)},e.prototype.unlockTile=function(e,t){var o=this._tileLocks.get(e);o?this._tileLocks.set(e,o&~t):this.registerTile(e,n.NONE)},e.prototype.registerTile=function(e,t){this._tileLocks.set(e,t)},e.prototype.deleteTile=function(e){this._tileLocks.delete(e)},e.prototype.stableBoard=function(){return 0===this._boardLocks},e.prototype.lockBoard=function(){this._boardLocks++,console.log("[LOCKS] incremented "+this._boardLocks)},e.prototype.unlockBoard=function(){this._boardLocks=Math.max(0,this._boardLocks-1),console.log("[LOCKS] decremented "+this._boardLocks)},e}();o.BoardRuntimeModel=i,cc._RF.pop()},{}],BoardService:[function(e,t,o){"use strict";cc._RF.push(t,"84623Zdp3FDb4pT4zg1jwcO","BoardService"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardService=void 0;var n=function(){return function(e,t,o){this.logicModel=e,this.runtimeModel=t,this.tileRepository=o}}();o.BoardService=n,cc._RF.pop()},{}],BoardViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"493d5P3Og5P2pe7KPcaugF9","BoardViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BoardView:[function(e,t,o){"use strict";cc._RF.push(t,"bb883j+cbZB3Jz/i+gZlUKc","BoardView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardView=void 0;var r=e("../../../domain/board/events/BoardMutationsBatch"),s=e("../../common/view/EventView"),a=e("../events/LoadingScreenFaded"),c=e("./TileVisualOrchestrator"),u=cc._decorator,l=u.ccclass,p=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.backgroundNode=null,t.backgroundLayer=null,t.tileLayer=null,t.fxLayer=null,t.tilePrefab=null,t.onBoardChanged=function(e){t._visualOrchestrator.dispatch(e)},t.onLoadingScreenFaded=function(e){t._visualOrchestrator.init(t.context.initialBoard)},t}return n(t,e),t.prototype.onInit=function(){this._visualOrchestrator=new c.TileVisualOrchestrator(this.context.visualConfig,this.context.eventBus,this.context.runtimeModel,this.context.tweenHelper,this.context.boardCols,this.context.boardRows,this.backgroundLayer,this.tileLayer,this.fxLayer,this.tilePrefab),this.backgroundNode.width=this.context.boardCols*this.context.visualConfig.nodeWidth,this.backgroundNode.height=this.context.boardRows*this.context.visualConfig.nodeHeight,this.on(r.BoardMutationsBatch,this.onBoardChanged),this.on(a.LoadingScreenFaded,this.onLoadingScreenFaded)},i([p(cc.Node)],t.prototype,"backgroundNode",void 0),i([p(cc.Node)],t.prototype,"backgroundLayer",void 0),i([p(cc.Node)],t.prototype,"tileLayer",void 0),i([p(cc.Node)],t.prototype,"fxLayer",void 0),i([p(cc.Prefab)],t.prototype,"tilePrefab",void 0),t=i([l],t)}(s.EventView);o.BoardView=d,cc._RF.pop()},{"../../../domain/board/events/BoardMutationsBatch":"BoardMutationsBatch","../../common/view/EventView":"EventView","../events/LoadingScreenFaded":"LoadingScreenFaded","./TileVisualOrchestrator":"TileVisualOrchestrator"}],BoardVisualModel:[function(e,t,o){"use strict";cc._RF.push(t,"3ee0dXcdXhKYpOom0IludlY","BoardVisualModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardVisualModel=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.register=function(e){this._map.set(e.id,e)},e.prototype.get=function(e){return this._map.get(e)},e.prototype.remove=function(e){this._map.delete(e)},e}();o.BoardVisualModel=n,cc._RF.pop()},{}],ConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"4c42df3M+lCVb4rhi8GvaA4","ConfigLoader");var n=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigLoader=void 0;var r=function(){function e(){}return e.prototype.load=function(e){return n(this,void 0,Promise,function(){var t,o;return i(this,function(n){switch(n.label){case 0:return t=this.createValidator(),[4,(o=this.createProvider(e,t)).load()];case 1:return n.sent(),[2,o.get()]}})})},e}();o.ConfigLoader=r,cc._RF.pop()},{}],ConfigMode:[function(e,t,o){"use strict";cc._RF.push(t,"03e6f9/gYVGq7dukWxn43nz","ConfigMode"),Object.defineProperty(o,"__esModule",{value:!0}),o.ConfigMode=void 0,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.JSON=1]="JSON"}(o.ConfigMode||(o.ConfigMode={})),cc._RF.pop()},{}],ContextView:[function(e,t,o){"use strict";cc._RF.push(t,"9c93bf+0u9PVaZ2BjXiiCzz","ContextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ContextView=void 0;var i=e("../../../../core/utils/assert"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._initialized=!1,t}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.onDestroy=function(){this.dispose()},t.prototype.validate=function(){},t.prototype.init=function(e){this._initialized||(i.assertNotNull(e,this,"context"),this.context=e,this.preInit(),this.onInit(),this.postInit(),this._initialized=!0)},t.prototype.preInit=function(){},t.prototype.onInit=function(){},t.prototype.postInit=function(){},t.prototype.dispose=function(){this._initialized&&(this.onDispose(),this._initialized=!1)},t.prototype.onDispose=function(){},t}(cc.Component);o.ContextView=r,cc._RF.pop()},{"../../../../core/utils/assert":"assert"}],DefaultGameConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"6d7bf+9Gc9BaI6X/UYq/U6Y","DefaultGameConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultGameConfigProvider=void 0;var s=e("../../../../../core/config/BaseConfigProvider"),a=e("../../../../domain/board/models/TileType"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){return r(this,function(e){return this.config={boardCols:9,boardRows:9,allowedTypes:[a.TileType.RED,a.TileType.GREEN,a.TileType.BLUE,a.TileType.PURPLE,a.TileType.YELLOW],clusterSize:3,targetScore:500,maxMoves:20,scoreMultiplier:5},[2]})})},t}(s.BaseConfigProvider);o.DefaultGameConfigProvider=c,cc._RF.pop()},{"../../../../../core/config/BaseConfigProvider":"BaseConfigProvider","../../../../domain/board/models/TileType":"TileType"}],DefaultVisualConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"6146fuI6fNI1brorxqqlqYa","DefaultVisualConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultVisualConfigProvider=void 0;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){return r(this,function(e){return this.config={gravity:9,spawnLineY:900,nodeWidth:100,nodeHeight:112},[2]})})},t}(e("../../../../../core/config/BaseConfigProvider").BaseConfigProvider);o.DefaultVisualConfigProvider=s,cc._RF.pop()},{"../../../../../core/config/BaseConfigProvider":"BaseConfigProvider"}],DestroyService:[function(e,t,o){"use strict";cc._RF.push(t,"2017bzN6wxEHaE6OOFvY8CH","DestroyService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyService=void 0;var i=e("../../../application/board/runtime/BoardRuntimeModel"),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.destroy=function(e){for(var t=[],o=0,n=e;o<n.length;o++){var r=n[o],s=this.logicModel.get(r);if(s){this.logicModel.destroy(r),console.log("[DESTROY SERVICE] destroying: "+s),this.runtimeModel.lockTile(s,i.TileLock.DESTROY),this.tileRepository.remove(s);var a={kind:"tile.destroy",id:s,at:r,cause:"match"};t.push(a)}}return t},t}(e("./BoardService").BoardService);o.DestroyService=r,cc._RF.pop()},{"../../../application/board/runtime/BoardRuntimeModel":"BoardRuntimeModel","./BoardService":"BoardService"}],DestroyTween:[function(e,t,o){"use strict";cc._RF.push(t,"c98f3o5sHxEuoZWEnT0oT+2","DestroyTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DestroyTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.DESTROY}return e.prototype.build=function(e){var t=e.node,o=t.scale,n=t.opacity;return cc.tween(t).to(e.squashDuration,{scale:o*e.squashScale},{easing:"sineOut"}).to(e.popDuration,{scale:o*e.popScale},{easing:"quadOut"}).parallel(cc.tween().to(e.shrinkDuration,{opacity:e.shrinkOpacity}),cc.tween().to(e.shrinkDuration,{scale:o*e.shrinkScale})).call(function(){t.scale=o,t.opacity=n})},e}();o.DestroyTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],DestructionSettings:[function(e,t,o){"use strict";cc._RF.push(t,"1cdf0mn/rJGZrEhGF/HLoC/","DestructionSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DomainContext:[function(e,t,o){"use strict";cc._RF.push(t,"daa40NBlt9GXbV3dk3kejOc","DomainContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.DomainContext=void 0;var n=e("../../../core/events/EventBus"),i=e("../../application/board/controllers/BoardController"),r=e("../../application/board/runtime/BoardRuntimeModel"),s=e("../../application/state/controllers/GameStateController"),a=e("../board/models/BoardLogicalModel"),c=e("../board/models/TileFactory"),u=e("../board/models/TileRepository"),l=e("../board/services/DestroyService"),p=e("../board/services/MoveService"),d=e("../board/services/SearchService"),f=e("../board/services/SpawnService"),h=e("../state/models/GameStateModel"),_=e("../state/models/GameStateType"),v=e("../state/services/ScoreService"),y=function(){return function(e){this.gameConfig=e,this.eventBus=new n.EventBus,this.gameStateModel=new h.GameStateModel(e.maxMoves,e.targetScore,0,_.GameStateType.PLAYING),this.scoreService=new v.ScoreService(e.scoreMultiplier),this.gameStateController=new s.GameStateController(this),this.logicModel=new a.BoardLogicalModel(e.boardCols,e.boardRows),this.runtimeModel=new r.BoardRuntimeModel,this.tileRepository=new u.TileRepository,this.tileFactory=new c.TileFactory,this.spawnService=new f.SpawnService(this.logicModel,this.runtimeModel,this.tileRepository,this.tileFactory,e.allowedTypes),this.searchService=new d.SearchService(this.logicModel,this.runtimeModel,this.tileRepository),this.destroyService=new l.DestroyService(this.logicModel,this.runtimeModel,this.tileRepository),this.moveService=new p.MoveService(this.logicModel,this.runtimeModel,this.tileRepository),this.logicController=new i.BoardController(this)}}();o.DomainContext=y,cc._RF.pop()},{"../../../core/events/EventBus":"EventBus","../../application/board/controllers/BoardController":"BoardController","../../application/board/runtime/BoardRuntimeModel":"BoardRuntimeModel","../../application/state/controllers/GameStateController":"GameStateController","../board/models/BoardLogicalModel":"BoardLogicalModel","../board/models/TileFactory":"TileFactory","../board/models/TileRepository":"TileRepository","../board/services/DestroyService":"DestroyService","../board/services/MoveService":"MoveService","../board/services/SearchService":"SearchService","../board/services/SpawnService":"SpawnService","../state/models/GameStateModel":"GameStateModel","../state/models/GameStateType":"GameStateType","../state/services/ScoreService":"ScoreService"}],DropSettings:[function(e,t,o){"use strict";cc._RF.push(t,"d5b03ewPeJO5b6A2qxGH0/F","DropSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DropTween:[function(e,t,o){"use strict";cc._RF.push(t,"fafc8YvYKlCDpzTXkIP9ROC","DropTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.DropTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.DROP}return e.prototype.build=function(e){var t=Math.abs(e.toY-e.fromY)/e.speed;return cc.tween(e.node).set({y:e.fromY}).to(t,{y:e.toY},{easing:"quadIn"}).to(e.bounceDuration,{y:e.toY+e.bounce},{easing:"quadOut"}).to(e.settleDuration,{y:e.toY},{easing:"quadIn"})},e}();o.DropTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],DynamicTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"243ecVuTBJBlo2DFPE2Htsc","DynamicTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],DynamicTextView:[function(e,t,o){"use strict";cc._RF.push(t,"0f168cD/SdDKqVh9wvhZVsP","DynamicTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.DynamicTextView=void 0;var r=e("../../../../core/utils/assert"),s=e("./EventView"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetLabel=null,t.onValueChanged=function(e){t.render(e.value)},t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),r.assertNotNull(this.targetLabel,this,"targetLabel")},t.prototype.preInit=function(){e.prototype.preInit.call(this),r.assertNumber(this.context.initialValue,this,"initialValue")},t.prototype.onInit=function(){this.on(this.eventType(),this.onValueChanged)},t.prototype.postInit=function(){this.render(this.context.initialValue)},t.prototype.render=function(e){this.targetLabel.string=this.format(e)},i([u(cc.Label)],t.prototype,"targetLabel",void 0),t=i([c],t)}(s.EventView);o.DynamicTextView=l,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./EventView":"EventView"}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"4dd3bCOr0RC6b0g0I2ZgBu1","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventBus=void 0;var n=function(){function e(){this._listeners=new Map}return e.prototype.on=function(e,t){var o,n=this,i=null!==(o=this._listeners.get(e))&&void 0!==o?o:[];return i.push(t),this._listeners.set(e,i),{unsubscribe:function(){return n.off(e,t)}}},e.prototype.off=function(e,t){var o=this._listeners.get(e);if(o){var n=o.indexOf(t);-1!==n&&o.splice(n,1)}},e.prototype.emit=function(e){var t=this._listeners.get(e.constructor);if(t)for(var o=0,n=t;o<n.length;o++){(0,n[o])(e)}},e.prototype.clear=function(){this._listeners.clear()},e}();o.EventBus=n,cc._RF.pop()},{}],EventViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"c34d1GkKTNIir2ulEw3eXmO","EventViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],EventView:[function(e,t,o){"use strict";cc._RF.push(t,"9dc55NMdhVDNaqP2Y3DA+nU","EventView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.EventView=void 0;var i=e("../../../../core/events/SubscriptionGroup"),r=e("../../../../core/utils/assert"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subscriptions=new i.SubscriptionGroup,t}return n(t,e),t.prototype.preInit=function(){r.assertNotNull(this.context.eventBus,this,"eventBus")},t.prototype.onDispose=function(){e.prototype.onDispose.call(this),this._subscriptions.clear()},t.prototype.on=function(e,t){var o=this.context.eventBus.on(e,t);this._subscriptions.add(o)},t.prototype.emit=function(e){this.context.eventBus.emit(e)},t}(e("./ContextView").ContextView);o.EventView=s,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../../core/utils/assert":"assert","./ContextView":"ContextView"}],FadeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"a2c91O6FmtG0rsgupz9InLy","FadeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],FadeTween:[function(e,t,o){"use strict";cc._RF.push(t,"34a2dq1IHlDTZMhESV3iwgA","FadeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.FadeTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.FADE}return e.prototype.build=function(e){return cc.tween(e.node).delay(e.delay).to(e.duration,{opacity:e.opacity},{easing:"quadOut"})},e}();o.FadeTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],GameConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"2ed19M0P9lLlIQPuWAJuIRx","GameConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigLoader=void 0;var i=e("../BaseConfigLoader"),r=e("./DefaultGameConfigProvider"),s=e("./GameConfigValidator"),a=e("../../settings/GameSettings"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return a.GameSettings.GAME_CONFIG},t.prototype.createValidator=function(){return new s.GameConfigValidator},t.prototype.getDefaultProvider=function(){return new r.DefaultGameConfigProvider},t}(i.BaseConfigLoader);o.GameConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultGameConfigProvider":"DefaultGameConfigProvider","./GameConfigValidator":"GameConfigValidator"}],GameConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"041e3xL6eVI+o3GAT8qc0ku","GameConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfigValidator=void 0;var n=e("../../../../../core/utils/assert"),i=e("../../../../../core/utils/ensure"),r=e("../../../../domain/board/models/TileType"),s=function(){function e(){}return e.prototype.validate=function(e){var t=this;n.assertObject(e,this,"raw");var o=i.ensureNumber(e.boardCols,this,"boardCols"),s=i.ensureNumber(e.boardRows,this,"boardRows"),a=i.ensureNumber(e.clusterSize,this,"clusterSize"),c=i.ensureNumber(e.targetScore,this,"targetScore"),u=i.ensureNumber(e.maxMoves,this,"maxMoves"),l=i.ensureNumber(e.scoreMultiplier,this,"scoreMultiplier");return n.assertNonEmptyArray(e.allowedTypes,this,"allowedTypes"),{boardCols:o,boardRows:s,allowedTypes:e.allowedTypes.map(function(e,o){return n.assertEnumValue(r.TileType,e,t,"allowedTypes["+o+"]")}),clusterSize:a,targetScore:c,maxMoves:u,scoreMultiplier:l}},e}();o.GameConfigValidator=s,cc._RF.pop()},{"../../../../../core/utils/assert":"assert","../../../../../core/utils/ensure":"ensure","../../../../domain/board/models/TileType":"TileType"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"1b26eLVJPZKR4fSnAImer1v","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],GameEntry:[function(e,t,o){"use strict";cc._RF.push(t,"b0ca3TD77RJ4Zf8PJxueHcl","GameEntry");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameEntry=void 0;var r=e("../application/startup/GameStartup"),s=e("../presentation/context/PresentationInstaller"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.presentationInstaller=null,t}return n(t,e),t.prototype.start=function(){this.startup=new r.GameStartup(this.presentationInstaller),this.startup.start()},t.prototype.onDestroy=function(){var e;null===(e=this.startup)||void 0===e||e.dispose()},i([u(s.PresentationInstaller)],t.prototype,"presentationInstaller",void 0),t=i([c],t)}(cc.Component);o.GameEntry=l,cc._RF.pop()},{"../application/startup/GameStartup":"GameStartup","../presentation/context/PresentationInstaller":"PresentationInstaller"}],GameSettings:[function(e,t,o){"use strict";cc._RF.push(t,"6d565FyS8BE1bBzNxD+96YT","GameSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameSettings=void 0;var n=e("../config/ConfigMode");o.GameSettings={CONFIG_MODE:n.ConfigMode.JSON,GAME_CONFIG:"configs/game-config",VISUAL_CONFIG:"configs/visual-config"},cc._RF.pop()},{"../config/ConfigMode":"ConfigMode"}],GameStartup:[function(e,t,o){"use strict";cc._RF.push(t,"ff254STAfZKYa7pYw6iX8H9","GameStartup");var n=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameStartup=void 0;var r=e("../../domain/context/DomainContext"),s=e("../../presentation/context/PresentationContext"),a=e("../common/config/game/GameConfigLoader"),c=e("../common/config/visual/VisualConfigLoader"),u=e("../common/settings/GameSettings"),l=function(){function e(e){this._presentationInstaller=e}return e.prototype.start=function(){return n(this,void 0,Promise,function(){var e,t,o,n,l=this;return i(this,function(i){switch(i.label){case 0:return e=u.GameSettings.CONFIG_MODE,[4,(new a.GameConfigLoader).load(e)];case 1:return t=i.sent(),[4,(new c.VisualConfigLoader).load(e)];case 2:return o=i.sent(),this._domainContext=new r.DomainContext(t),this._domainContext.gameStateController.init(),this._domainContext.logicController.init(),(n=this._domainContext.spawnService.spawn()).forEach(function(e){return l._domainContext.runtimeModel.lockBoard()}),this._presentationContext=new s.PresentationContext(o,this._domainContext,n),this._presentationInstaller.init(this._presentationContext),[2]}})})},e.prototype.dispose=function(){this._domainContext.logicController.dispose(),this._domainContext.gameStateController.dispose(),this._domainContext.eventBus.clear()},e}();o.GameStartup=l,cc._RF.pop()},{"../../domain/context/DomainContext":"DomainContext","../../presentation/context/PresentationContext":"PresentationContext","../common/config/game/GameConfigLoader":"GameConfigLoader","../common/config/visual/VisualConfigLoader":"VisualConfigLoader","../common/settings/GameSettings":"GameSettings"}],GameStateController:[function(e,t,o){"use strict";cc._RF.push(t,"8abc8oftaBD6qCBxj9JRRs9","GameStateController");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateController=void 0;var i=e("../../../../core/events/SubscriptionGroup"),r=e("../../../domain/state/events/GameStateSync"),s=e("../../../domain/state/events/MovesUpdate"),a=e("../../../domain/state/events/ScoreUpdate"),c=function(e){function t(t){var o=e.call(this)||this;return o._subscriptions=new i.SubscriptionGroup,o.onBoardProcessed=function(e){e.destroyed<1||(o._gameStateModel.addScore(o._scoreService.calculate(e.destroyed)),o._gameStateModel.useMove(),o._eventBus.emit(new a.ScoreUpdate(o._gameStateModel.currentScore)),o._eventBus.emit(new s.MovesUpdate(o._gameStateModel.movesLeft)))},o._gameConfig=t.gameConfig,o._eventBus=t.eventBus,o._gameStateModel=t.gameStateModel,o._scoreService=t.scoreService,o}return n(t,e),t.prototype.onInit=function(){this._subscriptions.add(this._eventBus.on(r.GameStateSync,this.onBoardProcessed))},t.prototype.dispose=function(){this._subscriptions.clear()},t}(e("../../common/controllers/BaseController").BaseController);o.GameStateController=c,cc._RF.pop()},{"../../../../core/events/SubscriptionGroup":"SubscriptionGroup","../../../domain/state/events/GameStateSync":"GameStateSync","../../../domain/state/events/MovesUpdate":"MovesUpdate","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../common/controllers/BaseController":"BaseController"}],GameStateModel:[function(e,t,o){"use strict";cc._RF.push(t,"99471UrmwxBoYieGRlv584Z","GameStateModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateModel=void 0;var n=function(){function e(e,t,o,n){this._movesLeft=e,this._targetScore=t,this._currentScore=o,this._stateType=n}return Object.defineProperty(e.prototype,"movesLeft",{get:function(){return this._movesLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetScore",{get:function(){return this._targetScore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentScore",{get:function(){return this._currentScore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._stateType},enumerable:!1,configurable:!0}),e.prototype.addScore=function(e){this._currentScore+=e},e.prototype.useMove=function(){this._movesLeft--},e.prototype.setState=function(e){this._stateType=e},e}();o.GameStateModel=n,cc._RF.pop()},{}],GameStateSync:[function(e,t,o){"use strict";cc._RF.push(t,"5f8a58DoyJKYaXL8lqaFZu+","GameStateSync"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateSync=void 0;var n=function(){return function(e){this.destroyed=e}}();o.GameStateSync=n,cc._RF.pop()},{}],GameStateType:[function(e,t,o){"use strict";cc._RF.push(t,"1d988esIF9J9rI4hJixXE/p","GameStateType"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateType=void 0,function(e){e[e.PLAYING=0]="PLAYING",e[e.WIN=1]="WIN",e[e.LOSE=2]="LOSE"}(o.GameStateType||(o.GameStateType={})),cc._RF.pop()},{}],IConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"58c4c78lEFJBK0t7vKUhhpW","IConfigProvider"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"fd0b3vkXQdNkKrm68/euUS2","IConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IConfig:[function(e,t,o){"use strict";cc._RF.push(t,"8a20aZkj7NIib5OJO2YOEVQ","IConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IDisposable:[function(e,t,o){"use strict";cc._RF.push(t,"0d1f2BKAyRKradOcgIbpJtI","IDisposable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IEvent:[function(e,t,o){"use strict";cc._RF.push(t,"8fa1c68GtVNRKFHm/nx3oTX","IEvent"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IInitializable:[function(e,t,o){"use strict";cc._RF.push(t,"ee3c8BQs6BEYJwkQjEK6TMK","IInitializable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"651bbPMAMtJFrMr+hApoZfB","ITweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITween:[function(e,t,o){"use strict";cc._RF.push(t,"220bdQQ2z1EdpCtBl1xwWsI","ITween"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IValidatable:[function(e,t,o){"use strict";cc._RF.push(t,"16605S+cj5B/rtndFr9BxXG","IValidatable"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],JsonConfigProvider:[function(e,t,o){"use strict";cc._RF.push(t,"f53f10PjOVPJaepW1ma/Plz","JsonConfigProvider");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,o,n){function i(e){return e instanceof o?e:new o(function(t){t(e)})}return new(o||(o=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):i(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.JsonConfigProvider=void 0;var s=function(e){function t(t,o){var n=e.call(this)||this;return n._path=t,n._validator=o,n}return n(t,e),t.prototype.load=function(){return i(this,void 0,Promise,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,this.loadJsonAsset(this._path)];case 1:return e=t.sent(),this.config=this._validator.validate(e.json),[2]}})})},t.prototype.loadJsonAsset=function(e){return new Promise(function(t,o){cc.resources.load(e,cc.JsonAsset,function(n,i){n||!i?o(new Error("[JsonGameConfigProvider] Failed to load: "+e+"\n"+n)):t(i)})})},t}(e("../BaseConfigProvider").BaseConfigProvider);o.JsonConfigProvider=s,cc._RF.pop()},{"../BaseConfigProvider":"BaseConfigProvider"}],LoadingScreenContext:[function(e,t,o){"use strict";cc._RF.push(t,"b1e87OzaF5DF7z8FN3AvXer","LoadingScreenContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],LoadingScreenFaded:[function(e,t,o){"use strict";cc._RF.push(t,"8d5eeOI/TNJhYjvKHrtytGi","LoadingScreenFaded"),Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreenFaded=void 0;var n=function(){return function(){}}();o.LoadingScreenFaded=n,cc._RF.pop()},{}],LoadingScreen:[function(e,t,o){"use strict";cc._RF.push(t,"d8954Dv6jtN0qvl86oXQZgx","LoadingScreen");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScreen=void 0;var r=e("../board/events/LoadingScreenFaded"),s=e("../board/events/PresentationReady"),a=e("../common/animations/TweenSettings"),c=e("../common/view/EventView"),u=cc._decorator,l=u.ccclass,p=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screen=null,t.screenDelay=5,t.screenFadeOutDuration=.2,t.dots=[],t.dotsFadeInDuration=.5,t.dotsBetweenDelay=.15,t.dotsFadeOutDuration=.3,t.dotPauseBetweenLoops=.2,t.onPresentationReady=function(){t.fadeScreen()},t}return n(t,e),t.prototype.onInit=function(){this.resetDots(),this.startAnimation(),this.on(s.PresentationReady,this.onPresentationReady)},t.prototype.resetDots=function(){for(var e=0,t=this.dots;e<t.length;e++){t[e].opacity=0}},t.prototype.startAnimation=function(){for(var e=this,t=cc.tween(),o=function(o){var i=n.dots[o];t.delay(n.dotsBetweenDelay),t.call(function(){return e.fadeDot(i)})},n=this,i=0;i<this.dots.length;i++)o(i);t.delay(this.dotPauseBetweenLoops),this._tween=cc.tween(this.screen).repeatForever(t).start()},t.prototype.fadeDot=function(e){cc.tween(e).set({opacity:0}).to(this.dotsFadeInDuration,{opacity:255}).to(this.dotsFadeOutDuration,{opacity:0}).start()},t.prototype.fadeScreen=function(){var e=this;this.context.tweenHelper.build(a.TweenSettings.fade(this.screen,this.screenDelay,this.screenFadeOutDuration,0)).call(function(){e.emit(new r.LoadingScreenFaded),cc.Tween.stopAllByTarget(e.screen)}).start()},i([p(cc.Node)],t.prototype,"screen",void 0),i([p],t.prototype,"screenDelay",void 0),i([p],t.prototype,"screenFadeOutDuration",void 0),i([p([cc.Node])],t.prototype,"dots",void 0),i([p],t.prototype,"dotsFadeInDuration",void 0),i([p],t.prototype,"dotsBetweenDelay",void 0),i([p],t.prototype,"dotsFadeOutDuration",void 0),i([p],t.prototype,"dotPauseBetweenLoops",void 0),t=i([l],t)}(c.EventView);o.LoadingScreen=d,cc._RF.pop()},{"../board/events/LoadingScreenFaded":"LoadingScreenFaded","../board/events/PresentationReady":"PresentationReady","../common/animations/TweenSettings":"TweenSettings","../common/view/EventView":"EventView"}],Matrix:[function(e,t,o){"use strict";cc._RF.push(t,"320baWGsBZEno88utR9Y4nE","Matrix"),Object.defineProperty(o,"__esModule",{value:!0}),o.Matrix=void 0;var n=function(){function e(e,t,o){this._width=e,this._height=t,this._data=new Array(t);for(var n=0;n<t;n++){for(var i=new Array(e),r=0;r<e;r++)i[r]=o(r,n);this._data[n]=i}}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.get=function(e,t){return this._data[t][e]},e.prototype.set=function(e,t,o){this._data[t][e]=o},e.prototype.swap=function(e,t,o,n){var i=this._data[t][e];this._data[t][e]=this._data[n][o],this._data[n][o]=i},e.prototype.forEach=function(e){for(var t=0;t<this._height;t++)for(var o=0;o<this._width;o++)e(this._data[t][o],o,t)},e}();o.Matrix=n,cc._RF.pop()},{}],MoveService:[function(e,t,o){"use strict";cc._RF.push(t,"180c6G6rN9G/Iwx7rb1B39H","MoveService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MoveService=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.move=function(e,t){for(var o=0,n=e;o<n.length;o++){var i=n[o],r=this.logicModel.get(i.from);r&&(this.runtimeModel.lockTile(r,t),this.logicModel.move(i.from,i.to))}},t}(e("./BoardService").BoardService);o.MoveService=i,cc._RF.pop()},{"./BoardService":"BoardService"}],MovesTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"edbdcH0xDlCDLhdQ15+puc6","MovesTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],MovesTextView:[function(e,t,o){"use strict";cc._RF.push(t,"d8aafGKJJ1BEZQfGSesrZxi","MovesTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.MovesTextView=void 0;var r=e("../../../domain/state/events/MovesUpdate"),s=e("../../common/view/DynamicTextView"),a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.eventType=function(){return r.MovesUpdate},t.prototype.format=function(e){return e.toString()},t=i([a],t)}(s.DynamicTextView);o.MovesTextView=c,cc._RF.pop()},{"../../../domain/state/events/MovesUpdate":"MovesUpdate","../../common/view/DynamicTextView":"DynamicTextView"}],MovesUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"bb92aCNWRxErro9vapvBuh4","MovesUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.MovesUpdate=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.MovesUpdate=i,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],PresentationContext:[function(e,t,o){"use strict";cc._RF.push(t,"42e70c7wJdHjIwqH428F/4G","PresentationContext"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationContext=void 0;var n=function(){return function(e,t,o){this.visualConfig=e,this.eventBus=t.eventBus,this.boardRuntime=t.runtimeModel,this.movesLeft=t.gameStateModel.movesLeft,this.targetScore=t.gameStateModel.targetScore,this.currentScore=t.gameStateModel.currentScore,this.boardCols=t.logicModel.width,this.boardRows=t.logicModel.height,this.initialBoard=o}}();o.PresentationContext=n,cc._RF.pop()},{}],PresentationInstaller:[function(e,t,o){"use strict";cc._RF.push(t,"4e52fEwHilAvZkfHNvNYkuB","PresentationInstaller");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationInstaller=void 0;var r=e("../../../core/utils/assert"),s=e("../board/events/PresentationReady"),a=e("../board/view/BoardView"),c=e("../common/animations/TweenHelper"),u=e("../common/view/EventView"),l=e("../loading/LoadingScreen"),p=e("../state/view/MovesTextView"),d=e("../state/view/ScoreTextView"),f=cc._decorator,h=f.ccclass,_=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loadingScreen=null,t.boardView=null,t.movesTextView=null,t.scoreTextView=null,t}return n(t,e),t.prototype.onLoad=function(){r.assertNotNull(this.boardView,this,"BoardView"),r.assertNotNull(this.movesTextView,this,"MovesTextView"),r.assertNotNull(this.scoreTextView,this,"ScoreTextView")},t.prototype.preInit=function(){r.assertNotNull(this.context,this,"viewContext")},t.prototype.onInit=function(){this.tweenHelper=new c.TweenHelper,this.loadingScreen.init({eventBus:this.context.eventBus,tweenHelper:this.tweenHelper}),this.boardView.init({visualConfig:this.context.visualConfig,eventBus:this.context.eventBus,runtimeModel:this.context.boardRuntime,tweenHelper:this.tweenHelper,boardCols:this.context.boardCols,boardRows:this.context.boardRows,initialBoard:this.context.initialBoard}),this.movesTextView.init({eventBus:this.context.eventBus,initialValue:this.context.movesLeft}),this.scoreTextView.init({eventBus:this.context.eventBus,initialValue:this.context.currentScore,targetScore:this.context.targetScore})},t.prototype.postInit=function(){this.emit(new s.PresentationReady)},t.prototype.dispose=function(){this.boardView.dispose(),this.movesTextView.dispose(),this.scoreTextView.dispose()},i([_(l.LoadingScreen)],t.prototype,"loadingScreen",void 0),i([_(a.BoardView)],t.prototype,"boardView",void 0),i([_(p.MovesTextView)],t.prototype,"movesTextView",void 0),i([_(d.ScoreTextView)],t.prototype,"scoreTextView",void 0),t=i([h],t)}(u.EventView);o.PresentationInstaller=v,cc._RF.pop()},{"../../../core/utils/assert":"assert","../board/events/PresentationReady":"PresentationReady","../board/view/BoardView":"BoardView","../common/animations/TweenHelper":"TweenHelper","../common/view/EventView":"EventView","../loading/LoadingScreen":"LoadingScreen","../state/view/MovesTextView":"MovesTextView","../state/view/ScoreTextView":"ScoreTextView"}],PresentationReady:[function(e,t,o){"use strict";cc._RF.push(t,"4016b5BZYJKQ4tAffi0vSpn","PresentationReady"),Object.defineProperty(o,"__esModule",{value:!0}),o.PresentationReady=void 0;var n=function(){return function(){}}();o.PresentationReady=n,cc._RF.pop()},{}],SafeDropMap:[function(e,t,o){"use strict";cc._RF.push(t,"c37022szChNwLd+74Hk4RN5","SafeDropMap"),Object.defineProperty(o,"__esModule",{value:!0}),o.SafeDropMap=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.add=function(e){var t;this._map.set(e,(null!==(t=this._map.get(e))&&void 0!==t?t:0)+1)},e.prototype.subtract=function(e){var t=this._map.get(e);t&&0!==t&&this._map.set(e,t-1)},e.prototype.get=function(e){var t;return null!==(t=this._map.get(e))&&void 0!==t?t:0},e.prototype.reset=function(){this._map.clear()},e.prototype.forEach=function(e){this._map.forEach(function(t,o,n){return e(t,o)})},e}();o.SafeDropMap=n,cc._RF.pop()},{}],ScoreService:[function(e,t,o){"use strict";cc._RF.push(t,"ed1f8pLuO9IALBgNsqVtvjL","ScoreService"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreService=void 0;var n=function(){function e(e){this._scoreMultiplier=e}return e.prototype.calculate=function(e){return e*e*this._scoreMultiplier},e}();o.ScoreService=n,cc._RF.pop()},{}],ScoreTextViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"7af9aTEbmRII6sX9caFBjRn","ScoreTextViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ScoreTextView:[function(e,t,o){"use strict";cc._RF.push(t,"7bd0f5hs8VARYsgFprc1Aea","ScoreTextView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreTextView=void 0;var r=e("../../../../core/utils/assert"),s=e("../../../domain/state/events/ScoreUpdate"),a=e("../../common/view/DynamicTextView"),c=cc._decorator.ccclass,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.preInit=function(){e.prototype.preInit.call(this),r.assertNumber(this.context.targetScore,this,"initialValue")},t.prototype.eventType=function(){return s.ScoreUpdate},t.prototype.format=function(e){return e+"/"+this.context.targetScore},t=i([c],t)}(a.DynamicTextView);o.ScoreTextView=u,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../domain/state/events/ScoreUpdate":"ScoreUpdate","../../common/view/DynamicTextView":"DynamicTextView"}],ScoreUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"751d9buhcZDmq08o3hoKjZ/","ScoreUpdate");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreUpdate=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(e("../../../../core/events/ValueChangedEvent").ValueChangedEvent);o.ScoreUpdate=i,cc._RF.pop()},{"../../../../core/events/ValueChangedEvent":"ValueChangedEvent"}],SearchService:[function(e,t,o){"use strict";cc._RF.push(t,"146bchEKatLLLIq9vBSpvaC","SearchService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SearchService=void 0;var i=e("../../../../core/collections/Matrix"),r=e("../models/TileType"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.findCluster=function(e){var t=this.logicModel.get(e);if(!t)return[];for(var o=this.tileRepository.get(t),n=[],s=new i.Matrix(this.logicModel.width,this.logicModel.height,function(){return!1}),a=[e];a.length>0&&o!==r.TileType.EMPTY;){var c=a.pop();if(c&&!s.get(c.x,c.y)){s.set(c.x,c.y,!0);var u=this.logicModel.get(c);u&&this.runtimeModel.stableTile(u)&&this.tileRepository.get(u)===o&&(n.push(c),a.push.apply(a,this.findNeighbors(c)))}}return n},t.prototype.findNeighbors=function(e){for(var t=[],o=0,n=[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}];o<n.length;o++){var i=n[o];i.x<0||i.y<0||i.x>=this.logicModel.width||i.y>=this.logicModel.height||t.push(i)}return t},t.prototype.findDrops=function(){for(var e=[],t=this.logicModel.width-1;t>=0;t--)for(var o=0,n=this.logicModel.height-1;n>=0;n--){var i={x:t,y:n};if(this.logicModel.empty(i))o++;else if(o>0){var r=this.logicModel.get(i);if(!r)continue;var s={kind:"tile.moved",id:r,from:i,to:{x:t,y:n+o},cause:"drop"};e.push(s)}}return e},t}(e("./BoardService").BoardService);o.SearchService=s,cc._RF.pop()},{"../../../../core/collections/Matrix":"Matrix","../models/TileType":"TileType","./BoardService":"BoardService"}],ShakeSettings:[function(e,t,o){"use strict";cc._RF.push(t,"e713e/x+YVACa7ott/cyQ50","ShakeSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ShakeTween:[function(e,t,o){"use strict";cc._RF.push(t,"82609dFDHRKJZdRjD/ogRNx","ShakeTween"),Object.defineProperty(o,"__esModule",{value:!0}),o.ShakeTween=void 0;var n=e("./TweenType"),i=function(){function e(){this.type=n.TweenType.SHAKE}return e.prototype.build=function(e){var t=e.node.angle;return cc.tween(e.node).to(e.duration,{angle:t+e.amplitude}).to(2*e.duration,{angle:t-e.amplitude}).to(2*e.duration,{angle:t+e.amplitude}).to(e.duration,{angle:t})},e}();o.ShakeTween=i,cc._RF.pop()},{"./TweenType":"TweenType"}],SpawnService:[function(e,t,o){"use strict";cc._RF.push(t,"c0001pCwYVP95cvO6tOSR2c","SpawnService");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.SpawnService=void 0;var i=e("../../../application/board/runtime/BoardRuntimeModel"),r=function(e){function t(t,o,n,i,r){var s=e.call(this,t,o,n)||this;return s.factory=i,s.types=r,s}return n(t,e),t.prototype.spawn=function(){for(var e=[],t=0;t<this.logicModel.width;t++)for(var o=0;o<this.logicModel.height;o++){var n={x:t,y:o};if(!this.logicModel.get(n)){var r=this.randomType(),s=this.factory.create(r);this.logicModel.register(n,s.id),this.runtimeModel.lockTile(s.id,i.TileLock.SPAWN),this.tileRepository.register(s.id,r);var a={kind:"tile.spawned",id:s.id,at:n,type:r};e.push(a)}}return e},t.prototype.randomType=function(){return this.types[Math.floor(Math.random()*this.types.length)]},t}(e("./BoardService").BoardService);o.SpawnService=r,cc._RF.pop()},{"../../../application/board/runtime/BoardRuntimeModel":"BoardRuntimeModel","./BoardService":"BoardService"}],SubscriptionGroup:[function(e,t,o){"use strict";cc._RF.push(t,"18bfaE9+69Bu4GzKQB8eC60","SubscriptionGroup"),Object.defineProperty(o,"__esModule",{value:!0}),o.SubscriptionGroup=void 0;var n=function(){function e(){this._subscriptions=[]}return e.prototype.add=function(e){this._subscriptions.push(e)},e.prototype.clear=function(){for(var e=0,t=this._subscriptions;e<t.length;e++){t[e].unsubscribe()}this._subscriptions.length=0},e}();o.SubscriptionGroup=n,cc._RF.pop()},{}],Subscription:[function(e,t,o){"use strict";cc._RF.push(t,"e054aPiy9xJ/roTuUKhU0v3","Subscription"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileAssets:[function(e,t,o){"use strict";cc._RF.push(t,"4db3f6Nos5B9K7+VqraVTc/","TileAssets");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileAssets=void 0;var r=e("../../../../core/utils/assert"),s=e("../../../../core/utils/ensure"),a=e("../../../domain/board/models/TileType"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.empty=null,t.red=null,t.green=null,t.blue=null,t.purple=null,t.yellow=null,t.bomb=null,t}return n(t,e),t.prototype.onLoad=function(){this.validate()},t.prototype.validate=function(){this._map=new Map([[a.TileType.EMPTY,s.ensureNotNull(this.empty,this,"EMPTY")],[a.TileType.RED,s.ensureNotNull(this.red,this,"RED")],[a.TileType.GREEN,s.ensureNotNull(this.green,this,"GREEN")],[a.TileType.BLUE,s.ensureNotNull(this.blue,this,"BLUE")],[a.TileType.PURPLE,s.ensureNotNull(this.purple,this,"PURPLE")],[a.TileType.YELLOW,s.ensureNotNull(this.yellow,this,"YELLOW")],[a.TileType.BOMB,s.ensureNotNull(this.bomb,this,"BOMB")]])},t.prototype.get=function(e){var t=this._map.get(e);return r.assertNotNull(t,this,"Sprite for type "+a.TileType[e]),t},i([l(cc.SpriteFrame)],t.prototype,"empty",void 0),i([l(cc.SpriteFrame)],t.prototype,"red",void 0),i([l(cc.SpriteFrame)],t.prototype,"green",void 0),i([l(cc.SpriteFrame)],t.prototype,"blue",void 0),i([l(cc.SpriteFrame)],t.prototype,"purple",void 0),i([l(cc.SpriteFrame)],t.prototype,"yellow",void 0),i([l(cc.SpriteFrame)],t.prototype,"bomb",void 0),t=i([u],t)}(cc.Component);o.TileAssets=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../../../core/utils/ensure":"ensure","../../../domain/board/models/TileType":"TileType"}],TileDestroyed:[function(e,t,o){"use strict";cc._RF.push(t,"1a542/xHkpO3K4fTYJWIYxc","TileDestroyed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileFactory:[function(e,t,o){"use strict";cc._RF.push(t,"f5173b4yopNF56G2A/Gy+sM","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var n=function(){function e(){this._nextId=0}return e.prototype.create=function(e){return{id:"tile_"+this._nextId++,type:e}},e}();o.TileFactory=n,cc._RF.pop()},{}],TileModel:[function(e,t,o){"use strict";cc._RF.push(t,"917c78DkrFDE6IMAgJyVb7P","TileModel"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMoved:[function(e,t,o){"use strict";cc._RF.push(t,"20fc60xOqNB5qltU9zcKtig","TileMoved"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileMutations:[function(e,t,o){"use strict";cc._RF.push(t,"cbab0YimbFAWohRUvv5AZhv","TileMutations"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileMutations=void 0;var n=function(){function e(){}return e.rejected=function(e,t){return{kind:"tile.rejected",id:e,reason:t}},e.destroyed=function(e,t,o){return{kind:"tile.destroy",id:e,at:t,cause:o}},e.moved=function(e,t,o){return{kind:"tile.moved",id:e,from:t,to:o}},e.spawned=function(e,t,o){return{kind:"tile.spawned",id:e,type:t,at:o}},e.transformed=function(e,t,o){return{kind:"tile.transformed",id:e,before:t,after:o}},e}();o.TileMutations=n,cc._RF.pop()},{}],TileMutation:[function(e,t,o){"use strict";cc._RF.push(t,"4e77f3qoCpKXKR2amsmAHV/","TileMutation"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TilePosition:[function(e,t,o){"use strict";cc._RF.push(t,"e31ab1Szq1KkpQ2i09M9pA2","TilePosition"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileRejected:[function(e,t,o){"use strict";cc._RF.push(t,"4afe1hIvUdP2oIcsQgtGDqE","TileRejected"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRejectedReason=void 0,o.TileRejectedReason={NO_MATCH:"no_match",UNSTABLE:"unstable",NON_EXISTANT:"non_existant"},cc._RF.pop()},{}],TileRepository:[function(e,t,o){"use strict";cc._RF.push(t,"35350obStpNGJZk1bJk7MEK","TileRepository"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRepository=void 0;var n=function(){function e(){this._tiles=new Map}return e.prototype.register=function(e,t){this._tiles.set(e,t)},e.prototype.get=function(e){var t=this._tiles.get(e);return t||null},e.prototype.remove=function(e){this._tiles.delete(e)},e}();o.TileRepository=n,cc._RF.pop()},{}],TileSpawned:[function(e,t,o){"use strict";cc._RF.push(t,"d8b33ZW3klA5YiCWrnTZWSz","TileSpawned"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileTransformed:[function(e,t,o){"use strict";cc._RF.push(t,"745d4yYFSxPpKHxydqVXs3Z","TileTransformed"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileType:[function(e,t,o){"use strict";cc._RF.push(t,"ff92aR8Ym9CB7br3M3C8KnH","TileType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e[e.EMPTY=0]="EMPTY",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=3]="BLUE",e[e.PURPLE=4]="PURPLE",e[e.YELLOW=5]="YELLOW",e[e.BOMB=6]="BOMB",e[e.SUPER_BOMB=7]="SUPER_BOMB",e[e.HORIZONTAL_ROCKET=8]="HORIZONTAL_ROCKET",e[e.VERTICAL_ROCKET=9]="VERTICAL_ROCKET"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],TileViewContext:[function(e,t,o){"use strict";cc._RF.push(t,"c7e41M2uOVIuYIyMt4LhB8p","TileViewContext"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileViewPool:[function(e,t,o){"use strict";cc._RF.push(t,"c104dYJlUtIwqc6fbb0RLYU","TileViewPool"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileViewPool=void 0;var n=e("../../../../core/utils/assert"),i=e("./TileView"),r=function(){function e(e,t,o){this._eventBus=e,this._prefab=t,this._parent=o,this.pool=[]}return e.prototype.pull=function(){var e=this.pool.pop();this.isValid(e)||(e=cc.instantiate(this._prefab).getComponent(i.TileView));return n.assertNotNull(e,this,"pool is broken"),e.node.setParent(this._parent),e.node.setPosition(0,0),e.node.setScale(1,1),e.node.angle=0,e.node.opacity=255,e.node.active=!0,e.init({eventBus:this._eventBus}),e},e.prototype.release=function(e){this.isValid(e)&&(cc.Tween.stopAllByTarget(e.node),e.hide(),e.node.removeFromParent(),this.pool.push(e))},e.prototype.isValid=function(e){return!!e&&(cc.isValid(e)&&cc.isValid(e.node))},e}();o.TileViewPool=r,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./TileView":"TileView"}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"0eda0LA+Q5BwrB21iLZDWRq","TileView");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var r=e("../../../../core/utils/assert"),s=e("../../common/assets/TileAssets"),a=e("../../common/view/ContextView"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.tileAssets=null,t}return n(t,e),t.prototype.validate=function(){e.prototype.validate.call(this),r.assertNotNull(this.sprite,this,"Sprite")},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},t.prototype.set=function(e){var t=this.tileAssets.get(e);this.sprite.spriteFrame=t},t.prototype.stabilize=function(){this.node.setScale(1,1),this.node.angle=0,this.node.opacity=255,this.node.active=!0},i([l(cc.Sprite)],t.prototype,"sprite",void 0),i([l(s.TileAssets)],t.prototype,"tileAssets",void 0),t=i([u],t)}(a.ContextView);o.TileView=p,cc._RF.pop()},{"../../../../core/utils/assert":"assert","../../common/assets/TileAssets":"TileAssets","../../common/view/ContextView":"ContextView"}],TileVisualAgentFactory:[function(e,t,o){"use strict";cc._RF.push(t,"e178a4bXWpLJoM3hUJ+TCHM","TileVisualAgentFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgentFactory=void 0;var n=e("./TileVisualAgent"),i=function(){function e(e,t,o,n,i,r,s,a,c){this._visualConfig=e,this._eventBus=t,this._tweenHelper=o,this._pool=n,this._boardCols=i,this._boardRows=r,this._backgroundLayer=s,this._tileLayer=a,this._fxLayer=c}return e.prototype.create=function(e){var t=this._pool.pull();return new n.TileVisualAgent(this._visualConfig,this._eventBus,this._tweenHelper,e,t,this._boardCols,this._boardRows,this._backgroundLayer,this._tileLayer,this._fxLayer)},e}();o.TileVisualAgentFactory=i,cc._RF.pop()},{"./TileVisualAgent":"TileVisualAgent"}],TileVisualAgent:[function(e,t,o){"use strict";cc._RF.push(t,"0d826Kcf5hPF5BGQIQZpQiO","TileVisualAgent"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualAgent=void 0;var n=e("../../../application/board/BoardKey"),i=e("../../../application/board/runtime/BoardRuntimeModel"),r=e("../../common/animations/TweenSettings"),s=e("../../utils/calc"),a=e("../events/VisualTileClicked"),c=e("../events/VisualTileUnlocked"),u=function(){function e(e,t,o,n,r,s,a,c,u,l){this._type=null,this._position=null,this._target=null,this._tween=null,this._visualConfig=e,this._eventBus=t,this._tweenHelper=o,this._id=n,this._view=r,this._boardCols=s,this._boardRows=a,this._nodeWidth=r.node.width,this._nodeHeight=r.node.height,this._backgroundLayer=c,this._tileLayer=u,this._fxLayer=l,this._lock=i.TileLock.NONE}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var e;return null!==(e=this._type)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){var e;return null!==(e=this._position)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var e;return null!==(e=this._target)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return null!==this._tween},enumerable:!1,configurable:!0}),e.prototype.spawnInverted=function(e,t){var o=s.getLocal({x:t.x,y:-t.y-this._visualConfig.spawnLineY},this._boardCols,this._boardRows,this._visualConfig.nodeWidth,this._visualConfig.nodeHeight);this.spawn(e,t,o)},e.prototype.spawnNormal=function(e,t,o){var n=s.getLocal({x:t.x,y:t.y-o-this._visualConfig.spawnLineY},this._boardCols,this._boardRows,this._visualConfig.nodeWidth,this._visualConfig.nodeHeight);this.spawn(e,t,n)},e.prototype.move=function(e){var t=this;if(this.lock(i.TileLock.DROP),this._position!==e){this.busy&&(this.clear(),this.stabilize()),this.view.node.setParent(this._fxLayer),console.log("[AGENT] "+this.id+" is startng to move"),this._target=e;var o=this.local(this._target).y;this._tween=this._tweenHelper.build(r.TweenSettings.drop(this._view.node,this._view.node.y,o,this.speed())).call(function(){t.clear(),t._position=e,t._target=null,t.view.node.setParent(t._tileLayer),console.log("[AGENT] "+t.id+" MOVE FINISHED!"),t.unlock()}).start()}},e.prototype.destroy=function(){var e=this;this.lock(i.TileLock.DESTROY),this._view.node.setParent(this._backgroundLayer),this._tween=this._tweenHelper.build(r.TweenSettings.destroy(this._view.node)).call(function(){e.clear(),e.hide(),e.unsubscribe(),e.unlock()}).start()},e.prototype.shake=function(){var e=this;this.lock(i.TileLock.SHAKE),this._view.node.setParent(this._fxLayer),this._tween=this._tweenHelper.build(r.TweenSettings.shake(this._view.node)).call(function(){e.clear(),e.unlock()}).start()},e.prototype.spawn=function(e,t,o){var s=this;this.lock(i.TileLock.SPAWN),console.log("[SPAWN] "+n.BoardKey.type(e)+" at "+n.BoardKey.position(t)+" with offset "+o);var a=this.local(t);this.prepare(e,o),this.subscribe(),this._tween=this._tweenHelper.build(r.TweenSettings.drop(this._view.node,o.y,a.y,this.speed())).call(function(){s.clear(),s._position=t,s._target=null,console.log("[AGENT] "+s.id+" SPAWN FINISHED!"),s.unlock()}).start()},e.prototype.prepare=function(e,t){this._view.set(e),this._view.stabilize(),this._view.node.setParent(this._tileLayer),this._view.node.setPosition(t),this._view.show()},e.prototype.stabilize=function(){this._view.node.setParent(this._fxLayer),this._view.stabilize()},e.prototype.clear=function(){this._tween&&this._tween.stop(),this._tween=null},e.prototype.hide=function(){this.view.hide()},e.prototype.lock=function(e){this._lock|=e},e.prototype.unlock=function(){this._eventBus.emit(new c.VisualTileUnlocked(this._id,this._lock)),this._lock=i.TileLock.NONE},e.prototype.onClick=function(){!this.busy&&this._position&&this._eventBus.emit(new a.VisualTileClicked(this._position))},e.prototype.subscribe=function(){this._view.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.unsubscribe=function(){this._view.node.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.local=function(e){return s.getLocal(e,this._boardCols,this._boardRows,this._nodeWidth,this._nodeHeight)},e.prototype.speed=function(){return s.getSpeed(this._nodeHeight,this._visualConfig.gravity)},e}();o.TileVisualAgent=u,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../../application/board/runtime/BoardRuntimeModel":"BoardRuntimeModel","../../common/animations/TweenSettings":"TweenSettings","../../utils/calc":"calc","../events/VisualTileClicked":"VisualTileClicked","../events/VisualTileUnlocked":"VisualTileUnlocked"}],TileVisualOrchestrator:[function(e,t,o){"use strict";cc._RF.push(t,"79985Ho6MlB3pAuxEpEnlOu","TileVisualOrchestrator"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileVisualOrchestrator=void 0;var n=e("../../../application/board/BoardKey"),i=e("../../../application/board/runtime/BoardRuntimeModel"),r=e("../../../domain/board/events/mutations/TileRejected"),s=e("../events/VisualTileUnlocked"),a=e("./BoardVisualModel"),c=e("./SafeDropMap"),u=e("./TileViewPool"),l=e("./TileVisualAgentFactory"),p=function(){function e(e,t,o,n,r,p,d,f,h,_){var v=this;this.onTileUnlocked=function(e){v._runtimeModel.unlockBoard();var t=v._visualModel.get(e.id);t&&(v._safeDropMap.subtract(t.position.x),v._runtimeModel.unlockTile(t.id,e.reason),e.reason===i.TileLock.DESTROY&&(v._runtimeModel.deleteTile(t.id),v._viewPool.release(t.view),v._visualModel.remove(t.id)))},this._visualConfig=e,this._eventBus=t,this._runtimeModel=o,this._tweenHelper=n,this._boardCols=r,this._boardRows=p,this._backgroundLayer=d,this._tileLayer=f,this._fxLayer=h,this._tilePrefab=_,this._visualModel=new a.BoardVisualModel,this._viewPool=new u.TileViewPool(this._eventBus,this._tilePrefab,this._tileLayer),this._visualAgentFactory=new l.TileVisualAgentFactory(this._visualConfig,this._eventBus,this._tweenHelper,this._viewPool,this._boardCols,this._boardRows,this._backgroundLayer,this._tileLayer,this._fxLayer),this._safeDropMap=new c.SafeDropMap,this._eventBus.on(s.VisualTileUnlocked,this.onTileUnlocked)}return e.prototype.init=function(e){var t=this;e.forEach(function(e){var o=t._visualAgentFactory.create(e.id);t._visualModel.register(o),o.spawnInverted(e.type,e.at)})},e.prototype.dispatch=function(e){for(var t=0,o=e.mutations;t<o.length;t++){"tile.spawned"===(a=o[t]).kind&&this._safeDropMap.add(a.at.x)}this._safeDropMap.forEach(function(e,t){return console.log("[DISPATCH] spawning "+e+" nodes in "+t+" column")}),console.log("[DISPATCH] mutations: "+e.mutations.length);for(var i=0,s=e.mutations;i<s.length;i++){var a;switch((a=s[i]).kind){case"tile.spawned":console.log("[DISPATCH] dispatching spawn at: "+n.BoardKey.position(a.at)+"; id: "+a.id);var c=this._visualAgentFactory.create(a.id);this._visualModel.register(c);var u=this._safeDropMap.get(a.at.x);c.spawnNormal(a.type,a.at,u-this._visualConfig.spawnLineY);break;case"tile.moved":if(console.log("[DISPATCH] dispatching move from: "+n.BoardKey.position(a.from)+"; to: "+n.BoardKey.position(a.to)+"; id: "+a.id),!(c=this._visualModel.get(a.id)))break;this._runtimeModel.stableTile(c.id)&&console.log("[DISPATCH] MOVE !STABILITY CONFLICT!"),console.log("[DISPATCH] MOVE DISPATCHED"),c.move(a.to);break;case"tile.destroy":if(console.log("[DISPATCH] dispatching destroy at: "+n.BoardKey.position(a.at)+"; id: "+a.id),!(c=this._visualModel.get(a.id)))break;this._runtimeModel.stableTile(c.id)&&console.log("[DISPATCH] "+a.id+" DESTROY STABILITY CONFLICT at "+n.BoardKey.position(a.at)),console.log("[DISPATCH] DISPATCHED"),c.destroy();break;case"tile.transformed":if(!(c=this._visualModel.get(a.id)))break;break;case"tile.rejected":if(console.log("[DISPATCH] rejected: "+a.reason),!(c=this._visualModel.get(a.id)))break;a.reason==r.TileRejectedReason.NO_MATCH&&c.shake(),console.log("[DISPATCH] agent: "+c.id+"; position: "+n.BoardKey.position(c.position));break;default:throw new Error("Unsupported mutation kind: "+a.kind)}}},e}();o.TileVisualOrchestrator=p,cc._RF.pop()},{"../../../application/board/BoardKey":"BoardKey","../../../application/board/runtime/BoardRuntimeModel":"BoardRuntimeModel","../../../domain/board/events/mutations/TileRejected":"TileRejected","../events/VisualTileUnlocked":"VisualTileUnlocked","./BoardVisualModel":"BoardVisualModel","./SafeDropMap":"SafeDropMap","./TileViewPool":"TileViewPool","./TileVisualAgentFactory":"TileVisualAgentFactory"}],TweenHelper:[function(e,t,o){"use strict";cc._RF.push(t,"2ee8fX9cuhK1rpLwq9wgYPG","TweenHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenHelper=void 0;var n=e("../../../../core/utils/assert"),i=e("./tweens/DestroyTween"),r=e("./tweens/ShakeTween"),s=e("./tweens/DropTween"),a=e("./tweens/FadeTween"),c=function(){function e(){this.tweens=new Map,this.register()}return e.prototype.register=function(){this.add(new i.DestroyTween),this.add(new a.FadeTween),this.add(new s.DropTween),this.add(new r.ShakeTween)},e.prototype.add=function(e){this.tweens.set(e.type,e)},e.prototype.build=function(e){var t=this.tweens.get(e.type);return n.assertNotNull(t,this,"tween"),t.build(e)},e}();o.TweenHelper=c,cc._RF.pop()},{"../../../../core/utils/assert":"assert","./tweens/DestroyTween":"DestroyTween","./tweens/DropTween":"DropTween","./tweens/FadeTween":"FadeTween","./tweens/ShakeTween":"ShakeTween"}],TweenSettings:[function(e,t,o){"use strict";cc._RF.push(t,"0181cXWOh9Oia7D8sqe+9Xy","TweenSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenSettings=void 0;var n=e("./tweens/TweenType"),i=function(){function e(){}return e.fade=function(e,t,o,i){return{type:n.TweenType.FADE,node:e,delay:t,duration:o,opacity:i}},e.drop=function(e,t,o,i){return{type:n.TweenType.DROP,node:e,fromY:t,toY:o,speed:i,easing:"quadIn",bounce:10,bounceDuration:.08,settleDuration:.08}},e.destroy=function(e){return{type:n.TweenType.DESTROY,node:e,squashDuration:.05,squashScale:.95,popDuration:.03,popScale:1.2,shrinkDuration:.3,shrinkOpacity:0,shrinkScale:.2}},e.shake=function(e){return{type:n.TweenType.SHAKE,node:e,duration:.05,amplitude:8}},e}();o.TweenSettings=i,cc._RF.pop()},{"./tweens/TweenType":"TweenType"}],TweenType:[function(e,t,o){"use strict";cc._RF.push(t,"4816dhJDk9IGJvlwlnEfHAF","TweenType"),Object.defineProperty(o,"__esModule",{value:!0}),o.TweenType=void 0,function(e){e[e.FADE=0]="FADE",e[e.DESTROY=1]="DESTROY",e[e.DROP=2]="DROP",e[e.SPAWN=3]="SPAWN",e[e.SHAKE=4]="SHAKE"}(o.TweenType||(o.TweenType={})),cc._RF.pop()},{}],ValueChangedEvent:[function(e,t,o){"use strict";cc._RF.push(t,"323e3lkPd9Nzq1jCSpLjod2","ValueChangedEvent"),Object.defineProperty(o,"__esModule",{value:!0}),o.ValueChangedEvent=void 0;var n=function(){return function(e){this.value=e}}();o.ValueChangedEvent=n,cc._RF.pop()},{}],VisualConfigLoader:[function(e,t,o){"use strict";cc._RF.push(t,"e50a2oB6P5I3LE8/vlH/qdn","VisualConfigLoader");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigLoader=void 0;var i=e("../../settings/GameSettings"),r=e("../BaseConfigLoader"),s=e("./DefaultVisualConfigProvider"),a=e("./VisualConfigValidator"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonPath=function(){return i.GameSettings.VISUAL_CONFIG},t.prototype.createValidator=function(){return new a.VisualConfigValidator},t.prototype.getDefaultProvider=function(){return new s.DefaultVisualConfigProvider},t}(r.BaseConfigLoader);o.VisualConfigLoader=c,cc._RF.pop()},{"../../settings/GameSettings":"GameSettings","../BaseConfigLoader":"BaseConfigLoader","./DefaultVisualConfigProvider":"DefaultVisualConfigProvider","./VisualConfigValidator":"VisualConfigValidator"}],VisualConfigValidator:[function(e,t,o){"use strict";cc._RF.push(t,"ddcd1tnRPpEvq6CNyVNi8FC","VisualConfigValidator"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualConfigValidator=void 0;var n=e("../../../../../core/utils/assert"),i=e("../../../../../core/utils/ensure"),r=function(){function e(){}return e.prototype.validate=function(e){return n.assertObject(e,this,"raw"),{gravity:i.ensureNumber(e.gravity,this,"baseDropTime"),spawnLineY:i.ensureNumber(e.spawnLineY,this,"spawnLineY"),nodeWidth:i.ensureNumber(e.nodeWidth,this,"nodeWidth"),nodeHeight:i.ensureNumber(e.nodeHeight,this,"nodeHeight")}},e}();o.VisualConfigValidator=r,cc._RF.pop()},{"../../../../../core/utils/assert":"assert","../../../../../core/utils/ensure":"ensure"}],VisualConfig:[function(e,t,o){"use strict";cc._RF.push(t,"25d26/EYZxAhKvwNvzom8R5","VisualConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],VisualTileClicked:[function(e,t,o){"use strict";cc._RF.push(t,"a68acF83zxITq3p8hOpX+c1","VisualTileClicked"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileClicked=void 0;var n=function(){return function(e){this.position=e}}();o.VisualTileClicked=n,cc._RF.pop()},{}],VisualTileUnlocked:[function(e,t,o){"use strict";cc._RF.push(t,"41a27SYXKBPIZ2y7o5spX80","VisualTileUnlocked"),Object.defineProperty(o,"__esModule",{value:!0}),o.VisualTileUnlocked=void 0;var n=function(){return function(e,t){this.id=e,this.reason=t}}();o.VisualTileUnlocked=n,cc._RF.pop()},{}],assert:[function(e,t,o){"use strict";function n(e,t,o){var n;if(n="function"==typeof t?t.name:t.constructor.name,!e)throw new Error("["+n+"] "+o)}function i(e,t,o){n(null!==e&&void 0!==e,t,o+" must not be null nor undefined")}function r(e,t,o){n(Array.isArray(e),t,o+" must be an array")}function s(e,t,o){n(e.length>0,t,o+" must not be empty")}cc._RF.push(t,"3cb7d9OgnZEJaI/WU7/lNKX","assert"),Object.defineProperty(o,"__esModule",{value:!0}),o.assertNumber=o.assertObject=o.assertEnumValue=o.assertString=o.assertNonEmptyArray=o.assertArrayNotEmpty=o.assertArray=o.assertNotNull=o.assert=void 0,o.assert=n,o.assertNotNull=i,o.assertArray=r,o.assertArrayNotEmpty=s,o.assertNonEmptyArray=function(e,t,o){r(e,t,o),s(e,t,o)},o.assertString=function(e,t,o){n("string"==typeof e,t,o+" must be string")},o.assertEnumValue=function(e,t,o,i){var r=e[t];return n(void 0!==r,o,"Unknown "+i+': "'+t+'"'),r},o.assertObject=function(e,t,o){n("object"==typeof e,t,o+" must be object"),i(e,t,o)},o.assertNumber=function(e,t,o){n("number"==typeof e&&!Number.isNaN(e),t,o+" must be number")},cc._RF.pop()},{}],calc:[function(e,t,o){"use strict";function n(e,t,o,n){var i=-(e-1)*o/2,r=(t-1)*n/2;return cc.v2(i,r)}cc._RF.push(t,"64e8aSSlcZIUo+/VlXg2quw","calc"),Object.defineProperty(o,"__esModule",{value:!0}),o.getSpeed=o.getOrigin=o.getLocal=void 0,o.getLocal=function(e,t,o,i,r){var s=n(t,o,i,r);return cc.v2(s.x+e.x*i,s.y-e.y*r)},o.getOrigin=n,o.getSpeed=function(e,t){return e*t},cc._RF.pop()},{}],ensure:[function(e,t,o){"use strict";cc._RF.push(t,"4a80emCBIlPbY4kzmojZq/X","ensure"),Object.defineProperty(o,"__esModule",{value:!0}),o.ensureNotNull=o.ensureNumber=void 0;var n=e("./assert");o.ensureNumber=function(e,t,o){return n.assertNumber(e,t,o),e},o.ensureNotNull=function(e,t,o){return n.assertNotNull(e,t,o),e},cc._RF.pop()},{"./assert":"assert"}],random:[function(e,t,o){"use strict";cc._RF.push(t,"a5d9cezF4BFNIl1SShDyYsy","random"),Object.defineProperty(o,"__esModule",{value:!0}),o.Random=void 0;var n=function(){function e(){}return e.intRange=function(e,t){return e+Math.floor(Math.random()*(t-e))},e.floatRange=function(e,t){return e+Math.random()*(t-e)},e.float=function(){return Math.random()},e.pick=function(e){if(0===e.length)throw new Error("[Random] Cannot pick from empty array");return e[this.intRange(0,e.length)]},e}();o.Random=n,cc._RF.pop()},{}]},{},["Matrix","BaseConfigProvider","ConfigLoader","IConfig","IConfigProvider","IConfigValidator","JsonConfigProvider","EventBus","IEvent","Subscription","SubscriptionGroup","ValueChangedEvent","IDisposable","IInitializable","IValidatable","assert","ensure","random","BoardKey","BoardController","BoardRuntimeModel","BaseConfigLoader","ConfigMode","DefaultGameConfigProvider","GameConfig","GameConfigLoader","GameConfigValidator","DefaultVisualConfigProvider","VisualConfig","VisualConfigLoader","VisualConfigValidator","BaseController","GameSettings","GameStartup","GameStateController","BoardMutationsBatch","TileDestroyed","TileMoved","TileMutation","TileMutations","TileRejected","TileSpawned","TileTransformed","BoardLogicalModel","TileFactory","TileModel","TilePosition","TileRepository","TileType","BoardService","DestroyService","MoveService","SearchService","SpawnService","DomainContext","GameStateSync","MovesUpdate","ScoreUpdate","GameStateModel","GameStateType","ScoreService","GameEntry","BoardViewContext","TileViewContext","LoadingScreenFaded","PresentationReady","VisualTileClicked","VisualTileUnlocked","AltitudeMap","BoardView","BoardVisualModel","SafeDropMap","TileView","TileViewPool","TileVisualAgent","TileVisualAgentFactory","TileVisualOrchestrator","TweenHelper","TweenSettings","DestructionSettings","DropSettings","FadeSettings","ITweenSettings","ShakeSettings","DestroyTween","DropTween","FadeTween","ITween","ShakeTween","TweenType","TileAssets","DynamicTextViewContext","EventViewContext","ContextView","DynamicTextView","EventView","PresentationContext","PresentationInstaller","LoadingScreen","LoadingScreenContext","MovesTextViewContext","ScoreTextViewContext","MovesTextView","ScoreTextView","calc"]);